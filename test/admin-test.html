<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duulair Backend Test - Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .api-base {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-base input {
            flex: 1;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #667eea;
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .response {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .response.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .response.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .response-time {
            font-size: 11px;
            color: #666;
        }

        .loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge.get { background: #28a745; color: white; }
        .badge.post { background: #007bff; color: white; }
        .badge.put { background: #ffc107; color: #000; }
        .badge.delete { background: #dc3545; color: white; }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            color: #666;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            width: auto;
        }

        .tab:hover {
            color: #667eea;
            transform: none;
            box-shadow: none;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .quick-actions button {
            flex: 1;
            padding: 8px 16px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Duulair Backend Test Dashboard</h1>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö Registration & User Management APIs</p>
            <div class="api-base">
                <strong>API Base URL:</strong>
                <input type="text" id="apiBase" value="http://localhost:3000/api/registration" />
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('check')">Check User</button>
            <button class="tab" onclick="switchTab('patient')">Register Patient</button>
            <button class="tab" onclick="switchTab('caregiver')">Register Caregiver</button>
            <button class="tab" onclick="switchTab('link')">Link Code</button>
            <button class="tab" onclick="switchTab('profile')">Profile</button>
        </div>

        <!-- Check User Tab -->
        <div id="check-tab" class="tab-content active">
            <div class="card">
                <h2>üîç Check User Exists <span class="badge get">GET</span></h2>
                <div class="form-group">
                    <label>LINE User ID</label>
                    <input type="text" id="checkLineUserId" placeholder="U1234567890" value="U1234567890">
                </div>
                <button onclick="checkUser()">Check User</button>
                <div id="checkResponse" class="response" style="display:none;"></div>
            </div>
        </div>

        <!-- Register Patient Tab -->
        <div id="patient-tab" class="tab-content">
            <div class="card">
                <h2>üë§ Register Patient <span class="badge post">POST</span></h2>

                <div class="form-group">
                    <label>LINE User ID</label>
                    <input type="text" id="patientLineUserId" placeholder="U1234567890" value="U1234567890">
                </div>

                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" id="patientDisplayName" placeholder="‡∏™‡∏°‡∏®‡∏£‡∏µ ‡πÉ‡∏à‡∏î‡∏µ" value="‡∏™‡∏°‡∏®‡∏£‡∏µ ‡πÉ‡∏à‡∏î‡∏µ">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠ *</label>
                        <input type="text" id="patientFirstName" placeholder="‡∏™‡∏°‡∏®‡∏£‡∏µ" value="‡∏™‡∏°‡∏®‡∏£‡∏µ">
                    </div>
                    <div class="form-group">
                        <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                        <input type="text" id="patientLastName" placeholder="‡πÉ‡∏à‡∏î‡∏µ" value="‡πÉ‡∏à‡∏î‡∏µ">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î *</label>
                        <input type="date" id="patientBirthDate" value="1959-03-15">
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏û‡∏® *</label>
                        <select id="patientGender">
                            <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
                            <option value="male">‡∏ä‡∏≤‡∏¢</option>
                            <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)</label>
                        <input type="number" id="patientWeight" placeholder="65" value="65">
                    </div>
                    <div class="form-group">
                        <label>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.)</label>
                        <input type="number" id="patientHeight" placeholder="155" value="155">
                    </div>
                </div>

                <div class="form-group">
                    <label>‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≠‡∏°‡∏°‡πà‡∏≤)</label>
                    <input type="text" id="patientDiseases" placeholder="hypertension, diabetes" value="hypertension, diabetes">
                </div>

                <div class="form-group">
                    <label>‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô - ‡∏ä‡∏∑‡πà‡∏≠ *</label>
                    <input type="text" id="patientEmergencyName" placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" value="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
                </div>

                <div class="form-group">
                    <label>‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô - ‡πÄ‡∏ö‡∏≠‡∏£‡πå *</label>
                    <input type="text" id="patientEmergencyPhone" placeholder="081-234-5678" value="081-234-5678">
                </div>

                <button onclick="registerPatient()">Register Patient</button>
                <div id="patientResponse" class="response" style="display:none;"></div>
            </div>
        </div>

        <!-- Register Caregiver Tab -->
        <div id="caregiver-tab" class="tab-content">
            <div class="card">
                <h2>üë®‚Äç‚öïÔ∏è Register Caregiver <span class="badge post">POST</span></h2>

                <div class="form-group">
                    <label>LINE User ID</label>
                    <input type="text" id="caregiverLineUserId" placeholder="U0987654321" value="U0987654321">
                </div>

                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" id="caregiverDisplayName" placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ" value="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠ *</label>
                        <input type="text" id="caregiverFirstName" placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢" value="‡∏™‡∏°‡∏ä‡∏≤‡∏¢">
                    </div>
                    <div class="form-group">
                        <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                        <input type="text" id="caregiverLastName" placeholder="‡πÉ‡∏à‡∏î‡∏µ" value="‡πÉ‡∏à‡∏î‡∏µ">
                    </div>
                </div>

                <div class="form-group">
                    <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå *</label>
                    <select id="caregiverRelationship">
                        <option value="child">‡∏•‡∏π‡∏Å</option>
                        <option value="grandchild">‡∏´‡∏•‡∏≤‡∏ô</option>
                        <option value="sibling">‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á</option>
                        <option value="spouse">‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™</option>
                        <option value="caregiver">‡∏Ñ‡∏ô‡∏î‡∏π‡πÅ‡∏•</option>
                        <option value="friend">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                    <input type="text" id="caregiverLinkCode" placeholder="123456" maxlength="6">
                </div>

                <button onclick="registerCaregiver()">Register Caregiver</button>
                <div id="caregiverResponse" class="response" style="display:none;"></div>
            </div>
        </div>

        <!-- Link Code Tab -->
        <div id="link-tab" class="tab-content">
            <div class="cards">
                <div class="card">
                    <h2>üîó Generate Link Code <span class="badge post">POST</span></h2>
                    <div class="form-group">
                        <label>Patient ID</label>
                        <input type="text" id="linkPatientId" placeholder="uuid-from-registration">
                    </div>
                    <button onclick="generateLinkCode()">Generate Code</button>
                    <div id="linkResponse" class="response" style="display:none;"></div>
                </div>

                <div class="card">
                    <h2>‚úÖ Approve Caregiver <span class="badge post">POST</span></h2>
                    <div class="form-group">
                        <label>Relationship ID</label>
                        <input type="text" id="relationshipId" placeholder="uuid-from-link">
                    </div>
                    <div class="form-group">
                        <label>Action</label>
                        <select id="approveAction">
                            <option value="true">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Approve)</option>
                            <option value="false">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò (Reject)</option>
                        </select>
                    </div>
                    <button onclick="approveCaregiver()">Submit</button>
                    <div id="approveResponse" class="response" style="display:none;"></div>
                </div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div id="profile-tab" class="tab-content">
            <div class="cards">
                <div class="card">
                    <h2>üë§ Get Patient Profile <span class="badge get">GET</span></h2>
                    <div class="form-group">
                        <label>Patient ID</label>
                        <input type="text" id="getPatientId" placeholder="uuid">
                    </div>
                    <button onclick="getPatientProfile()">Get Profile</button>
                    <div id="getPatientResponse" class="response" style="display:none;"></div>
                </div>

                <div class="card">
                    <h2>üìã Get Health Goals <span class="badge get">GET</span></h2>
                    <div class="form-group">
                        <label>Patient ID</label>
                        <input type="text" id="getGoalsPatientId" placeholder="uuid">
                    </div>
                    <button onclick="getHealthGoals()">Get Goals</button>
                    <div id="getGoalsResponse" class="response" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const getApiBase = () => document.getElementById('apiBase').value;

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        async function apiCall(endpoint, method, body, responseElementId) {
            const startTime = performance.now();
            const responseEl = document.getElementById(responseElementId);
            responseEl.style.display = 'block';
            responseEl.className = 'response';
            responseEl.innerHTML = '<div class="loading"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';

            try {
                const url = endpoint.startsWith('http') ? endpoint : getApiBase() + endpoint;

                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };

                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(url, options);
                const data = await response.json();
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(0);

                responseEl.className = response.ok ? 'response success' : 'response error';
                responseEl.innerHTML = `
                    <div class="response-header">
                        <strong>${response.ok ? '‚úÖ Success' : '‚ùå Error'} (${response.status})</strong>
                        <span class="response-time">${duration}ms</span>
                    </div>
                    ${JSON.stringify(data, null, 2)}
                `;

                // Store IDs for easy reference
                if (data.profile?.id) {
                    localStorage.setItem('lastPatientId', data.profile.id);
                }
                if (data.relationship?.id) {
                    localStorage.setItem('lastRelationshipId', data.relationship.id);
                }

            } catch (error) {
                responseEl.className = 'response error';
                responseEl.innerHTML = `
                    <div class="response-header">
                        <strong>‚ùå Network Error</strong>
                    </div>
                    ${error.message}
                `;
            }
        }

        async function checkUser() {
            const lineUserId = document.getElementById('checkLineUserId').value;
            await apiCall('/check', 'POST', { lineUserId }, 'checkResponse');
        }

        async function registerPatient() {
            const diseases = document.getElementById('patientDiseases').value
                .split(',').map(d => d.trim()).filter(d => d);

            const body = {
                lineUserId: document.getElementById('patientLineUserId').value,
                displayName: document.getElementById('patientDisplayName').value,
                firstName: document.getElementById('patientFirstName').value,
                lastName: document.getElementById('patientLastName').value,
                birthDate: document.getElementById('patientBirthDate').value,
                gender: document.getElementById('patientGender').value,
                weightKg: parseFloat(document.getElementById('patientWeight').value) || undefined,
                heightCm: parseFloat(document.getElementById('patientHeight').value) || undefined,
                chronicDiseases: diseases,
                emergencyContactName: document.getElementById('patientEmergencyName').value,
                emergencyContactPhone: document.getElementById('patientEmergencyPhone').value,
                emergencyContactRelation: '‡∏•‡∏π‡∏Å'
            };

            await apiCall('/patient', 'POST', body, 'patientResponse');
        }

        async function registerCaregiver() {
            const body = {
                lineUserId: document.getElementById('caregiverLineUserId').value,
                displayName: document.getElementById('caregiverDisplayName').value,
                firstName: document.getElementById('caregiverFirstName').value,
                lastName: document.getElementById('caregiverLastName').value,
                relationship: document.getElementById('caregiverRelationship').value,
                linkCode: document.getElementById('caregiverLinkCode').value || undefined
            };

            await apiCall('/caregiver', 'POST', body, 'caregiverResponse');
        }

        async function generateLinkCode() {
            const patientId = document.getElementById('linkPatientId').value ||
                             localStorage.getItem('lastPatientId');

            if (!patientId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Patient ID ‡∏´‡∏£‡∏∑‡∏≠ register patient ‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            await apiCall('/generate-link-code', 'POST', { patientId }, 'linkResponse');
        }

        async function approveCaregiver() {
            const relationshipId = document.getElementById('relationshipId').value ||
                                  localStorage.getItem('lastRelationshipId');

            if (!relationshipId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Relationship ID');
                return;
            }

            const approved = document.getElementById('approveAction').value === 'true';
            await apiCall('/approve-caregiver', 'POST', { relationshipId, approved }, 'approveResponse');
        }

        async function getPatientProfile() {
            const patientId = document.getElementById('getPatientId').value ||
                            localStorage.getItem('lastPatientId');

            if (!patientId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Patient ID');
                return;
            }

            await apiCall(`/profile/patient/${patientId}`, 'GET', null, 'getPatientResponse');
        }

        async function getHealthGoals() {
            const patientId = document.getElementById('getGoalsPatientId').value ||
                            localStorage.getItem('lastPatientId');

            if (!patientId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Patient ID');
                return;
            }

            await apiCall(`/health-goals/${patientId}`, 'GET', null, 'getGoalsResponse');
        }

        // Auto-fill last used IDs
        window.addEventListener('load', () => {
            const lastPatientId = localStorage.getItem('lastPatientId');
            if (lastPatientId) {
                document.getElementById('linkPatientId').placeholder = lastPatientId;
                document.getElementById('getPatientId').placeholder = lastPatientId;
                document.getElementById('getGoalsPatientId').placeholder = lastPatientId;
            }

            const lastRelationshipId = localStorage.getItem('lastRelationshipId');
            if (lastRelationshipId) {
                document.getElementById('relationshipId').placeholder = lastRelationshipId;
            }
        });
    </script>
</body>
</html>
