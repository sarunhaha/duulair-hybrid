<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#10B981">
  <title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - OONJAI</title>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link rel="stylesheet" href="css/minimal-theme.css">
  <style>
    /* Header styles */
    .page-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
      padding-bottom: var(--spacing-md);
      border-bottom: 1px solid rgba(0,0,0,0.08);
    }

    .back-btn {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      border: none;
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-primary);
    }

    .back-btn:active {
      transform: scale(0.95);
      background: rgba(0,0,0,0.1);
    }

    .page-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      margin-bottom: 6px;
      color: var(--text-primary);
      font-weight: 500;
      font-size: 14px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 16px;
      box-sizing: border-box;
      background: var(--bg-card);
      color: var(--text-primary);
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: var(--accent-primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }
    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      padding-bottom: 32px;
    }
    .btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    .btn-save {
      background: var(--accent-primary);
      color: white;
    }
    .btn-save:active {
      background: var(--accent-secondary);
      transform: scale(0.98);
    }
    .btn-cancel {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }
    .btn-cancel:active {
      background: rgba(0,0,0,0.1);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .section-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid var(--accent-primary);
      color: var(--text-primary);
    }
    .success-message {
      background: #D1FAE5;
      border: 1px solid #A7F3D0;
      color: #065F46;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      margin-bottom: 16px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Loading State -->
    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <!-- Error Message -->
    <div id="error" class="alert alert-error" style="display: none;"></div>

    <!-- Success Message -->
    <div id="success" class="success-message"></div>

    <!-- Edit Form -->
    <div id="edit-form" style="display: none;">
      <!-- Header -->
      <div class="page-header">
        <button class="back-btn" onclick="goBack()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
        </button>
        <h1 class="page-title" id="page-title">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h1>
      </div>

      <!-- Basic Info Section -->
      <div id="section-basic" class="card" style="display: none;">
        <div class="section-title">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</div>
        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠</label>
          <input type="text" id="first_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠">
        </div>
        <div class="form-group">
          <label>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
          <input type="text" id="last_name" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
        </div>
        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
          <input type="text" id="nickname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
        </div>
        <div class="form-group">
          <label>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label>
          <input type="date" id="birth_date">
        </div>
        <div class="form-group">
          <label>‡πÄ‡∏û‡∏®</label>
          <select id="gender">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏®</option>
            <option value="male">‡∏ä‡∏≤‡∏¢</option>
            <option value="female">‡∏´‡∏ç‡∏¥‡∏á</option>
            <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
          <input type="tel" id="phone_number" placeholder="0812345678">
        </div>
        <div class="form-group">
          <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
          <textarea id="address" rows="3" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏ñ‡∏ô‡∏ô ‡∏ï‡∏≥‡∏ö‡∏• ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå"></textarea>
        </div>
      </div>

      <!-- Medical Info Section -->
      <div id="section-medical" class="card" style="display: none;">
        <div class="section-title">üè• ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</div>
        <div class="form-group">
          <label>‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î</label>
          <select id="blood_type">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î</option>
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="O">O</option>
            <option value="AB">AB</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
          <input type="number" id="weight_kg" placeholder="60" step="0.1">
        </div>
        <div class="form-group">
          <label>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</label>
          <input type="number" id="height_cm" placeholder="170">
        </div>
        <div class="form-group">
          <label>‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
          <textarea id="medical_condition" rows="3" placeholder="‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß..."></textarea>
        </div>
        <div class="form-group">
          <label>‡πÇ‡∏£‡∏Ñ‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ)</label>
          <textarea id="chronic_diseases" rows="3" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á, ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô..."></textarea>
        </div>
        <div class="form-group">
          <label>‡πÅ‡∏û‡πâ‡∏¢‡∏≤</label>
          <textarea id="drug_allergies" rows="2" placeholder="‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏û‡πâ..."></textarea>
        </div>
        <div class="form-group">
          <label>‡πÅ‡∏û‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
          <textarea id="food_allergies" rows="2" placeholder="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏û‡πâ..."></textarea>
        </div>
      </div>

      <!-- Emergency Contact Section -->
      <div id="section-emergency" class="card" style="display: none;">
        <div class="section-title">üìû ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</div>
        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</label>
          <input type="text" id="emergency_contact_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
        </div>
        <div class="form-group">
          <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</label>
          <select id="emergency_contact_relation">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
            <option value="‡∏•‡∏π‡∏Å">‡∏•‡∏π‡∏Å</option>
            <option value="‡∏•‡∏π‡∏Å‡∏™‡∏∞‡πÉ‡∏†‡πâ">‡∏•‡∏π‡∏Å‡∏™‡∏∞‡πÉ‡∏†‡πâ</option>
            <option value="‡∏•‡∏π‡∏Å‡πÄ‡∏Ç‡∏¢">‡∏•‡∏π‡∏Å‡πÄ‡∏Ç‡∏¢</option>
            <option value="‡∏´‡∏•‡∏≤‡∏ô">‡∏´‡∏•‡∏≤‡∏ô</option>
            <option value="‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™">‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™</option>
            <option value="‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á">‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á</option>
            <option value="‡∏ç‡∏≤‡∏ï‡∏¥">‡∏ç‡∏≤‡∏ï‡∏¥</option>
            <option value="‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</option>
            <option value="‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</option>
            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
          <input type="tel" id="emergency_contact_phone" placeholder="0812345678">
        </div>
      </div>

      <!-- Hospital Section -->
      <div id="section-hospital" class="card" style="display: none;">
        <div class="section-title">üè® ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏û‡∏ó‡∏¢‡πå</div>
        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</label>
          <input type="text" id="hospital_name" placeholder="‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•...">
        </div>
        <div class="form-group">
          <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</label>
          <input type="tel" id="hospital_phone" placeholder="02-xxx-xxxx">
        </div>
        <div class="form-group">
          <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</label>
          <textarea id="medical_notes" rows="3" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn btn-cancel" onclick="goBack()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn btn-save" id="save-btn" onclick="saveChanges()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </div>
  </div>

  <!-- API Client -->
  <script src="js/api.js"></script>

  <script>
    let currentPatientId = null;
    let currentSection = null;
    let originalData = null;

    // Get params from URL
    const urlParams = new URLSearchParams(window.location.search);
    currentPatientId = urlParams.get('patient_id');
    currentSection = urlParams.get('section') || 'basic';

    // Initialize page
    async function init() {
      if (!currentPatientId) {
        showError('‡πÑ‡∏°‡πà‡∏û‡∏ö Patient ID');
        return;
      }

      // Set page title
      const sectionTitles = {
        basic: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô',
        medical: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå',
        emergency: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô',
        hospital: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•'
      };
      document.getElementById('page-title').textContent = sectionTitles[currentSection] || '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';

      // Show relevant section
      document.getElementById(`section-${currentSection}`).style.display = 'block';

      // Load patient data
      await loadPatientData();
    }

    async function loadPatientData() {
      try {
        const response = await fetch(`${API_BASE_URL}/patient/${currentPatientId}`);
        const result = await response.json();

        if (!result.success || !result.profile) {
          throw new Error(result.error || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢');
        }

        originalData = result.profile;
        populateForm(result.profile);

        document.getElementById('loading').style.display = 'none';
        document.getElementById('edit-form').style.display = 'block';

      } catch (error) {
        console.error('Error loading patient:', error);
        showError(error.message);
      }
    }

    function populateForm(patient) {
      // Basic Info
      if (currentSection === 'basic') {
        document.getElementById('first_name').value = patient.first_name || '';
        document.getElementById('last_name').value = patient.last_name || '';
        document.getElementById('nickname').value = patient.nickname || '';
        document.getElementById('birth_date').value = patient.birth_date || '';
        document.getElementById('gender').value = patient.gender || '';
        document.getElementById('phone_number').value = patient.phone_number || '';
        document.getElementById('address').value = patient.address || '';
      }

      // Medical Info
      if (currentSection === 'medical') {
        document.getElementById('blood_type').value = patient.blood_type || '';
        document.getElementById('weight_kg').value = patient.weight_kg || '';
        document.getElementById('height_cm').value = patient.height_cm || '';
        document.getElementById('medical_condition').value = patient.medical_condition || '';
        document.getElementById('chronic_diseases').value =
          Array.isArray(patient.chronic_diseases) ? patient.chronic_diseases.join(', ') : (patient.chronic_diseases || '');
        document.getElementById('drug_allergies').value = patient.drug_allergies || '';
        document.getElementById('food_allergies').value = patient.food_allergies || '';
      }

      // Emergency Contact
      if (currentSection === 'emergency') {
        document.getElementById('emergency_contact_name').value = patient.emergency_contact_name || '';
        document.getElementById('emergency_contact_relation').value = patient.emergency_contact_relation || '';
        document.getElementById('emergency_contact_phone').value = patient.emergency_contact_phone || '';
      }

      // Hospital
      if (currentSection === 'hospital') {
        document.getElementById('hospital_name').value = patient.hospital_name || '';
        document.getElementById('hospital_phone').value = patient.hospital_phone || '';
        document.getElementById('medical_notes').value = patient.medical_notes || '';
      }
    }

    function getFormData() {
      const data = {};

      if (currentSection === 'basic') {
        data.first_name = document.getElementById('first_name').value.trim();
        data.last_name = document.getElementById('last_name').value.trim();
        data.nickname = document.getElementById('nickname').value.trim() || null;
        data.birth_date = document.getElementById('birth_date').value || null;
        data.gender = document.getElementById('gender').value || null;
        data.phone_number = document.getElementById('phone_number').value.trim() || null;
        data.address = document.getElementById('address').value.trim() || null;
      }

      if (currentSection === 'medical') {
        data.blood_type = document.getElementById('blood_type').value || null;
        const weight = document.getElementById('weight_kg').value;
        data.weight_kg = weight ? parseFloat(weight) : null;
        const height = document.getElementById('height_cm').value;
        data.height_cm = height ? parseFloat(height) : null;
        data.medical_condition = document.getElementById('medical_condition').value.trim() || null;
        const chronicStr = document.getElementById('chronic_diseases').value.trim();
        data.chronic_diseases = chronicStr ? chronicStr.split(',').map(s => s.trim()).filter(s => s) : null;
        const drugStr = document.getElementById('drug_allergies').value.trim();
        data.drug_allergies = drugStr ? drugStr.split(',').map(s => s.trim()).filter(s => s) : null;
        const foodStr = document.getElementById('food_allergies').value.trim();
        data.food_allergies = foodStr ? foodStr.split(',').map(s => s.trim()).filter(s => s) : null;
      }

      if (currentSection === 'emergency') {
        data.emergency_contact_name = document.getElementById('emergency_contact_name').value.trim() || null;
        data.emergency_contact_relation = document.getElementById('emergency_contact_relation').value.trim() || null;
        data.emergency_contact_phone = document.getElementById('emergency_contact_phone').value.trim() || null;
      }

      if (currentSection === 'hospital') {
        data.hospital_name = document.getElementById('hospital_name').value.trim() || null;
        data.hospital_phone = document.getElementById('hospital_phone').value.trim() || null;
        data.medical_notes = document.getElementById('medical_notes').value.trim() || null;
      }

      return data;
    }

    async function saveChanges() {
      const saveBtn = document.getElementById('save-btn');
      saveBtn.disabled = true;
      saveBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

      try {
        const formData = getFormData();
        console.log('Saving data:', formData);

        const response = await fetch(`${API_BASE_URL}/patient/${currentPatientId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (!result.success) {
          throw new Error(result.error || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
        }

        // Show success
        const successEl = document.getElementById('success');
        successEl.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
        successEl.style.display = 'block';

        // Go back after delay
        setTimeout(() => {
          goBack();
        }, 1500);

      } catch (error) {
        console.error('Error saving:', error);
        showError(error.message);
        saveBtn.disabled = false;
        saveBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
      }
    }

    function showError(message) {
      document.getElementById('loading').style.display = 'none';
      const errorEl = document.getElementById('error');
      errorEl.textContent = message;
      errorEl.style.display = 'block';
    }

    function goBack() {
      // Map section to tab name for patient-profile.html
      const tabMap = {
        basic: 'personal',
        medical: 'medical',
        emergency: 'emergency',
        hospital: 'hospital'
      };
      const tab = tabMap[currentSection] || 'personal';
      window.location.href = `patient-profile.html?tab=${tab}`;
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
