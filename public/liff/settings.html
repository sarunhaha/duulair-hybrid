<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ - Duulair</title>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      color: #333;
      padding: 30px 20px;
      text-align: center;
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 5px;
    }

    .header p {
      font-size: 14px;
      opacity: 0.8;
    }

    .content {
      padding: 30px 20px;
    }

    .section {
      margin-bottom: 30px;
    }

    .section-header {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .setting-card {
      background: #f9f9f9;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .setting-row:last-child {
      border-bottom: none;
    }

    .setting-label {
      font-size: 15px;
      color: #333;
      font-weight: 500;
    }

    .setting-description {
      font-size: 13px;
      color: #666;
      margin-top: 3px;
    }

    .toggle-switch {
      position: relative;
      width: 60px;
      height: 30px;
      background: #ccc;
      border-radius: 30px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-switch.active {
      background: #4caf50;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: white;
      top: 2px;
      left: 2px;
      transition: left 0.3s;
    }

    .toggle-switch.active::after {
      left: 32px;
    }

    .member-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .member-card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 2px solid #e0e0e0;
    }

    .member-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .member-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 16px;
    }

    .member-details .name {
      font-weight: 600;
      color: #333;
    }

    .member-details .role {
      font-size: 12px;
      color: #666;
      margin-top: 2px;
    }

    .role-badge {
      padding: 5px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .role-badge.primary {
      background: #ffd700;
      color: #333;
    }

    .role-badge.member {
      background: #e0e0e0;
      color: #666;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      font-family: inherit;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-danger {
      background: #f44336;
      color: white;
    }

    .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .info-box .title {
      font-weight: 600;
      color: #1976d2;
      margin-bottom: 5px;
    }

    .info-box .content {
      color: #555;
      font-size: 14px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .alert {
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .link-code-display {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      margin-bottom: 20px;
    }

    .link-code-display .label {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .link-code-display .code {
      font-size: 36px;
      font-weight: 700;
      letter-spacing: 5px;
      font-family: 'Courier New', monospace;
    }

    .tabs {
      display: flex;
      border-bottom: 2px solid #e0e0e0;
      margin-bottom: 20px;
    }

    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
      font-weight: 500;
      color: #666;
      font-size: 14px;
    }

    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h1>
      <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
    </div>

    <div class="content">
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
      </div>

      <div id="error" class="alert alert-error" style="display: none;"></div>
      <div id="success" class="alert alert-success" style="display: none;"></div>

      <div id="main-content" style="display: none;">
        <div class="tabs">
          <div class="tab active" data-tab="group">‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
          <div class="tab" data-tab="notifications">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
          <div class="tab" data-tab="reports">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
          <div class="tab" data-tab="packages">‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à</div>
          <div class="tab" data-tab="help">‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
        </div>

        <!-- Group Tab -->
        <div id="group-tab" class="tab-content active">
          <div class="link-code-display">
            <div class="label">‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏•‡∏∏‡πà‡∏° (Link Code)</div>
            <div class="code" id="linkCode">------</div>
          </div>

          <div class="info-box">
            <div class="title">‚ÑπÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡∏¥‡∏ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
            <div class="content">
              ‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡∏ö‡∏≠‡∏ó ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏≠‡∏ó‡∏à‡∏∞‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            </div>
          </div>

          <div class="section">
            <div class="section-header">üë• ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
            <div id="member-list" class="member-list"></div>
          </div>

          <div class="section">
            <div class="section-header">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
            <form id="group-form">
              <div class="form-group">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°</label>
                <input type="text" id="groupName" required>
              </div>

              <button type="submit" class="btn btn-primary">
                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°
              </button>
            </form>
          </div>
        </div>

        <!-- Notifications Tab -->
        <div id="notifications-tab" class="tab-content">
          <div class="section">
            <div class="section-header">üîî ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>

            <div class="setting-card">
              <div class="setting-row">
                <div>
                  <div class="setting-label">‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤</div>
                  <div class="setting-description">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤</div>
                </div>
                <div class="toggle-switch active" data-setting="medication_reminders"></div>
              </div>

              <div class="setting-row">
                <div>
                  <div class="setting-label">‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô</div>
                  <div class="setting-description">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡∏±‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ä‡∏µ‡∏û</div>
                </div>
                <div class="toggle-switch active" data-setting="vitals_reminders"></div>
              </div>

              <div class="setting-row">
                <div>
                  <div class="setting-label">‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥</div>
                  <div class="setting-description">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å 2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</div>
                </div>
                <div class="toggle-switch active" data-setting="water_reminders"></div>
              </div>

              <div class="setting-row">
                <div>
                  <div class="setting-label">‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</div>
                  <div class="setting-description">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</div>
                </div>
                <div class="toggle-switch active" data-setting="exercise_reminders"></div>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">üì¢ ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</div>

            <div class="setting-card">
              <div class="setting-row">
                <div>
                  <div class="setting-label">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
                  <div class="setting-description">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
                </div>
                <div class="toggle-switch active" data-setting="activity_notifications"></div>
              </div>

              <div class="setting-row">
                <div>
                  <div class="setting-label">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</div>
                  <div class="setting-description">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô</div>
                </div>
                <div class="toggle-switch active" data-setting="emergency_notifications"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports-tab" class="tab-content">
          <div class="section">
            <div class="section-header">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>

            <div class="setting-card">
              <div class="setting-row">
                <div>
                  <div class="setting-label">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</div>
                  <div class="setting-description">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏ß‡∏•‡∏≤ 20:00</div>
                </div>
                <div class="toggle-switch active" data-setting="daily_report"></div>
              </div>

              <div class="setting-row">
                <div>
                  <div class="setting-label">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
                  <div class="setting-description">‡∏™‡πà‡∏á‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‡πÄ‡∏ß‡∏•‡∏≤ 20:00</div>
                </div>
                <div class="toggle-switch active" data-setting="weekly_report"></div>
              </div>

              <div class="setting-row">
                <div>
                  <div class="setting-label">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                  <div class="setting-description">‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                </div>
                <div class="toggle-switch" data-setting="monthly_report"></div>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">üë• ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>

            <div class="setting-card">
              <div class="setting-row">
                <div>
                  <div class="setting-label">‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
                  <div class="setting-description">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° LINE</div>
                </div>
                <div class="toggle-switch active" data-setting="send_to_group"></div>
              </div>

              <div class="setting-row">
                <div>
                  <div class="setting-label">‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏±‡∏Å</div>
                  <div class="setting-description">‡∏™‡πà‡∏á‡∏ó‡∏≤‡∏á 1:1 chat</div>
                </div>
                <div class="toggle-switch active" data-setting="send_to_primary"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Packages Tab -->
        <div id="packages-tab" class="tab-content">
          <div class="section">
            <div class="section-header">üíé ‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à Duulair</div>

            <!-- Free Plan -->
            <div class="setting-card" style="border: 2px solid #e0e0e0;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div>
                  <h3 style="font-size: 20px; color: #333; margin-bottom: 5px;">‡∏ü‡∏£‡∏µ</h3>
                  <div style="font-size: 24px; font-weight: 700; color: #667eea;">‡∏ø0<span style="font-size: 14px; font-weight: normal; color: #666;">/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span></div>
                </div>
                <div style="background: #4caf50; color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600;">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</div>
              </div>

              <div style="color: #666; font-size: 14px; margin-bottom: 15px;">‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å</div>

              <div style="border-top: 1px solid #e0e0e0; padding-top: 15px;">
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #4caf50;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">1 ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #4caf50;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #4caf50;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #4caf50;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #4caf50;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</span>
                </div>
              </div>
            </div>

            <!-- Pro Plan -->
            <div class="setting-card" style="border: 2px solid #667eea; position: relative;">
              <div style="position: absolute; top: -12px; right: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 5px 15px; border-radius: 15px; font-size: 12px; font-weight: 600;">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>

              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div>
                  <h3 style="font-size: 20px; color: #667eea; margin-bottom: 5px;">Pro</h3>
                  <div style="font-size: 24px; font-weight: 700; color: #667eea;">‡∏ø299<span style="font-size: 14px; font-weight: normal; color: #666;">/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span></div>
                </div>
              </div>

              <div style="color: #666; font-size: 14px; margin-bottom: 15px;">‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö</div>

              <div style="border-top: 1px solid #e0e0e0; padding-top: 15px;">
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #667eea;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏ö Free ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #667eea;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô + ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #667eea;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PDF/CSV</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #667eea;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ)</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #667eea;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">AI Insights & ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #667eea;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">Support ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</span>
                </div>
              </div>

              <button class="btn btn-primary" style="margin-top: 15px;" disabled>
                ‡πÄ‡∏£‡πá‡∏ß ‡πÜ ‡∏ô‡∏µ‡πâ
              </button>
            </div>

            <!-- Enterprise Plan -->
            <div class="setting-card" style="border: 2px solid #ffd700;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div>
                  <h3 style="font-size: 20px; color: #f39c12; margin-bottom: 5px;">Enterprise</h3>
                  <div style="font-size: 18px; font-weight: 600; color: #333;">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</div>
                </div>
              </div>

              <div style="color: #666; font-size: 14px; margin-bottom: 15px;">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•/‡∏™‡∏ñ‡∏≤‡∏ô‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</div>

              <div style="border-top: 1px solid #e0e0e0; padding-top: 15px;">
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #f39c12;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #f39c12;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">API Access</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #f39c12;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">Custom Integration</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #f39c12;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">Dedicated Support</span>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                  <span style="color: #f39c12;">‚úì</span>
                  <span style="font-size: 14px; color: #333;">On-premise Option</span>
                </div>
              </div>

              <button class="btn btn-primary" style="margin-top: 15px; background: #f39c12;" disabled>
                ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢
              </button>
            </div>
          </div>
        </div>

        <!-- Help Tab -->
        <div id="help-tab" class="tab-content">
          <div class="section">
            <div class="section-header">‚ùì ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢ (FAQ)</div>

            <!-- FAQ 1 -->
            <div class="setting-card">
              <div style="font-weight: 600; color: #333; margin-bottom: 10px;">üîç Duulair ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</div>
              <div style="color: #666; font-size: 14px; line-height: 1.6;">
                Duulair ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡πÑ‡∏î‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô
              </div>
            </div>

            <!-- FAQ 2 -->
            <div class="setting-card">
              <div style="font-weight: 600; color: #333; margin-bottom: 10px;">üë• ‡πÉ‡∏Ñ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ?</div>
              <div style="color: #666; font-size: 14px; line-height: 1.6;">
                ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° LINE ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏
              </div>
            </div>

            <!-- FAQ 3 -->
            <div class="setting-card">
              <div style="font-weight: 600; color: #333; margin-bottom: 10px;">üì± ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á?</div>
              <div style="color: #666; font-size: 14px; line-height: 1.6;">
                1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏≠‡∏ó Duulair ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° LINE<br>
                2. ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢<br>
                3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ú‡πà‡∏≤‡∏ô Rich Menu<br>
                4. ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
              </div>
            </div>

            <!-- FAQ 4 -->
            <div class="setting-card">
              <div style="font-weight: 600; color: #333; margin-bottom: 10px;">üí∞ ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?</div>
              <div style="color: #666; font-size: 14px; line-height: 1.6;">
                ‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à Free ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ü‡∏£‡∏µ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏û! ‡∏°‡∏µ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Ñ‡∏£‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏õ‡πá‡∏ô Pro ‡πÑ‡∏î‡πâ
              </div>
            </div>

            <!-- FAQ 5 -->
            <div class="setting-card">
              <div style="font-weight: 600; color: #333; margin-bottom: 10px;">üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</div>
              <div style="color: #666; font-size: 14px; line-height: 1.6;">
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏ö‡∏ô Supabase ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏≤‡∏Å‡∏• ‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°
              </div>
            </div>

            <!-- FAQ 6 -->
            <div class="setting-card">
              <div style="font-weight: 600; color: #333; margin-bottom: 10px;">üîî ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°?</div>
              <div style="color: #666; font-size: 14px; line-height: 1.6;">
                ‡πÑ‡∏î‡πâ! ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö "‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô" ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</div>

            <div class="setting-card">
              <div style="margin-bottom: 15px;">
                <div style="font-weight: 600; color: #333; margin-bottom: 5px;">üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>
                <a href="mailto:support@duulair.com" style="color: #667eea; text-decoration: none;">support@duulair.com</a>
              </div>

              <div style="margin-bottom: 15px;">
                <div style="font-weight: 600; color: #333; margin-bottom: 5px;">üí¨ LINE Official</div>
                <a href="https://line.me/R/ti/p/@duulair" style="color: #667eea; text-decoration: none; display: flex; align-items: center; gap: 5px;">
                  @duulair
                  <span style="font-size: 12px; color: #999;">(‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£)</span>
                </a>
              </div>

              <div style="margin-bottom: 15px;">
                <div style="font-weight: 600; color: #333; margin-bottom: 5px;">üåê ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</div>
                <a href="https://duulair.com" style="color: #667eea; text-decoration: none;">www.duulair.com</a>
              </div>

              <div>
                <div style="font-weight: 600; color: #333; margin-bottom: 5px;">‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</div>
                <div style="color: #666; font-size: 14px;">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå - ‡∏®‡∏∏‡∏Å‡∏£‡πå: 9:00 - 18:00 ‡∏ô.</div>
              </div>
            </div>
          </div>

          <div class="section">
            <div class="section-header">‚ÑπÔ∏è ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Duulair</div>

            <div class="setting-card">
              <div style="text-align: center; padding: 20px 0;">
                <div style="font-size: 48px; margin-bottom: 10px;">üíö</div>
                <div style="font-weight: 600; font-size: 18px; color: #333; margin-bottom: 10px;">Duulair</div>
                <div style="color: #666; font-size: 14px; line-height: 1.6; margin-bottom: 15px;">
                  ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß<br>
                  ‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
                </div>
                <div style="color: #999; font-size: 12px;">Version 1.0.0</div>
                <div style="color: #999; font-size: 12px;">¬© 2025 Duulair. All rights reserved.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const SUPABASE_URL = 'https://xibtslxxjxossybxisdr.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhpYnRzbHh4anhvc3N5Ynhpc2RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzMTczNjgsImV4cCI6MjA3NTg5MzM2OH0.P_W3mfi5JfumRppBckAYNR70Y-GiOpelqYYpwD6Jhdc';
    const LIFF_ID = '2008278683-5k69jxNq';
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let liffId = null;
    let groupId = null;
    let groupData = null;
    let userData = null;
    let settings = {};
    let isGroupContext = false;

    // Initialize LIFF
    async function initializeLiff() {
      try {
        await liff.init({ liffId: LIFF_ID });

        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        const context = liff.getContext();
        isGroupContext = context && context.type === 'group';

        if (isGroupContext) {
          // Group context - load group settings
          groupId = context.groupId;
          await loadGroupData();
        } else {
          // 1:1 context - load user settings
          await loadUserData();
        }
      } catch (error) {
        console.error('LIFF initialization failed:', error);
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡πÑ‡∏î‡πâ');
      }
    }

    // Load group data (Group context)
    async function loadGroupData() {
      try {
        // Get group data
        const { data: group, error: groupError } = await supabaseClient
          .from('caregiver_groups')
          .select('*, group_members(*)')
          .eq('line_group_id', groupId)
          .single();

        if (groupError) throw groupError;
        if (!group) {
          showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
          return;
        }

        groupData = group;
        settings = group.settings || {};

        // Populate UI
        document.getElementById('linkCode').textContent = group.link_code;
        document.getElementById('groupName').value = group.group_name || '';

        // Render members
        renderMembers(group.group_members || []);

        // Set toggle switches
        initializeToggles();

        document.getElementById('loading').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
      } catch (error) {
        console.error('Error loading data:', error);
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
      }
    }

    // Load user data (1:1 context)
    async function loadUserData() {
      try {
        // Get user data from localStorage
        const storedUserData = JSON.parse(localStorage.getItem('duulair_user') || '{}');

        if (!storedUserData.profile_id) {
          showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
          setTimeout(() => {
            window.location.href = '/liff/index.html';
          }, 2000);
          return;
        }

        userData = storedUserData;

        // Get patient profile with settings
        const { data: profile, error } = await supabaseClient
          .from('patient_profiles')
          .select('*')
          .eq('id', userData.profile_id)
          .single();

        if (error) throw error;

        settings = profile.settings || {};

        // Hide group-specific sections
        const linkCodeSection = document.querySelector('.link-code-display');
        const groupTab = document.querySelector('[data-tab="group"]');
        const membersTab = document.querySelector('[data-tab="members"]');

        if (linkCodeSection) linkCodeSection.style.display = 'none';
        if (groupTab) groupTab.style.display = 'none';
        if (membersTab) membersTab.style.display = 'none';

        // Set toggle switches
        initializeToggles();

        document.getElementById('loading').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
      } catch (error) {
        console.error('Error loading user data:', error);
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
      }
    }

    // Render members list
    function renderMembers(members) {
      const container = document.getElementById('member-list');

      container.innerHTML = members.map(member => {
        const initial = (member.display_name || 'U')[0].toUpperCase();
        const roleClass = member.role === 'primary_caregiver' ? 'primary' : 'member';
        const roleText = member.role === 'primary_caregiver' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏±‡∏Å' : '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';

        return `
          <div class="member-card">
            <div class="member-info">
              <div class="member-avatar">${initial}</div>
              <div class="member-details">
                <div class="name">${member.display_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</div>
                <div class="role">${roleText}</div>
              </div>
            </div>
            <span class="role-badge ${roleClass}">${roleText}</span>
          </div>
        `;
      }).join('');
    }

    // Initialize toggles
    function initializeToggles() {
      document.querySelectorAll('.toggle-switch').forEach(toggle => {
        const settingKey = toggle.dataset.setting;

        // Set initial state
        if (settings[settingKey]) {
          toggle.classList.add('active');
        }

        // Add click handler
        toggle.addEventListener('click', async () => {
          const newValue = !toggle.classList.contains('active');
          toggle.classList.toggle('active');

          // Update settings
          settings[settingKey] = newValue;
          await updateSettings();
        });
      });
    }

    // Update settings
    async function updateSettings() {
      try {
        const { error } = await supabaseClient
          .from('caregiver_groups')
          .update({ settings })
          .eq('id', groupData.id);

        if (error) throw error;
      } catch (error) {
        console.error('Error updating settings:', error);
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ');
      }
    }

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;

        // Update tabs
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        // Update content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(`${tabName}-tab`).classList.add('active');
      });
    });

    // Form submission
    document.getElementById('group-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      try {
        const { error } = await supabaseClient
          .from('caregiver_groups')
          .update({
            group_name: document.getElementById('groupName').value
          })
          .eq('id', groupData.id);

        if (error) throw error;

        showSuccess('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
      } catch (error) {
        console.error('Error updating group:', error);
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
      }
    });

    // Alert helpers
    function showSuccess(message) {
      const alert = document.getElementById('success');
      alert.textContent = message;
      alert.style.display = 'block';
      setTimeout(() => { alert.style.display = 'none'; }, 3000);
    }

    function showError(message) {
      const alert = document.getElementById('error');
      alert.textContent = message;
      alert.style.display = 'block';
      document.getElementById('loading').style.display = 'none';
    }

    // Initialize on load
    window.addEventListener('load', initializeLiff);
  </script>
</body>
</html>
