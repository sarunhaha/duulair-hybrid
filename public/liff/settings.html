<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#FAF9F6">
  <title>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ - Duulair</title>
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/utils.js"></script>
  <link rel="stylesheet" href="css/minimal-theme.css">
  <style>
    /* Settings-specific styles */
    .tabs {
      display: flex;
      border-bottom: 2px solid rgba(0, 0, 0, 0.1);
      margin-bottom: var(--spacing-lg);
      gap: var(--spacing-xs);
      overflow-x: auto;
    }

    .tab {
      flex: 1;
      padding: 12px 10px;
      text-align: center;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.2s ease;
      font-weight: 500;
      color: var(--text-secondary);
      font-size: 14px;
      white-space: nowrap;
    }

    .tab.active {
      color: var(--accent-primary);
      border-bottom-color: var(--accent-primary);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.3s;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .section {
      margin-bottom: var(--spacing-xl);
    }

    .section-header {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .setting-card {
      background: var(--bg-card);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      box-shadow: var(--shadow-sm);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-sm) 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      gap: var(--spacing-md);
    }

    .setting-row:last-child {
      border-bottom: none;
    }

    .setting-label {
      font-size: 15px;
      color: var(--text-primary);
      font-weight: 500;
    }

    .setting-description {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 3px;
    }

    .toggle-switch {
      position: relative;
      width: 60px;
      height: 30px;
      background: var(--text-muted);
      border-radius: 30px;
      cursor: pointer;
      transition: background 0.3s;
      flex-shrink: 0;
    }

    .toggle-switch.active {
      background: var(--success);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: white;
      top: 2px;
      left: 2px;
      transition: left 0.3s;
    }

    .toggle-switch.active::after {
      left: 32px;
    }

    .link-code-display {
      background: linear-gradient(135deg, #E8B4A8 0%, #D4A59A 100%);
      color: white;
      padding: var(--spacing-lg);
      border-radius: var(--radius-md);
      text-align: center;
      margin-bottom: var(--spacing-lg);
      box-shadow: var(--shadow-sm);
    }

    .link-code-display .label {
      font-size: 14px;
      opacity: 0.95;
      margin-bottom: var(--spacing-sm);
    }

    .link-code-display .code {
      font-size: 36px;
      font-weight: 700;
      letter-spacing: 5px;
      font-family: 'Courier New', monospace;
    }

    .info-box {
      background: rgba(180, 212, 232, 0.15);
      border-left: 4px solid var(--info);
      padding: var(--spacing-md);
      border-radius: var(--radius-sm);
      margin-bottom: var(--spacing-lg);
    }

    .info-box .title {
      font-weight: 600;
      color: #5A8BA8;
      margin-bottom: 6px;
    }

    .info-box .content {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .member-list {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-sm);
    }

    .member-card {
      background: var(--bg-secondary);
      padding: var(--spacing-md);
      border-radius: var(--radius-sm);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .member-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .member-avatar {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: linear-gradient(135deg, #E8B4A8 0%, #D4A59A 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 16px;
    }

    .member-details .name {
      font-weight: 600;
      color: var(--text-primary);
    }

    .member-details .role {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 2px;
    }

    .role-badge {
      padding: 5px 12px;
      border-radius: var(--radius-full);
      font-size: 12px;
      font-weight: 500;
    }

    .role-badge.primary {
      background: rgba(247, 197, 159, 0.3);
      color: #B88A5F;
    }

    .role-badge.member {
      background: rgba(0, 0, 0, 0.08);
      color: var(--text-muted);
    }

    @media (max-width: 480px) {
      .link-code-display .code {
        font-size: 28px;
        letter-spacing: 3px;
      }

      .tabs {
        gap: 0;
      }

      .tab {
        padding: 10px 6px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Loading State -->
    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <!-- Error & Success Messages -->
    <div id="error" class="alert alert-error" style="display: none;"></div>
    <div id="success" class="alert alert-success" style="display: none;"></div>

    <!-- Main Content -->
    <div id="main-content" class="hidden">
      <!-- Header -->
      <div class="header">
        <h1>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h1>
        <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <div class="tab active" data-tab="group">‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
        <div class="tab" data-tab="reports">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
        <div class="tab" data-tab="packages">‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à</div>
        <div class="tab" data-tab="help">‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
      </div>

      <!-- Group Tab -->
      <div id="group-tab" class="tab-content active">
        <div class="link-code-display">
          <div class="label">‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏•‡∏∏‡πà‡∏° (Link Code)</div>
          <div class="code" id="linkCode">------</div>
        </div>

        <div class="info-box">
          <div class="title">‚ÑπÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡∏¥‡∏ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
          <div class="content">
            ‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏Å‡∏±‡∏ö‡∏ö‡∏≠‡∏ó ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏≠‡∏ó‡∏à‡∏∞‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          </div>
        </div>

        <div class="section">
          <div class="section-header">üë• ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
          <div id="member-list" class="member-list"></div>
        </div>

        <div class="section">
          <div class="section-header">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
          <form id="group-form">
            <div class="form-group">
              <label>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°</label>
              <input type="text" id="groupName" required>
            </div>

            <button type="submit" class="btn btn-primary btn-block">
              üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°
            </button>
          </form>
        </div>
      </div>

      <!-- Reports Tab -->
      <div id="reports-tab" class="tab-content">
        <div class="section">
          <div class="section-header">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>

          <div class="setting-card">
            <div class="setting-row">
              <div>
                <div class="setting-label">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</div>
                <div class="setting-description">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏ß‡∏•‡∏≤ 20:00</div>
              </div>
              <div class="toggle-switch active" data-setting="daily_report"></div>
            </div>

            <div class="setting-row">
              <div>
                <div class="setting-label">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
                <div class="setting-description" id="weekly-report-desc">‡∏™‡πà‡∏á‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‡πÄ‡∏ß‡∏•‡∏≤ 20:00</div>
              </div>
              <div class="toggle-switch active" data-setting="weekly_report"></div>
            </div>

            <div class="setting-row">
              <div>
                <div class="setting-label">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                <div class="setting-description" id="monthly-report-desc">‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
              </div>
              <div class="toggle-switch" data-setting="monthly_report"></div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-header">üë• ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>

          <div class="setting-card">
            <div class="setting-row">
              <div>
                <div class="setting-label">‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
                <div class="setting-description">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° LINE</div>
              </div>
              <div class="toggle-switch active" data-setting="send_to_group"></div>
            </div>

            <div class="setting-row">
              <div>
                <div class="setting-label">‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏±‡∏Å</div>
                <div class="setting-description">‡∏™‡πà‡∏á‡∏ó‡∏≤‡∏á 1:1 chat</div>
              </div>
              <div class="toggle-switch active" data-setting="send_to_primary"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Packages Tab -->
      <div id="packages-tab" class="tab-content">
        <div class="section">
          <div class="section-header">üíé ‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à Duulair</div>

          <!-- Free Plan -->
          <div class="setting-card" style="border: 2px solid rgba(0, 0, 0, 0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
              <div>
                <h3 style="font-size: 20px; color: var(--text-primary); margin-bottom: 6px;">‡∏ü‡∏£‡∏µ</h3>
                <div style="font-size: 24px; font-weight: 700; color: var(--accent-primary);">‡∏ø0<span style="font-size: 14px; font-weight: normal; color: var(--text-secondary);">/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span></div>
              </div>
              <div style="background: var(--success); color: white; padding: 8px 16px; border-radius: var(--radius-full); font-size: 14px; font-weight: 600;">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</div>
            </div>

            <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: var(--spacing-md);">‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å</div>

            <div style="border-top: 1px solid rgba(0, 0, 0, 0.05); padding-top: var(--spacing-md);">
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--success);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">1 ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--success);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--success);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--success);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--success);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</span>
              </div>
            </div>
          </div>

          <!-- Pro Plan -->
          <div class="setting-card" style="border: 2px solid var(--accent-primary); position: relative;">
            <div style="position: absolute; top: -12px; right: 20px; background: linear-gradient(135deg, #E8B4A8 0%, #D4A59A 100%); color: white; padding: 5px 15px; border-radius: var(--radius-full); font-size: 12px; font-weight: 600;">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
              <div>
                <h3 style="font-size: 20px; color: var(--accent-primary); margin-bottom: 6px;">Pro</h3>
                <div style="font-size: 24px; font-weight: 700; color: var(--accent-primary);">‡∏ø299<span style="font-size: 14px; font-weight: normal; color: var(--text-secondary);">/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span></div>
              </div>
            </div>

            <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: var(--spacing-md);">‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö</div>

            <div style="border-top: 1px solid rgba(0, 0, 0, 0.05); padding-top: var(--spacing-md);">
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--accent-primary);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏ö Free ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--accent-primary);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô + ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--accent-primary);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PDF/CSV</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--accent-primary);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ)</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--accent-primary);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">AI Insights & ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--accent-primary);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">Support ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</span>
              </div>
            </div>

            <button class="btn btn-primary btn-block" style="margin-top: var(--spacing-md);" disabled>
              ‡πÄ‡∏£‡πá‡∏ß ‡πÜ ‡∏ô‡∏µ‡πâ
            </button>
          </div>

          <!-- Enterprise Plan -->
          <div class="setting-card" style="border: 2px solid var(--warning);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
              <div>
                <h3 style="font-size: 20px; color: #B88A5F; margin-bottom: 6px;">Enterprise</h3>
                <div style="font-size: 18px; font-weight: 600; color: var(--text-primary);">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</div>
              </div>
            </div>

            <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: var(--spacing-md);">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•/‡∏™‡∏ñ‡∏≤‡∏ô‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</div>

            <div style="border-top: 1px solid rgba(0, 0, 0, 0.05); padding-top: var(--spacing-md);">
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--warning);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--warning);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">API Access</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--warning);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">Custom Integration</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--warning);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">Dedicated Support</span>
              </div>
              <div style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="color: var(--warning);">‚úì</span>
                <span style="font-size: 14px; color: var(--text-primary);">On-premise Option</span>
              </div>
            </div>

            <button class="btn btn-primary btn-block" style="margin-top: var(--spacing-md); background: var(--warning);" disabled>
              ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢
            </button>
          </div>
        </div>
      </div>

      <!-- Help Tab -->
      <div id="help-tab" class="tab-content">
        <div class="section">
          <div class="section-header">‚ùì ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢ (FAQ)</div>

          <!-- FAQ 1 -->
          <div class="setting-card">
            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-sm);">üîç Duulair ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</div>
            <div style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
              Duulair ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡πÑ‡∏î‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô
            </div>
          </div>

          <!-- FAQ 2 -->
          <div class="setting-card">
            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-sm);">üë• ‡πÉ‡∏Ñ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ?</div>
            <div style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
              ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° LINE ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏
            </div>
          </div>

          <!-- FAQ 3 -->
          <div class="setting-card">
            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-sm);">üì± ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á?</div>
            <div style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
              1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏≠‡∏ó Duulair ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° LINE<br>
              2. ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢<br>
              3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ú‡πà‡∏≤‡∏ô Rich Menu<br>
              4. ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            </div>
          </div>

          <!-- FAQ 4 -->
          <div class="setting-card">
            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-sm);">üí∞ ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?</div>
            <div style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
              ‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à Free ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ü‡∏£‡∏µ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏û! ‡∏°‡∏µ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏Ñ‡∏£‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏õ‡πá‡∏ô Pro ‡πÑ‡∏î‡πâ
            </div>
          </div>

          <!-- FAQ 5 -->
          <div class="setting-card">
            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-sm);">üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</div>
            <div style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏ö‡∏ô Supabase ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏≤‡∏Å‡∏• ‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°
            </div>
          </div>

          <!-- FAQ 6 -->
          <div class="setting-card">
            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-sm);">üîî ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°?</div>
            <div style="color: var(--text-secondary); font-size: 14px; line-height: 1.6;">
              ‡πÑ‡∏î‡πâ! ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö "‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô" ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-header">üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</div>

          <div class="setting-card">
            <div style="margin-bottom: var(--spacing-md);">
              <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 6px;">üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>
              <a href="mailto:support@duulair.com" style="color: var(--accent-primary); text-decoration: none;">support@duulair.com</a>
            </div>

            <div style="margin-bottom: var(--spacing-md);">
              <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 6px;">üí¨ LINE Official</div>
              <a href="https://line.me/R/ti/p/@duulair" style="color: var(--accent-primary); text-decoration: none; display: flex; align-items: center; gap: 6px;">
                @duulair
                <span style="font-size: 12px; color: var(--text-muted);">(‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£)</span>
              </a>
            </div>

            <div style="margin-bottom: var(--spacing-md);">
              <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 6px;">üåê ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</div>
              <a href="https://duulair.com" style="color: var(--accent-primary); text-decoration: none;">www.duulair.com</a>
            </div>

            <div>
              <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 6px;">‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</div>
              <div style="color: var(--text-secondary); font-size: 14px;">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå - ‡∏®‡∏∏‡∏Å‡∏£‡πå: 9:00 - 18:00 ‡∏ô.</div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-header">‚ÑπÔ∏è ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Duulair</div>

          <div class="setting-card">
            <div style="text-align: center; padding: var(--spacing-lg) 0;">
              <div style="font-size: 48px; margin-bottom: var(--spacing-sm);">üíö</div>
              <div style="font-weight: 600; font-size: 18px; color: var(--text-primary); margin-bottom: var(--spacing-sm);">Duulair</div>
              <div style="color: var(--text-secondary); font-size: 14px; line-height: 1.6; margin-bottom: var(--spacing-md);">
                ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß<br>
                ‡∏ú‡πà‡∏≤‡∏ô LINE ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
              </div>
              <div style="color: var(--text-muted); font-size: 12px;">Version 1.0.0</div>
              <div style="color: var(--text-muted); font-size: 12px;">¬© 2025 Duulair. All rights reserved.</div>
            </div>
          </div>
        </div>
      </div>

      <button class="btn btn-secondary btn-block mt-3" onclick="liff.closeWindow()">‡∏õ‡∏¥‡∏î</button>
    </div>
  </div>

  <script>
    // Configuration
    const SUPABASE_URL = 'https://xibtslxxjxossybxisdr.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhpYnRzbHh4anhvc3N5Ynhpc2RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzMTczNjgsImV4cCI6MjA3NTg5MzM2OH0.P_W3mfi5JfumRppBckAYNR70Y-GiOpelqYYpwD6Jhdc';
    const LIFF_ID = '2008278683-5k69jxNq';
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let liffId = null;
    let groupId = null;
    let groupData = null;
    let userData = null;
    let settings = {};
    let isGroupContext = false;
    let currentPackage = 'free'; // 'free' or 'plus'
    let reportSettings = null;

    // Initialize LIFF
    async function initializeLiff() {
      try {
        await liff.init({ liffId: LIFF_ID });

        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        // Get user profile
        const profile = await liff.getProfile();

        // Check if user is registered (first-time detection)
        const isRegistered = await checkUserRegistration(profile.userId);

        // If not registered, checkUserRegistration will redirect automatically
        if (!isRegistered) {
          return;
        }

        const context = liff.getContext();
        isGroupContext = context && context.type === 'group';

        if (isGroupContext) {
          // Group context - load group settings
          groupId = context.groupId;
          await loadGroupData();
        } else {
          // 1:1 context - load user settings
          await loadUserData();
        }
      } catch (error) {
        console.error('LIFF initialization failed:', error);
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡πÑ‡∏î‡πâ');
      }
    }

    // Load group data (Group context)
    async function loadGroupData() {
      try {
        // Get group data
        const { data: group, error: groupError } = await supabaseClient
          .from('caregiver_groups')
          .select('*, group_members(*)')
          .eq('line_group_id', groupId)
          .single();

        if (groupError) throw groupError;
        if (!group) {
          showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
          return;
        }

        groupData = group;
        settings = group.settings || {};

        // Populate UI
        document.getElementById('linkCode').textContent = group.link_code;
        document.getElementById('groupName').value = group.group_name || '';

        // Render members
        renderMembers(group.group_members || []);

        // Set toggle switches
        initializeToggles();

        document.getElementById('loading').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
      } catch (error) {
        console.error('Error loading data:', error);
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
      }
    }

    // Load user data (1:1 context)
    async function loadUserData() {
      try {
        // Get user data from localStorage
        const storedUserData = JSON.parse(localStorage.getItem('duulair_user') || '{}');

        if (!storedUserData.profile_id) {
          showError('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
          setTimeout(() => {
            window.location.href = '/liff/group-registration.html';
          }, 2000);
          return;
        }

        userData = storedUserData;

        // ‚úÖ Get patient profile with settings via API (bypasses RLS)
        console.log('üîç Loading patient settings for:', userData.profile_id);

        const response = await fetch(`https://duulair.vercel.app/api/patient/${userData.profile_id}`);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();

        if (!result.success || !result.profile) {
          throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢');
        }

        const profile = result.profile;
        console.log('‚úÖ Patient settings loaded:', profile);

        settings = profile.settings || {};

        // Hide group-specific sections
        const linkCodeSection = document.querySelector('.link-code-display');
        const groupTab = document.querySelector('[data-tab="group"]');
        const membersTab = document.querySelector('[data-tab="members"]');

        if (linkCodeSection) linkCodeSection.style.display = 'none';
        if (groupTab) groupTab.style.display = 'none';
        if (membersTab) membersTab.style.display = 'none';

        // Set toggle switches
        initializeToggles();

        document.getElementById('loading').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
      } catch (error) {
        console.error('Error loading user data:', error);
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
      }
    }

    // Render members list
    function renderMembers(members) {
      const container = document.getElementById('member-list');

      container.innerHTML = members.map(member => {
        const initial = (member.display_name || 'U')[0].toUpperCase();
        const roleClass = member.role === 'primary_caregiver' ? 'primary' : 'member';
        const roleText = member.role === 'primary_caregiver' ? '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏´‡∏•‡∏±‡∏Å' : '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';

        return `
          <div class="member-card">
            <div class="member-info">
              <div class="member-avatar">${initial}</div>
              <div class="member-details">
                <div class="name">${member.display_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</div>
                <div class="role">${roleText}</div>
              </div>
            </div>
            <span class="role-badge ${roleClass}">${roleText}</span>
          </div>
        `;
      }).join('');
    }

    // Initialize toggles
    function initializeToggles() {
      document.querySelectorAll('.toggle-switch').forEach(toggle => {
        const settingKey = toggle.dataset.setting;

        // Set initial state
        if (settings[settingKey]) {
          toggle.classList.add('active');
        }

        // Add click handler
        toggle.addEventListener('click', async () => {
          const newValue = !toggle.classList.contains('active');
          toggle.classList.toggle('active');

          // Update settings
          settings[settingKey] = newValue;
          await updateSettings();
        });
      });
    }

    // Update settings
    async function updateSettings() {
      try {
        const { error } = await supabaseClient
          .from('caregiver_groups')
          .update({ settings })
          .eq('id', groupData.id);

        if (error) throw error;
      } catch (error) {
        console.error('Error updating settings:', error);
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ');
      }
    }

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;

        // Update tabs
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        // Update content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(`${tabName}-tab`).classList.add('active');
      });
    });

    // Form submission
    document.getElementById('group-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      try {
        const { error } = await supabaseClient
          .from('caregiver_groups')
          .update({
            group_name: document.getElementById('groupName').value
          })
          .eq('id', groupData.id);

        if (error) throw error;

        showSuccess('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
      } catch (error) {
        console.error('Error updating group:', error);
        showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
      }
    });

    // Alert helpers
    function showSuccess(message) {
      const alert = document.getElementById('success');
      alert.textContent = message;
      alert.style.display = 'block';
      setTimeout(() => { alert.style.display = 'none'; }, 3000);
    }

    function showError(message) {
      const alert = document.getElementById('error');
      alert.textContent = message;
      alert.style.display = 'block';
      document.getElementById('loading').classList.add('hidden');
    }

    // Initialize on load
    window.addEventListener('load', initializeLiff);
  </script>
</body>
</html>
