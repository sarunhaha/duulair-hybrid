<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#4CAF50">
  <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó - Duulair</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container">
    <h1>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö üëã</h1>
    <p class="text-center mb-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>

    <!-- Loading indicator -->
    <div id="loadingIndicator" class="loading" style="display: none;">
      <div class="spinner"></div>
      <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <!-- Simple Form with Radio Buttons -->
    <form id="roleForm" style="margin-top: 20px;">
      <div class="card" style="padding: 20px;">
        <!-- Patient Option -->
        <label style="display: flex; align-items: flex-start; margin-bottom: 15px; cursor: pointer; padding: 15px; border: 2px solid #ddd; border-radius: 10px;">
          <input type="radio" name="role" value="patient" required style="margin-right: 12px; margin-top: 3px; width: 20px; height: 20px; flex-shrink: 0;">
          <div>
            <strong style="font-size: 18px; display: block; margin-bottom: 5px;">üë¥ ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</strong>
            <span style="color: #666; font-size: 14px; display: block; line-height: 1.4;">‡∏â‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á</span>
          </div>
        </label>

        <!-- Caregiver Option -->
        <label style="display: flex; align-items: flex-start; margin-bottom: 0; cursor: pointer; padding: 15px; border: 2px solid #ddd; border-radius: 10px;">
          <input type="radio" name="role" value="caregiver" required style="margin-right: 12px; margin-top: 3px; width: 20px; height: 20px; flex-shrink: 0;">
          <div>
            <strong style="font-size: 18px; display: block; margin-bottom: 5px;">üë®‚Äçüë©‚Äçüëß ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</strong>
            <span style="color: #666; font-size: 14px; display: block; line-height: 1.4;">‡∏â‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</span>
          </div>
        </label>
      </div>

      <!-- Submit Button -->
      <button type="submit" class="btn btn-primary btn-block" style="margin-top: 20px;">
        ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‚Üí
      </button>
    </form>

    <div class="card mt-2">
      <h3>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
      <p style="margin-bottom: 8px;"><strong>‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢:</strong> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ç‡∏≤‡∏ï‡∏¥</p>
      <p><strong>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•:</strong> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</p>
    </div>
  </div>

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <!-- App JavaScript -->
  <script src="js/utils.js"></script>
  <script src="js/api.js"></script>
  <script src="js/liff-init.js"></script>

  <script>
    // ========================================
    // Role Selection
    // ========================================

    let liffProfile = null;

    async function init() {
      try {
        console.log('üöÄ Starting LIFF initialization...');

        // Show loading
        showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE...');

        // Initialize LIFF
        liffProfile = await initLiff();

        console.log('üì± LIFF init returned:', liffProfile);

        hideLoading();

        if (!liffProfile) {
          console.error('‚ùå LIFF Profile is null');
          showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE ‡πÑ‡∏î‡πâ');
        }

        console.log('‚úÖ LIFF Profile loaded:', liffProfile);
        console.log('‚úÖ Ready to select role');

        // Setup form handler
        setupFormHandler();

      } catch (error) {
        console.error('‚ùå Initialization error:', error);
        hideLoading();
        showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
      }
    }

    /**
     * Setup form submit handler
     */
    function setupFormHandler() {
      console.log('üé® Setting up form handler...');

      const form = document.getElementById('roleForm');
      if (!form) {
        console.error('‚ùå Form not found');
        return;
      }

      console.log('‚úÖ Form found:', form);

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('üìù Form submitted');

        // Get selected role
        const selectedRole = document.querySelector('input[name="role"]:checked');

        if (!selectedRole) {
          console.error('‚ùå No role selected');
          showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó');
          return;
        }

        const role = selectedRole.value;
        console.log('‚úÖ Selected role:', role);

        // Show loading
        showLoading(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°${role === 'patient' ? '‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢' : '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•'}...`);

        // Save to sessionStorage
        try {
          sessionStorage.setItem('selectedRole', role);
          if (liffProfile) {
            sessionStorage.setItem('liffProfile', JSON.stringify(liffProfile));
          }
          console.log('‚úÖ Saved to sessionStorage');
        } catch (err) {
          console.error('‚ùå sessionStorage error:', err);
        }

        // Navigate
        const targetPath = role === 'patient'
          ? '/liff/patient-registration.html'
          : '/liff/caregiver-registration.html';

        console.log('üöÄ Navigating to:', targetPath);

        // Simple navigation
        window.location.href = targetPath;
      });

      console.log('‚úÖ Form handler attached');
    }

    // Start when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
