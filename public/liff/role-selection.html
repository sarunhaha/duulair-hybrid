<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#4CAF50">
  <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó - Duulair</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container">
    <h1>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö üëã</h1>
    <p class="text-center mb-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>

    <!-- Loading indicator -->
    <div id="loadingIndicator" class="loading" style="display: none;">
      <div class="spinner"></div>
      <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <div class="role-cards" id="roleCards">
      <!-- Patient Card -->
      <div class="role-card" id="patientCard" style="cursor: pointer; opacity: 0.5;">
        <div class="icon">üë¥</div>
        <h2>‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h2>
        <p>‡∏â‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á</p>
      </div>

      <!-- Caregiver Card -->
      <div class="role-card" id="caregiverCard" style="cursor: pointer; opacity: 0.5;">
        <div class="icon">üë®‚Äçüë©‚Äçüëß</div>
        <h2>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h2>
        <p>‡∏â‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</p>
      </div>
    </div>

    <!-- Action Buttons (shown after cards are enabled) -->
    <div id="actionButtons" style="display: none; margin-top: 20px;">
      <button class="btn btn-primary btn-block" onclick="selectRole('patient')" id="patientBtn">
        ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢
      </button>
      <button class="btn btn-secondary btn-block" onclick="selectRole('caregiver')" id="caregiverBtn" style="margin-top: 10px;">
        ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
      </button>
    </div>

    <div class="card mt-2">
      <h3>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
      <p style="margin-bottom: 8px;"><strong>‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢:</strong> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ç‡∏≤‡∏ï‡∏¥</p>
      <p><strong>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•:</strong> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</p>
    </div>
  </div>

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <!-- App JavaScript -->
  <script src="js/utils.js"></script>
  <script src="js/api.js"></script>
  <script src="js/liff-init.js"></script>

  <script>
    // ========================================
    // Role Selection
    // ========================================

    let liffProfile = null;

    async function init() {
      try {
        // Show loading
        showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE...');

        // Initialize LIFF
        liffProfile = await initLiff();

        hideLoading();

        if (!liffProfile) {
          showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE ‡πÑ‡∏î‡πâ');
          return;
        }

        console.log('‚úÖ LIFF Profile loaded:', liffProfile);
        console.log('‚úÖ Ready to select role');

        // Enable cards and show buttons
        enableRoleSelection();

      } catch (error) {
        console.error('‚ùå Initialization error:', error);
        hideLoading();
        showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
      }
    }

    /**
     * Enable role selection after LIFF is ready
     */
    function enableRoleSelection() {
      // Enable cards
      const patientCard = document.getElementById('patientCard');
      const caregiverCard = document.getElementById('caregiverCard');

      if (patientCard) {
        patientCard.style.opacity = '1';
        patientCard.onclick = () => selectRole('patient');
      }

      if (caregiverCard) {
        caregiverCard.style.opacity = '1';
        caregiverCard.onclick = () => selectRole('caregiver');
      }

      // Show action buttons
      const actionButtons = document.getElementById('actionButtons');
      if (actionButtons) {
        actionButtons.style.display = 'block';
      }

      console.log('‚úÖ Role selection enabled');
    }

    /**
     * Select role and navigate to registration form
     * @param {string} role - 'patient' or 'caregiver'
     */
    function selectRole(role) {
      console.log('üéØ Role selected:', role);
      console.log('üë§ LIFF Profile:', liffProfile);

      if (!liffProfile) {
        console.error('‚ùå LIFF Profile not loaded yet');
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
        return;
      }

      // Show loading immediately
      showLoading(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô${role === 'patient' ? '‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢' : '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•'}...`);

      // Disable buttons to prevent double click
      const patientBtn = document.getElementById('patientBtn');
      const caregiverBtn = document.getElementById('caregiverBtn');
      if (patientBtn) patientBtn.disabled = true;
      if (caregiverBtn) caregiverBtn.disabled = true;

      // Save role and profile to sessionStorage
      sessionStorage.setItem('selectedRole', role);
      sessionStorage.setItem('liffProfile', JSON.stringify(liffProfile));

      console.log(`‚úÖ Navigating to ${role} registration...`);

      // Navigate to appropriate registration form (use absolute paths)
      const targetUrl = role === 'patient'
        ? '/liff/patient-registration.html'
        : '/liff/caregiver-registration.html';

      console.log(`üìç Target URL: ${targetUrl}`);

      // Small delay to show loading
      setTimeout(() => {
        window.location.href = targetUrl;
      }, 300);
    }

    // Start when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
