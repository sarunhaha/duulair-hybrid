import{b as S,r as p,j as e}from"./vendor-query-OvJu5Khy.js";import{l as L,u as Ne,m as ve,H as ce,P as ke,M as we,n as De,o as Se,D as Le,p as Ce,q as xe,a as me,r as ue,L as _e,e as _,f as z,s as Fe,t as $e,v as ze,w as Be,x as Ee,y as Ke,g as Z,X as Te,z as fe,B as Ae}from"./index-DdYhxTwe.js";import{R as q,L as Q,C as j,X as g,Y as y,T as N,a as H,b as F,B,c as E,d as K,S as Pe,Z as We,e as Me}from"./ScatterChart-Z_9DHBfr.js";import{I as qe}from"./info-DhoFDz7A.js";import{M as He}from"./message-circle-heart-CJUoQptB.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-CYcp45lG.js";const c={all:["trends"],vitals:(t,s)=>[...c.all,"vitals",t,s],meds:(t,s)=>[...c.all,"meds",t,s],sleep:(t,s)=>[...c.all,"sleep",t,s],exercise:(t,s)=>[...c.all,"exercise",t,s],mood:(t,s)=>[...c.all,"mood",t,s],water:(t,s)=>[...c.all,"water",t,s],glucose:(t,s)=>[...c.all,"glucose",t,s]};function Ye(t,s,a){const m=t?s==="custom"&&a?[...c.vitals(t,s),a.startDate,a.endDate]:c.vitals(t,s):["trends","vitals","none"];return S({queryKey:m,queryFn:async()=>{if(!t)return h();try{let l=`/trends/vitals/${t}?range=${s}`;return s==="custom"&&a&&(l+=`&startDate=${a.startDate}&endDate=${a.endDate}`),await L.get(l)}catch{return console.warn("Vitals trend API not available"),h()}},enabled:!0,staleTime:60*1e3})}function Oe(t,s,a){const m=t?s==="custom"&&a?[...c.meds(t,s),a.startDate,a.endDate]:c.meds(t,s):["trends","meds","none"];return S({queryKey:m,queryFn:async()=>{if(!t)return h();try{let l=`/trends/meds/${t}?range=${s}`;return s==="custom"&&a&&(l+=`&startDate=${a.startDate}&endDate=${a.endDate}`),await L.get(l)}catch{return console.warn("Meds trend API not available"),h()}},enabled:!0,staleTime:60*1e3})}function Ge(t,s,a){const m=t?s==="custom"&&a?[...c.sleep(t,s),a.startDate,a.endDate]:c.sleep(t,s):["trends","sleep","none"];return S({queryKey:m,queryFn:async()=>{if(!t)return h();try{let l=`/trends/sleep/${t}?range=${s}`;return s==="custom"&&a&&(l+=`&startDate=${a.startDate}&endDate=${a.endDate}`),await L.get(l)}catch{return console.warn("Sleep trend API not available"),h()}},enabled:!0,staleTime:60*1e3})}function h(){return{data:[],summary:{avg:"-",label1:"",count:"-",label2:""},insight:""}}function Xe(t,s,a){const m=t?s==="custom"&&a?[...c.exercise(t,s),a.startDate,a.endDate]:c.exercise(t,s):["trends","exercise","none"];return S({queryKey:m,queryFn:async()=>{if(!t)return h();try{let l=`/trends/exercise/${t}?range=${s}`;return s==="custom"&&a&&(l+=`&startDate=${a.startDate}&endDate=${a.endDate}`),await L.get(l)}catch{return console.warn("Exercise trend API not available"),h()}},enabled:!0,staleTime:60*1e3})}function Ve(t,s,a){const m=t?s==="custom"&&a?[...c.mood(t,s),a.startDate,a.endDate]:c.mood(t,s):["trends","mood","none"];return S({queryKey:m,queryFn:async()=>{if(!t)return h();try{let l=`/trends/mood/${t}?range=${s}`;return s==="custom"&&a&&(l+=`&startDate=${a.startDate}&endDate=${a.endDate}`),await L.get(l)}catch{return console.warn("Mood trend API not available"),h()}},enabled:!0,staleTime:60*1e3})}function Ze(t,s,a){const m=t?s==="custom"&&a?[...c.water(t,s),a.startDate,a.endDate]:c.water(t,s):["trends","water","none"];return S({queryKey:m,queryFn:async()=>{if(!t)return h();try{let l=`/trends/water/${t}?range=${s}`;return s==="custom"&&a&&(l+=`&startDate=${a.startDate}&endDate=${a.endDate}`),await L.get(l)}catch{return console.warn("Water trend API not available"),h()}},enabled:!0,staleTime:60*1e3})}function Qe(t,s,a){const m=t?s==="custom"&&a?[...c.glucose(t,s),a.startDate,a.endDate]:c.glucose(t,s):["trends","glucose","none"];return S({queryKey:m,queryFn:async()=>{if(!t)return h();try{let l=`/trends/glucose/${t}?range=${s}`;return s==="custom"&&a&&(l+=`&startDate=${a.startDate}&endDate=${a.endDate}`),await L.get(l)}catch{return console.warn("Glucose trend API not available"),h()}},enabled:!0,staleTime:60*1e3})}const T=(t=0)=>{const s=new Date;return s.setDate(s.getDate()-t),`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate().toString().padStart(2,"0")}`};function as(){const{context:t,user:s}=Ne(),a=t.patientId||(s.role==="patient"?s.profileId:null),{data:m}=ve(a),[l,v]=p.useState("7d"),[o,J]=p.useState("heart"),[d,Y]=p.useState(null),[f,he]=p.useState({startDate:T(30),endDate:T(0)}),[pe,$]=p.useState(!1),[O,A]=p.useState(f.startDate),[G,P]=p.useState(f.endDate),{data:X,isLoading:U}=Ye(a,l,l==="custom"?f:void 0),{data:I,isLoading:R}=Oe(a,l,l==="custom"?f:void 0),{data:ee,isLoading:se}=Ge(a,l,l==="custom"?f:void 0),{data:te,isLoading:ae}=Xe(a,l,l==="custom"?f:void 0),{data:re,isLoading:le}=Ve(a,l,l==="custom"?f:void 0),{data:de,isLoading:ne}=Ze(a,l,l==="custom"?f:void 0),{data:oe,isLoading:ie}=Qe(a,l,l==="custom"?f:void 0),n=p.useMemo(()=>{switch(o){case"heart":return X;case"meds":return I;case"sleep":return ee;case"exercise":return te;case"mood":return re;case"water":return de;case"glucose":return oe;case"lab_results":return null;default:return X}},[o,X,I,ee,te,re,de,oe]),be=n&&n.data.length===0,W=p.useMemo(()=>{switch(o){case"heart":return U;case"meds":return R;case"sleep":return se;case"exercise":return ae;case"mood":return le;case"water":return ne;case"glucose":return ie;case"lab_results":return!1;default:return!1}},[o,U,R,se,ae,le,ne,ie]);p.useEffect(()=>{Y(null)},[l,o]);const je={heart:"vitals_enabled",meds:"medications_enabled",sleep:"sleep_enabled",exercise:"exercise_enabled",mood:"mood_enabled",water:"water_enabled",glucose:"glucose_enabled",lab_results:"lab_results_enabled"},ge=[{id:"heart",label:"ความดัน",icon:ce},{id:"meds",label:"ยา",icon:ke},{id:"sleep",label:"นอน",icon:we},{id:"exercise",label:"ออกกำลัง",icon:De},{id:"mood",label:"อารมณ์",icon:Se},{id:"water",label:"น้ำ",icon:Le},{id:"glucose",label:"ระดับน้ำตาล",icon:Ce},{id:"lab_results",label:"ผลแล็บ",icon:xe}],C=p.useMemo(()=>ge.filter(r=>!m||m[je[r.id]]!==!1),[m]);p.useEffect(()=>{C.length>0&&!C.find(r=>r.id===o)&&J(C[0].id)},[C,o]);const k=r=>{r&&r.activePayload&&r.activePayload[0]&&Y(r.activePayload[0].payload)};return e.jsxs("div",{className:"min-h-screen pb-32 font-sans overflow-x-hidden relative z-10 bg-background",children:[e.jsx("header",{className:"bg-card pt-4 pb-1 px-6 sticky top-0 z-20 flex justify-between items-center border-b border-border",children:e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"แนวโน้ม"})}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-6 animate-in fade-in duration-500",children:[e.jsx("div",{className:"flex bg-muted/50 p-1 rounded-xl gap-1",children:["7d","15d","30d","custom"].map((r,x)=>{const w=["7 วัน","15 วัน","30 วัน","กำหนดเอง"],b=l===r;return e.jsxs("button",{onClick:()=>{v(r),r==="custom"&&(A(f.startDate),P(f.endDate),$(!0))},className:me("flex-1 py-2 text-xs font-semibold rounded-lg transition-all flex items-center justify-center gap-1",b?"bg-primary/10 text-primary shadow-sm border border-primary/30":"text-muted-foreground"),children:[r==="custom"&&e.jsx(ue,{className:"w-3 h-3"}),w[x]]},r)})}),l==="custom"&&e.jsxs("button",{onClick:()=>{A(f.startDate),P(f.endDate),$(!0)},className:"flex items-center justify-center gap-2 text-xs text-primary bg-primary/5 px-3 py-2 rounded-lg border border-primary/20",children:[e.jsx(ue,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[new Date(f.startDate).toLocaleDateString("th-TH",{day:"numeric",month:"short"})," - ",new Date(f.endDate).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"2-digit"})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:C.map(r=>{const x=o===r.id;return e.jsxs("button",{onClick:()=>J(r.id),className:me("flex items-center gap-1.5 px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border",x?"bg-primary text-primary-foreground border-primary shadow-md shadow-primary/20":"bg-card text-muted-foreground border-border"),children:[e.jsx(r.icon,{className:"w-3.5 h-3.5"}),r.label]},r.id)})}),W&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(_e,{className:"w-8 h-8 animate-spin text-primary"})}),!W&&o==="lab_results"&&e.jsx(_,{className:"border-none shadow-sm bg-card",children:e.jsxs(z,{className:"py-12 flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-teal-50 dark:bg-teal-950/30 rounded-full flex items-center justify-center",children:e.jsx(xe,{className:"w-8 h-8 text-teal-500"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-bold text-foreground",children:"กราฟผลแล็บ"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-[250px]",children:'กราฟแนวโน้มผลตรวจเลือดกำลังพัฒนา สามารถบันทึกผลแล็บได้จากหน้า "บันทึก" แล้ววันนี้'})]})]})}),!W&&be&&o!=="lab_results"&&e.jsx(_,{className:"border-none shadow-sm bg-card",children:e.jsxs(z,{className:"py-12 flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted/50 rounded-full flex items-center justify-center",children:(()=>{const x=C.find(w=>w.id===o)?.icon||ce;return e.jsx(x,{className:"w-8 h-8 text-muted-foreground"})})()}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-bold text-foreground",children:"ยังไม่มีข้อมูล"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-[250px]",children:'เริ่มบันทึกข้อมูลสุขภาพผ่าน LINE Chat หรือหน้า "บันทึก" เพื่อดูแนวโน้มที่นี่'})]})]})}),!W&&n&&n.data.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 transition-all",children:[e.jsx(_,{className:"border-none shadow-sm bg-card hover:shadow-md transition-shadow",children:e.jsxs(z,{className:"p-4",children:[e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-1",children:n.summary.label1}),e.jsx("p",{className:"text-xl font-bold text-foreground",children:n.summary.avg})]})}),e.jsx(_,{className:"border-none shadow-sm bg-card hover:shadow-md transition-shadow",children:e.jsxs(z,{className:"p-4",children:[e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-1",children:n.summary.label2}),e.jsx("p",{className:"text-xl font-bold text-foreground",children:n.summary.count})]})})]}),e.jsxs(_,{className:"border-none shadow-sm bg-card p-6 relative",children:[o==="heart"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wider mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[#EF4444]"}),"ความดันช่วงเช้า (AM)"]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-2 text-[10px] font-bold uppercase tracking-wider",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-1 bg-[#EF4444] rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"SYS"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-1 bg-[#3B82F6] rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"DIA"})]})]}),e.jsx("div",{className:"h-[180px] w-full",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Q,{data:n.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:k,children:[e.jsx(j,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(g,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(y,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[50,180]}),e.jsx(N,{contentStyle:{borderRadius:"12px",fontSize:"12px",border:"1px solid hsl(var(--border))"}}),e.jsx(H,{y:135,stroke:"#EF4444",strokeDasharray:"6 4",strokeOpacity:.4}),e.jsx(F,{type:"monotone",dataKey:"sys_am",name:"SYS เช้า",stroke:"#EF4444",strokeWidth:2.5,dot:{r:3,fill:"white",strokeWidth:2,stroke:"#EF4444"},activeDot:{r:5,strokeWidth:0,fill:"#EF4444"},connectNulls:!0}),e.jsx(F,{type:"monotone",dataKey:"dia_am",name:"DIA เช้า",stroke:"#3B82F6",strokeWidth:2,dot:{r:3,fill:"white",strokeWidth:2,stroke:"#3B82F6"},activeDot:{r:5,strokeWidth:0,fill:"#3B82F6"},connectNulls:!0})]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wider mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[#991B1B]"}),"ความดันช่วงเย็น (PM)"]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-2 text-[10px] font-bold uppercase tracking-wider",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-1 bg-[#991B1B] rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"SYS"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-1 bg-[#1E3A8A] rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"DIA"})]})]}),e.jsx("div",{className:"h-[180px] w-full",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Q,{data:n.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:k,children:[e.jsx(j,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(g,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(y,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[50,180]}),e.jsx(N,{contentStyle:{borderRadius:"12px",fontSize:"12px",border:"1px solid hsl(var(--border))"}}),e.jsx(H,{y:135,stroke:"#991B1B",strokeDasharray:"6 4",strokeOpacity:.4}),e.jsx(F,{type:"monotone",dataKey:"sys_pm",name:"SYS เย็น",stroke:"#991B1B",strokeWidth:2.5,dot:{r:3,fill:"white",strokeWidth:2,stroke:"#991B1B"},activeDot:{r:5,strokeWidth:0,fill:"#991B1B"},connectNulls:!0}),e.jsx(F,{type:"monotone",dataKey:"dia_pm",name:"DIA เย็น",stroke:"#1E3A8A",strokeWidth:2,dot:{r:3,fill:"white",strokeWidth:2,stroke:"#1E3A8A"},activeDot:{r:5,strokeWidth:0,fill:"#1E3A8A"},connectNulls:!0})]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wider mb-3 flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[#F59E0B]"}),"ชีพจร (Heart Rate)"]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mb-2 text-[10px] font-bold uppercase tracking-wider",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-1 border-t-2 border-dashed border-[#F59E0B]"}),e.jsx("span",{className:"text-muted-foreground",children:"เช้า"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-1 bg-[#F97316] rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"เย็น"})]})]}),e.jsx("div",{className:"h-[150px] w-full",children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(Q,{data:n.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:k,children:[e.jsx(j,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(g,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(y,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[40,120]}),e.jsx(N,{contentStyle:{borderRadius:"12px",fontSize:"12px",border:"1px solid hsl(var(--border))"}}),e.jsx(F,{type:"monotone",dataKey:"pulse_am",name:"HR เช้า",stroke:"#F59E0B",strokeWidth:2,strokeDasharray:"5 5",dot:{r:3,fill:"white",strokeWidth:2,stroke:"#F59E0B"},activeDot:{r:5,strokeWidth:0,fill:"#F59E0B"},connectNulls:!0}),e.jsx(F,{type:"monotone",dataKey:"pulse_pm",name:"HR เย็น",stroke:"#F97316",strokeWidth:2.5,dot:{r:3,fill:"white",strokeWidth:2,stroke:"#F97316"},activeDot:{r:5,strokeWidth:0,fill:"#F97316"},connectNulls:!0})]})})})]})]}),o==="glucose"&&e.jsxs("div",{className:"flex flex-wrap gap-3 mb-2 text-[10px] font-bold uppercase tracking-wider",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#6366f1]"}),e.jsx("span",{className:"text-muted-foreground",children:"ตื่นนอน"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#f97316]"}),e.jsx("span",{className:"text-muted-foreground",children:"หลังอาหาร 1 ชม."})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#f59e0b]"}),e.jsx("span",{className:"text-muted-foreground",children:"หลังอาหาร 2 ชม."})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-[#8b5cf6]"}),e.jsx("span",{className:"text-muted-foreground",children:"ก่อนนอน"})]})]}),o!=="heart"&&e.jsx("div",{className:"h-[240px] w-full",children:e.jsx(q,{width:"100%",height:"100%",children:o==="meds"?e.jsxs(B,{data:n.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:k,children:[e.jsx(j,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(g,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(y,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[0,100]}),e.jsx(N,{cursor:{fill:"rgba(0,0,0,0.05)"},contentStyle:{borderRadius:"12px",fontSize:"12px",border:"1px solid hsl(var(--border))"}}),e.jsx(E,{dataKey:"percent",radius:[6,6,0,0],children:n.data.map((r,x)=>e.jsx(K,{fill:r.percent===100?"#10b981":r.percent===0?"#ef4444":"#f97316"},`cell-${x}`))})]}):o==="sleep"?e.jsxs(B,{data:n.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:k,children:[e.jsx(j,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(g,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(y,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[0,10]}),e.jsx(N,{cursor:{fill:"rgba(0,0,0,0.05)"},contentStyle:{borderRadius:"12px",fontSize:"12px",border:"1px solid hsl(var(--border))"}}),e.jsx(E,{dataKey:"hours",radius:[6,6,0,0],children:n.data.map((r,x)=>e.jsx(K,{fill:r.hours&&r.hours<6?"#f97316":"#8b5cf6"},`cell-${x}`))})]}):o==="exercise"?e.jsxs(B,{data:n.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:k,children:[e.jsx(j,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(g,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(y,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[0,60]}),e.jsx(N,{cursor:{fill:"rgba(0,0,0,0.05)"},contentStyle:{borderRadius:"12px",fontSize:"12px",border:"1px solid hsl(var(--border))"}}),e.jsx(E,{dataKey:"duration",radius:[6,6,0,0],children:n.data.map((r,x)=>e.jsx(K,{fill:r.duration==null?"#e5e7eb":(r.duration??0)>=30?"#10b981":"#f97316"},`cell-${x}`))})]}):o==="mood"?e.jsxs(B,{data:n.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:k,children:[e.jsx(j,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(g,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(y,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[0,5]}),e.jsx(N,{cursor:{fill:"rgba(0,0,0,0.05)"},contentStyle:{borderRadius:"12px",fontSize:"12px",border:"1px solid hsl(var(--border))"}}),e.jsx(E,{dataKey:"moodScore",radius:[6,6,0,0],children:n.data.map((r,x)=>e.jsx(K,{fill:r.moodScore==null?"#e5e7eb":(r.moodScore??0)>=4?"#10b981":(r.moodScore??0)>=3?"#f59e0b":"#ef4444"},`cell-${x}`))})]}):o==="glucose"?(()=>{const r={fasting:"#6366f1",post_meal_1h:"#f97316",post_meal_2h:"#f59e0b",before_bed:"#8b5cf6"},x={fasting:"ตื่นนอน",post_meal_1h:"หลังอาหาร 1 ชม.",post_meal_2h:"หลังอาหาร 2 ชม.",before_bed:"ก่อนนอน"},w=[];n.data.forEach((i,u)=>{i.glucoseReadings&&i.glucoseReadings.forEach((D,M)=>{const V=i.glucoseReadings.length>1?(M-(i.glucoseReadings.length-1)/2)*.15:0;w.push({dayIndex:u+V,glucose:D.glucose,mealContext:D.mealContext||"fasting",time:D.time,day:i.day,date:i.date})})});const b={};w.forEach(i=>{const u=i.mealContext;b[u]||(b[u]=[]),b[u].push(i)});const ye=n.data.map(i=>i.day);return e.jsxs(Pe,{margin:{top:10,right:10,left:-25,bottom:0},children:[e.jsx(j,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(g,{type:"number",dataKey:"dayIndex",domain:[-.5,n.data.length-.5],ticks:n.data.map((i,u)=>u),tickFormatter:i=>ye[Math.round(i)]||"",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(y,{type:"number",dataKey:"glucose",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[50,250]}),e.jsx(We,{range:[80,80]}),e.jsx(H,{y:100,stroke:"#f59e0b",strokeDasharray:"6 4",strokeOpacity:.5,label:{value:"เสี่ยง 100",position:"insideTopLeft",fontSize:9,fill:"#f59e0b"}}),e.jsx(H,{y:126,stroke:"#ef4444",strokeDasharray:"6 4",strokeOpacity:.5,label:{value:"สูง 126",position:"insideTopLeft",fontSize:9,fill:"#ef4444"}}),e.jsx(N,{content:({payload:i})=>{if(!i||!i[0])return null;const u=i[0].payload;return e.jsxs("div",{className:"bg-card border border-border rounded-xl px-3 py-2 shadow-md text-xs space-y-0.5",children:[e.jsxs("p",{className:"font-bold",children:[u.day," (",u.date,")"]}),e.jsxs("p",{className:"font-bold text-base",style:{color:r[u.mealContext]||"#ec4899"},children:[u.glucose," mg/dL"]}),e.jsxs("p",{className:"text-muted-foreground",children:[x[u.mealContext]||u.mealContext," · ",u.time]})]})}}),Object.entries(b).map(([i,u])=>e.jsx(Me,{name:x[i]||i,data:u,fill:r[i]||"#ec4899",stroke:"white",strokeWidth:2,onClick:D=>{if(D&&D.date){const M=n.data.find(V=>V.date===D.date);M&&Y(M)}},cursor:"pointer"},i))]})})():e.jsxs(B,{data:n.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:k,children:[e.jsx(j,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(g,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(y,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[0,12]}),e.jsx(N,{cursor:{fill:"rgba(0,0,0,0.05)"},contentStyle:{borderRadius:"12px",fontSize:"12px",border:"1px solid hsl(var(--border))"}}),e.jsx(E,{dataKey:"glasses",radius:[6,6,0,0],children:n.data.map((r,x)=>e.jsx(K,{fill:(r.glasses||0)>=8?"#3b82f6":(r.glasses||0)>=6?"#60a5fa":"#93c5fd"},`cell-${x}`))})]})})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("p",{className:"text-[10px] text-muted-foreground font-medium bg-muted/30 px-3 py-1 rounded-full flex items-center gap-1.5",children:[e.jsx(qe,{className:"w-3 h-3"})," แตะจุดบนกราฟเพื่อดูรายละเอียด"]})}),d&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-muted/50 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-muted-foreground",children:d.day}),o==="heart"&&e.jsxs("div",{className:"space-y-2 mt-1",children:[(d.sys_am||d.pulse_am)&&e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground w-8",children:"เช้า"}),e.jsxs("p",{className:"text-base font-bold text-[#EF4444]",children:[d.sys_am,"/",d.dia_am," ",e.jsx("span",{className:"text-[10px] font-normal text-muted-foreground",children:"mmHg"})]}),e.jsxs("p",{className:"text-sm font-bold text-[#F59E0B]",children:[d.pulse_am," ",e.jsx("span",{className:"text-[10px] font-normal text-muted-foreground",children:"bpm"})]})]}),(d.sys_pm||d.pulse_pm)&&e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground w-8",children:"เย็น"}),e.jsxs("p",{className:"text-base font-bold text-[#991B1B]",children:[d.sys_pm,"/",d.dia_pm," ",e.jsx("span",{className:"text-[10px] font-normal text-muted-foreground",children:"mmHg"})]}),e.jsxs("p",{className:"text-sm font-bold text-[#F97316]",children:[d.pulse_pm," ",e.jsx("span",{className:"text-[10px] font-normal text-muted-foreground",children:"bpm"})]})]})]}),o==="meds"&&e.jsx("div",{className:"mt-1",children:e.jsxs("p",{className:"text-sm font-bold text-foreground",children:["ตั้งไว้ ",d.target," ช่วง | ทำได้ ",d.done," ช่วง |"," ","= ",d.percent,"%"]})}),o==="sleep"&&e.jsx("div",{className:"mt-1",children:e.jsxs("p",{className:"text-xl font-bold text-indigo-600",children:[d.hours," ",e.jsx("span",{className:"text-xs font-normal text-muted-foreground",children:"ชม."})]})}),o==="exercise"&&e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:d.duration!==null?e.jsxs(e.Fragment,{children:[d.duration," ",e.jsx("span",{className:"text-xs font-normal text-muted-foreground",children:"นาที"})]}):e.jsx("span",{className:"text-muted-foreground text-base",children:"ไม่ได้ออกกำลังกาย"})}),d.exerciseType&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:d.exerciseType})]}),o==="mood"&&e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"text-xl font-bold text-amber-600",children:d.moodScore!==null?e.jsxs(e.Fragment,{children:[d.moodScore,"/5"," ",e.jsx("span",{className:"text-xs font-normal text-muted-foreground",children:"คะแนน"})]}):e.jsx("span",{className:"text-muted-foreground text-base",children:"ไม่ได้บันทึก"})}),d.note&&e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:d.note})]}),o==="water"&&e.jsxs("div",{className:"mt-1",children:[e.jsxs("p",{className:"text-xl font-bold text-blue-600",children:[d.glasses," ",e.jsx("span",{className:"text-xs font-normal text-muted-foreground",children:"แก้ว"})]}),d.ml&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:["≈ ",d.ml," ml"]})]}),o==="glucose"&&e.jsx("div",{className:"mt-1 space-y-2",children:d.glucoseReadings&&d.glucoseReadings.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider",children:["วัด ",d.glucoseReadings.length," ครั้ง · เฉลี่ย ",d.glucose," mg/dL"]}),d.glucoseReadings.map((r,x)=>{const w={fasting:"ตื่นนอน",post_meal_1h:"หลังอาหาร 1 ชม.",post_meal_2h:"หลังอาหาร 2 ชม.",before_bed:"ก่อนนอน"},b={fasting:"#6366f1",post_meal_1h:"#f97316",post_meal_2h:"#f59e0b",before_bed:"#8b5cf6"};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full shrink-0",style:{backgroundColor:b[r.mealContext||""]||"#ec4899"}}),e.jsx("span",{className:"text-base font-bold",style:{color:b[r.mealContext||""]||"#ec4899"},children:r.glucose}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"mg/dL"}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[w[r.mealContext||""]||r.mealContext," · ",r.time]})]},x)})]}):e.jsx("p",{className:"text-muted-foreground text-base",children:"ไม่ได้วัด"})})]}),d.note&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-950/30 px-3 py-2 rounded-xl text-xs font-medium text-yellow-700 dark:text-yellow-400 max-w-[150px]",children:['"',d.note,'"']})]}),d.event&&!d.note&&e.jsxs("div",{className:"mt-2 inline-flex items-center gap-1.5 bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 px-2.5 py-1 rounded-full",children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px] font-bold",children:d.event})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-sm font-bold text-foreground flex items-center gap-2 pl-1",children:[e.jsx("div",{className:"w-1 h-4 bg-accent rounded-full"}),"อุ่นใจสังเกตให้"]}),e.jsx(_,{className:"border-none shadow-sm bg-accent/5 overflow-hidden group hover:bg-accent/10 transition-colors",children:e.jsxs(z,{className:"p-5 flex gap-4 items-start",children:[e.jsx("div",{className:"bg-accent/10 p-3 rounded-2xl text-accent group-hover:scale-110 transition-transform",children:e.jsx(He,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex-1 space-y-2",children:e.jsxs("p",{className:"text-sm leading-relaxed font-semibold text-foreground",children:['"',n.insight,'"']})})]})})]})]})]}),e.jsx($e,{open:pe,onOpenChange:$,children:e.jsxs(ze,{className:"max-h-[85vh]",children:[e.jsxs(Be,{className:"flex items-center justify-between px-6",children:[e.jsx(Ee,{className:"text-xl font-bold",children:"เลือกช่วงวันที่"}),e.jsx(Ke,{asChild:!0,children:e.jsx(Z,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:e.jsx(Te,{className:"w-5 h-5"})})})]}),e.jsxs("div",{className:"px-6 pb-8 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"วันเริ่มต้น"}),e.jsx(fe,{value:O,onChange:A,maxDate:G})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"วันสิ้นสุด"}),e.jsx(fe,{value:G,onChange:P,minDate:O,maxDate:T(0)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"เลือกด่วน"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"7 วันที่แล้ว",days:7},{label:"14 วันที่แล้ว",days:14},{label:"30 วันที่แล้ว",days:30},{label:"60 วันที่แล้ว",days:60},{label:"90 วันที่แล้ว",days:90}].map(r=>e.jsx("button",{onClick:()=>{A(T(r.days-1)),P(T(0))},className:"px-3 py-1.5 text-xs font-medium rounded-full bg-muted hover:bg-muted/80 text-muted-foreground transition-colors",children:r.label},r.days))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(Z,{variant:"ghost",className:"flex-1 h-12 rounded-xl",onClick:()=>$(!1),children:"ยกเลิก"}),e.jsx(Z,{className:"flex-1 h-12 rounded-xl bg-primary text-primary-foreground",onClick:()=>{he({startDate:O,endDate:G}),$(!1)},children:"ยืนยัน"})]})]})]})}),e.jsx(Ae,{})]})}export{as as default};
