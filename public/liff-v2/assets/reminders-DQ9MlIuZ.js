import{r as d,j as e}from"./vendor-query-CmnYLxAr.js";import{c as z,a as w,m as K,u as Q,w as J,P as ee,G as te,H as se,g as p,z as ae,L as D,e as ie,f as ne,N as ce,x as T,Q as re,R as le,V as oe,W as de,Y as ue,X as me,p as C,I as A,r as fe,Z as he,K as pe}from"./index-OMaGeRoJ.js";import{e as B,u as xe,a as ve,d as L,f as ye,g as be,h as je}from"./vendor-ui-BZ8NMy8G.js";import{k as ge,l as we,m as _e,n as Ne}from"./use-profile-D89j6-e2.js";import{P as ke}from"./pen-CvsBdhMC.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-pdf-IriBjpIe.js";import"./vendor-charts-CeI395eV.js";const Ce=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]],Se=z("footprints",Ce);const Pe=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],Re=z("utensils",Pe);var P="Switch",[Ee]=ve(P),[Ie,qe]=Ee(P),O=d.forwardRef((o,h)=>{const{__scopeSwitch:r,name:c,checked:i,defaultChecked:_,required:x,disabled:u,value:m="on",onCheckedChange:N,form:v,...f}=o,[y,b]=d.useState(null),s=B(h,g=>b(g)),l=d.useRef(!1),S=y?v||!!y.closest("form"):!0,[j,R]=xe({prop:i,defaultProp:_??!1,onChange:N,caller:P});return e.jsxs(Ie,{scope:r,checked:j,disabled:u,children:[e.jsx(L.button,{type:"button",role:"switch","aria-checked":j,"aria-required":x,"data-state":V(j),"data-disabled":u?"":void 0,disabled:u,value:m,...f,ref:s,onClick:ye(o.onClick,g=>{R(E=>!E),S&&(l.current=g.isPropagationStopped(),l.current||g.stopPropagation())})}),S&&e.jsx(U,{control:y,bubbles:!l.current,name:c,value:m,checked:j,required:x,disabled:u,form:v,style:{transform:"translateX(-100%)"}})]})});O.displayName=P;var F="SwitchThumb",H=d.forwardRef((o,h)=>{const{__scopeSwitch:r,...c}=o,i=qe(F,r);return e.jsx(L.span,{"data-state":V(i.checked),"data-disabled":i.disabled?"":void 0,...c,ref:h})});H.displayName=F;var De="SwitchBubbleInput",U=d.forwardRef(({__scopeSwitch:o,control:h,checked:r,bubbles:c=!0,...i},_)=>{const x=d.useRef(null),u=B(x,_),m=be(r),N=je(h);return d.useEffect(()=>{const v=x.current;if(!v)return;const f=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(f,"checked").set;if(m!==r&&b){const s=new Event("click",{bubbles:c});b.call(v,r),v.dispatchEvent(s)}},[m,r,c]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:u,style:{...i.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});U.displayName=De;function V(o){return o?"checked":"unchecked"}var Z=O,Te=H;const Y=d.forwardRef(({className:o,...h},r)=>e.jsx(Z,{className:w("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",o),...h,ref:r,children:e.jsx(Te,{className:w("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Y.displayName=Z.displayName;const I=[{value:"medication",label:"กินยา",icon:ee,color:"bg-purple-500/10 text-purple-500"},{value:"water",label:"ดื่มน้ำ",icon:te,color:"bg-blue-500/10 text-blue-500"},{value:"vitals",label:"วัดความดัน",icon:se,color:"bg-red-500/10 text-red-500"},{value:"food",label:"ทานอาหาร",icon:Re,color:"bg-orange-500/10 text-orange-500"},{value:"exercise",label:"ออกกำลังกาย",icon:Se,color:"bg-green-500/10 text-green-500"}],q=[{value:"monday",label:"จ"},{value:"tuesday",label:"อ"},{value:"wednesday",label:"พ"},{value:"thursday",label:"พฤ"},{value:"friday",label:"ศ"},{value:"saturday",label:"ส"},{value:"sunday",label:"อา"}],M={type:"medication",title:"",time:"08:00",note:"",frequency:"daily",days_of_week:[],is_active:!0};function Ue(){const[,o]=K(),{context:h,user:r}=Q(),c=h.patientId||(r.role==="patient"?r.profileId:null),{toast:i}=J(),{data:_,isLoading:x}=ge(c),u=we(),m=_e(),N=Ne(),[v,f]=d.useState(!1),[y,b]=d.useState(null),[s,l]=d.useState(M),S=I.map(t=>({...t,reminders:(_||[]).filter(n=>n.type===t.value)})),j=t=>{b(null),l({...M,type:t}),f(!0)},R=t=>{b(t.id),l({type:t.type,title:t.title,time:t.custom_time||t.time||"08:00",note:t.note||"",frequency:t.frequency==="specific_days"?"specific_days":"daily",days_of_week:t.days_of_week||[],is_active:t.is_active}),f(!0)},g=async t=>{if(c&&confirm("ต้องการลบการเตือนนี้หรือไม่?"))try{await N.mutateAsync({id:t,patientId:c}),i({title:"ลบการเตือนเรียบร้อยแล้ว"})}catch{i({title:"ไม่สามารถลบการเตือนได้",variant:"destructive"})}},E=async t=>{if(c)try{await m.mutateAsync({id:t.id,data:{is_active:!t.is_active,patient_id:c}})}catch{i({title:"ไม่สามารถเปลี่ยนสถานะได้",variant:"destructive"})}},$=async()=>{if(c){if(!s.title.trim()){i({title:"กรุณาระบุชื่อเตือน",variant:"destructive"});return}if(!s.time){i({title:"กรุณาระบุเวลาเตือน",variant:"destructive"});return}if(s.frequency==="specific_days"&&s.days_of_week.length===0){i({title:"กรุณาเลือกวันที่ต้องการเตือน",variant:"destructive"});return}try{y?(await m.mutateAsync({id:y,data:{...s,custom_time:s.time,days_of_week:s.frequency==="specific_days"?s.days_of_week:void 0,patient_id:c}}),i({title:"แก้ไขการเตือนเรียบร้อยแล้ว"})):(await u.mutateAsync({...s,custom_time:s.time,days_of_week:s.frequency==="specific_days"?s.days_of_week:void 0,patient_id:c}),i({title:"เพิ่มการเตือนเรียบร้อยแล้ว"})),f(!1)}catch{i({title:"ไม่สามารถบันทึกการเตือนได้",variant:"destructive"})}}},W=t=>{l(n=>({...n,days_of_week:n.days_of_week.includes(t)?n.days_of_week.filter(a=>a!==t):[...n.days_of_week,t]}))},X=t=>I.find(n=>n.value===t)||I[0];return e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-12 pb-4 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>o("/settings"),children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"ตั้งเวลาเตือน"})]}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-6",children:[x&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(D,{className:"w-8 h-8 animate-spin text-primary"})}),!x&&S.map(t=>{const n=t.icon;return e.jsx(ie,{className:"border-none shadow-sm bg-card overflow-hidden",children:e.jsxs(ne,{className:"p-0",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:w("p-2 rounded-xl",t.color),children:e.jsx(n,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-bold text-foreground",children:t.label})]}),e.jsxs(p,{variant:"default",size:"sm",className:"gap-1",onClick:()=>j(t.value),children:[e.jsx(ce,{className:"w-4 h-4"}),"เพิ่มเตือน"]})]}),e.jsx("div",{className:"p-4",children:t.reminders.length===0?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(T,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"ยังไม่มีการเตือน"})]}):e.jsx("div",{className:"space-y-3",children:t.reminders.map(a=>e.jsxs("div",{className:w("p-3 bg-muted/50 rounded-xl border-l-4 transition-opacity",a.is_active?"border-primary":"border-muted-foreground opacity-50"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground text-sm",children:a.title}),e.jsx("p",{className:"text-xl font-bold text-primary mt-1",children:a.custom_time||a.time}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.frequency==="daily"?"ทุกวัน":a.days_of_week?.map(k=>q.find(G=>G.value===k)?.label).join(", ")||"ตามกำหนด"}),a.note&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.note})]}),e.jsx(Y,{checked:a.is_active,onCheckedChange:()=>E(a)})]}),a.frequency==="specific_days"&&a.days_of_week&&e.jsx("div",{className:"flex gap-1 mt-2",children:q.map(k=>e.jsx("span",{className:w("w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-bold",a.days_of_week?.includes(k.value)?"bg-primary text-white":"bg-muted text-muted-foreground"),children:k.label},k.value))}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs(p,{variant:"outline",size:"sm",className:"flex-1 gap-1 h-8",onClick:()=>R(a),children:[e.jsx(ke,{className:"w-3 h-3"}),"แก้ไข"]}),e.jsxs(p,{variant:"destructive",size:"sm",className:"flex-1 gap-1 h-8",onClick:()=>g(a.id),children:[e.jsx(re,{className:"w-3 h-3"}),"ลบ"]})]})]},a.id))})})]})},t.value)})]}),e.jsx(le,{open:v,onOpenChange:f,children:e.jsxs(oe,{className:"max-h-[90vh]",children:[e.jsx(de,{className:"border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ue,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-primary"}),y?"แก้ไขการเตือน":`เพิ่มเตือน${X(s.type).label}`]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>f(!1),children:e.jsx(me,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"reminder_title",children:"ชื่อเตือน *"}),e.jsx(A,{id:"reminder_title",value:s.title,onChange:t=>l(n=>({...n,title:t.target.value})),placeholder:"เช่น กินยาความดัน"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"reminder_time",children:"เวลาเตือน *"}),e.jsx(A,{id:"reminder_time",type:"time",value:s.time,onChange:t=>l(n=>({...n,time:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"ความถี่"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"button",variant:s.frequency==="daily"?"default":"outline",className:"flex-1",onClick:()=>l(t=>({...t,frequency:"daily"})),children:"ทุกวัน"}),e.jsx(p,{type:"button",variant:s.frequency==="specific_days"?"default":"outline",className:"flex-1",onClick:()=>l(t=>({...t,frequency:"specific_days"})),children:"เลือกวัน"})]})]}),s.frequency==="specific_days"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"เลือกวันที่ต้องการเตือน"}),e.jsx("div",{className:"flex gap-2 justify-center",children:q.map(t=>e.jsx("button",{type:"button",onClick:()=>W(t.value),className:w("w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold transition-colors",s.days_of_week.includes(t.value)?"bg-primary text-white":"bg-muted text-muted-foreground hover:bg-muted/80"),children:t.label},t.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"หมายเหตุ (ถ้ามี)"}),e.jsx(fe,{value:s.note,onChange:t=>l(n=>({...n,note:t.target.value})),placeholder:"เพิ่มรายละเอียดเพิ่มเติม",rows:2})]})]}),e.jsx(he,{className:"border-t border-border",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",className:"flex-1",onClick:()=>f(!1),children:"ยกเลิก"}),e.jsxs(p,{className:"flex-1 gap-2",onClick:$,disabled:u.isPending||m.isPending,children:[(u.isPending||m.isPending)&&e.jsx(D,{className:"w-4 h-4 animate-spin"}),e.jsx(pe,{className:"w-4 h-4"}),"บันทึก"]})]})})]})})]})}export{Ue as default};
