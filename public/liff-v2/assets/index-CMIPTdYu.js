import{b as we,r as v,j as e}from"./vendor-query-Du2VTbg0.js";import{c as ne,k as Se,x as Me,u as ke,ad as De,ae as Ce,af as Te,g as $,V as Ae,ag as $e,a as w,l as Pe,U as Fe,o as me,P as ee,e as B,f as Re,L as C,H as xe,M as He,ah as _e,ac as ze,a3 as Ee,$ as Le,p as Qe,q as Be,r as Ie,s as Oe,ai as Ye,a8 as We,B as qe}from"./index-8HwarDPt.js";import{u as Ke,g as Ge}from"./use-profile-BhOIjsfw.js";import{E as Ve,a as _}from"./vendor-pdf-IriBjpIe.js";import{n as Ue,c as Je,f as S,t as F,s as P}from"./th-Czkms0GK.js";import{C as Xe}from"./clipboard-list-C0mUl-c_.js";import{b as te,L as Ze,d as se,C as ae,T as et,B as ue,f as he,g as tt}from"./vendor-charts-DekULt-a.js";import{C as st}from"./circle-check-BJChLihe.js";import{C as at}from"./chevron-up-Bm06Wmrb.js";import{C as rt}from"./chevron-down-D8op61Og.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-DQGRYUuk.js";const nt=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ot=ne("eye",nt);const lt=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],dt=ne("file-down",lt);const it=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ct=ne("message-square",it);function mt(r,m){const[h,o]=Ue(r,m.start,m.end);return{start:h,end:o}}function xt(r,m){const{start:h,end:o}=mt(m?.in,r);let t=+h>+o;const x=t?+h:+o,a=t?o:h;a.setHours(0,0,0,0);let c=1;const i=[];for(;+a<=x;)i.push(Je(h,a)),a.setDate(a.getDate()+c),a.setHours(0,0,0,0);return t?i.reverse():i}let re=null,pe=null,I=null;async function O(r){try{const m=new AbortController,h=setTimeout(()=>m.abort(),15e3),o=await fetch(r,{signal:m.signal});if(clearTimeout(h),!o.ok)return null;const t=await o.arrayBuffer(),x=new Uint8Array(t.slice(0,4));if(!(x[0]===0&&x[1]===1&&x[2]===0&&x[3]===0||x[0]===116&&x[1]===114&&x[2]===117&&x[3]===101))return null;const c=new Uint8Array(t);let i="";const p=8192;for(let b=0;b<c.length;b+=p){const j=c.subarray(b,b+p);i+=String.fromCharCode.apply(null,Array.from(j))}return btoa(i)}catch{return null}}async function ut(){return re?{regular:re,bold:pe}:I||(I=(async()=>{const r="/liff-v2/",m=await O(`${r}fonts/Sarabun-Regular.ttf`)||await O("https://github.com/google/fonts/raw/main/ofl/sarabun/Sarabun-Regular.ttf"),h=await O(`${r}fonts/Sarabun-Bold.ttf`)||await O("https://github.com/google/fonts/raw/main/ofl/sarabun/Sarabun-Bold.ttf");return m&&(re=m,console.log("Thai font Regular loaded")),h&&(pe=h,console.log("Thai font Bold loaded")),m||console.warn("Thai Regular font failed to load, PDF will use default font"),{regular:m,bold:h}})(),I)}const be={all:["reports"],data:(r,m,h)=>[...be.all,"data",r,m,h]};function ht(r,m,h){const o=new Date;let t;switch(r){case"7d":t=P(o,6);break;case"30d":t=P(o,29);break;case"90d":t=P(o,89);break;case"custom":return t=P(o,6),{startDate:t,endDate:o};default:t=P(o,6)}return{startDate:t,endDate:o}}function pt(r,m,h,o){const{startDate:t,endDate:x}=ht(m),a=S(t,"yyyy-MM-dd"),c=S(x,"yyyy-MM-dd");return we({queryKey:r?be.data(r,a,c):["reports","data","none"],queryFn:async()=>{if(!r)return ge(t,x);try{return await Se.get(`/reports/${r}?start=${a}&end=${c}`)}catch{return console.warn("Reports API not available, using mock data"),ge(t,x)}},enabled:!!r||!0,staleTime:60*1e3})}function gt(r,m){return r>=180||m>=120?"crisis":r>=140||m>=90?"high":r>=130||m>=80?"elevated":"normal"}function ft(r){return{normal:"ปกติ",elevated:"สูงเล็กน้อย",high:"สูง",crisis:"สูงมาก"}[r]||r}function bt(r){return{good:"ดีมาก",fair:"พอใช้",poor:"ต้องปรับปรุง"}[r]||r}function yt(r){return{good:"เพียงพอ",fair:"พอใช้",poor:"น้อยเกินไป"}[r]||r}async function jt(r,m,h,o){const t=new Ve,x=t.internal.pageSize.getWidth();let a=20,c=!1;try{const n=await ut();n.regular&&(t.addFileToVFS("Sarabun-Regular.ttf",n.regular),t.addFont("Sarabun-Regular.ttf","Sarabun","normal"),n.bold?(t.addFileToVFS("Sarabun-Bold.ttf",n.bold),t.addFont("Sarabun-Bold.ttf","Sarabun","bold")):t.addFont("Sarabun-Regular.ttf","Sarabun","bold"),t.setFont("Sarabun"),c=!0)}catch(n){console.warn("Could not load Thai font:",n)}const i=[30,123,156],p=(n="normal",g=11)=>{if(t.setFontSize(g),c)try{t.setFont("Sarabun",n);return}catch{}t.setFont("helvetica",n)};p("bold",18),t.setTextColor(i[0],i[1],i[2]),t.text("รายงานสุขภาพ - OONJAI",x/2,a,{align:"center"}),a+=10,t.setTextColor(0,0,0),p("normal",12),t.text(`ชื่อ: ${m}`,x/2,a,{align:"center"}),a+=7;const b=[];o?.patientAge&&b.push(`อายุ ${o.patientAge} ปี`),o?.patientGender&&b.push(o.patientGender==="male"?"เพศชาย":o.patientGender==="female"?"เพศหญิง":o.patientGender),b.length>0&&(t.text(b.join(" | "),x/2,a,{align:"center"}),a+=7),t.text(`ช่วงเวลา: ${h}`,x/2,a,{align:"center"}),a+=5,p("normal",9),t.setTextColor(100,100,100),t.text(`สร้างเมื่อ: ${S(new Date,"d MMM yyyy HH:mm",{locale:F})} น.`,x/2,a,{align:"center"}),t.setTextColor(0,0,0),a+=12;const j=o?.drugAllergies||[],f=o?.foodAllergies||[];if(j.length>0||f.length>0){t.setFillColor(254,226,226),t.setDrawColor(239,68,68),t.roundedRect(14,a-2,x-28,18,3,3,"FD"),p("bold",11),t.setTextColor(185,28,28),t.text("[!] แพ้:",18,a+6),p("normal",10);const n=[...j,...f].join(", ");t.text(n,40,a+6),t.setTextColor(0,0,0),a+=22}const R=o?.medications||[];if(R.length>0){p("bold",12),t.setTextColor(i[0],i[1],i[2]),t.text("รายการยา",14,a),t.setTextColor(0,0,0),a+=8;const n=R.map((g,N)=>[(N+1).toString(),g.name,g.dosage_amount&&g.dosage_unit?`${g.dosage_amount} ${g.dosage_unit}`:"-"]);_(t,{startY:a,head:[["#","ชื่อยา","ขนาด"]],body:n,theme:"striped",headStyles:{fillColor:[249,115,22],...c&&{font:"Sarabun"}},bodyStyles:{...c&&{font:"Sarabun"}},margin:{left:14,right:14},styles:{fontSize:10,...c&&{font:"Sarabun"}}}),a=t.lastAutoTable.finalY+10}p("bold",12),t.setTextColor(i[0],i[1],i[2]),t.text("สรุปภาพรวม",14,a),t.setTextColor(0,0,0),a+=8;const d=[["ความดันเฉลี่ย",`${r.summary.bp.avgSystolic}/${r.summary.bp.avgDiastolic} mmHg`,ft(r.summary.bp.status)],["การกินยาครบ",`${r.summary.meds.adherencePercent}%`,bt(r.summary.meds.status)],["น้ำดื่มเฉลี่ย",`${r.summary.water.avgMl} มล./วัน`,yt(r.summary.water.status)]];if(r.summary.sleep){const n=r.summary.sleep.status==="good"?"ดี":r.summary.sleep.status==="fair"?"พอใช้":"น้อย";d.push(["การนอนเฉลี่ย",`${r.summary.sleep.avgHours.toFixed(1)} ชม.`,n])}if(_(t,{startY:a,head:[["รายการ","ค่า","สถานะ"]],body:d,theme:"striped",headStyles:{fillColor:i,...c&&{font:"Sarabun"}},bodyStyles:{...c&&{font:"Sarabun"}},margin:{left:14,right:14},styles:{fontSize:10,...c&&{font:"Sarabun"}}}),a=t.lastAutoTable.finalY+10,r.significantEvents&&r.significantEvents.length>0){a>220&&(t.addPage(),a=20),p("bold",12),t.setTextColor(i[0],i[1],i[2]),t.text("วันที่มีนัยยะ (หมอควรดู)",14,a),t.setTextColor(0,0,0),a+=8;const n=r.significantEvents.slice(0,10).map(g=>[g.date,g.title,g.tag]);_(t,{startY:a,head:[["วันที่","รายละเอียด","ประเภท"]],body:n,theme:"striped",headStyles:{fillColor:[245,158,11],...c&&{font:"Sarabun"}},bodyStyles:{...c&&{font:"Sarabun"}},margin:{left:14,right:14},styles:{fontSize:9,...c&&{font:"Sarabun"}}}),a=t.lastAutoTable.finalY+10}a>200&&(t.addPage(),a=20),p("bold",12),t.setTextColor(i[0],i[1],i[2]),t.text("ข้อมูลรายวัน",14,a),t.setTextColor(0,0,0),a+=8;const u=r.chartData.slice(-14).map(n=>[n.day||n.date,n.systolic?`${n.systolic}/${n.diastolic}`:"-",n.pulse?.toString()||"-",n.medsPercent!==void 0?`${n.medsPercent}%`:"-",n.sleepHours?.toFixed(1)||"-"]);_(t,{startY:a,head:[["วันที่","ความดัน","ชีพจร","กินยา","นอน (ชม.)"]],body:u,theme:"striped",headStyles:{fillColor:i,...c&&{font:"Sarabun"}},bodyStyles:{...c&&{font:"Sarabun"}},margin:{left:14,right:14},styles:{fontSize:9,...c&&{font:"Sarabun"}}}),a=t.lastAutoTable.finalY+10;const M=o?.doctorQuestions||[];if(M.length>0){a>230&&(t.addPage(),a=20),p("bold",12),t.setTextColor(i[0],i[1],i[2]),t.text("คำถามถึงหมอ",14,a),t.setTextColor(0,0,0),a+=8;const n=M.map((g,N)=>[(N+1).toString(),g]);_(t,{startY:a,head:[["#","คำถาม"]],body:n,theme:"striped",headStyles:{fillColor:[99,102,241],...c&&{font:"Sarabun"}},bodyStyles:{...c&&{font:"Sarabun"}},margin:{left:14,right:14},styles:{fontSize:10,...c&&{font:"Sarabun"}},columnStyles:{0:{cellWidth:15},1:{cellWidth:"auto"}}}),a=t.lastAutoTable.finalY+10}const k=t.getNumberOfPages();for(let n=1;n<=k;n++)t.setPage(n),p("normal",8),t.setTextColor(128,128,128),t.text(`สร้างโดย OONJAI | ${S(new Date,"yyyy-MM-dd HH:mm")} | หน้า ${n}/${k}`,x/2,t.internal.pageSize.getHeight()-10,{align:"center"}),t.setTextColor(180,180,180),p("normal",7),t.text("ข้อมูลนี้เป็นข้อมูลที่ผู้ใช้บันทึกเอง ไม่ใช่การวินิจฉัยทางการแพทย์",x/2,t.internal.pageSize.getHeight()-5,{align:"center"});t.save(`รายงานสุขภาพ-${S(new Date,"yyyy-MM-dd")}.pdf`)}function ge(r,m){const h=xt({start:r,end:m}),o=h.map(d=>{const u=115+Math.floor(Math.random()*30),M=70+Math.floor(Math.random()*20),k=Math.random()>.2?100:Math.random()>.5?50:0,n=1e3+Math.floor(Math.random()*1500);return{date:S(d,"yyyy-MM-dd"),day:S(d,"d MMM",{locale:F}),systolic:Math.random()>.1?u:void 0,diastolic:Math.random()>.1?M:void 0,medsPercent:k,waterMl:Math.random()>.15?n:void 0}}),t=o.filter(d=>d.systolic&&d.diastolic),x=t.length>0?Math.round(t.reduce((d,u)=>d+(u.systolic||0),0)/t.length):0,a=t.length>0?Math.round(t.reduce((d,u)=>d+(u.diastolic||0),0)/t.length):0,c=o.filter(d=>d.medsPercent!==void 0),i=c.length>0?Math.round(c.reduce((d,u)=>d+(u.medsPercent||0),0)/c.length):0,p=o.filter(d=>d.waterMl!==void 0),b=p.length>0?Math.round(p.reduce((d,u)=>d+(u.waterMl||0),0)/p.length):0,j=[],f=["medication","vitals","water","symptom"];return h.forEach(d=>{const u=2+Math.floor(Math.random()*4);for(let M=0;M<u;M++){const k=f[Math.floor(Math.random()*f.length)],n=6+Math.floor(Math.random()*14),g=Math.floor(Math.random()*60);let N="",D="";switch(k){case"medication":N="กินยา",D=["ยาลดความดัน","Metformin","วิตามิน"][Math.floor(Math.random()*3)];break;case"vitals":N="วัดความดัน",D=`${115+Math.floor(Math.random()*30)}/${70+Math.floor(Math.random()*20)} mmHg`;break;case"water":N="ดื่มน้ำ",D=`${250+Math.floor(Math.random()*500)} มล.`;break;case"symptom":N="บันทึกอาการ",D=["ปวดหัว","เวียนศีรษะ","อ่อนเพลีย"][Math.floor(Math.random()*3)];break}j.push({id:`${S(d,"yyyy-MM-dd")}-${M}`,type:k,title:N,value:D,timestamp:new Date(d.setHours(n,g)).toISOString(),date:S(d,"d MMM",{locale:F}),time:`${n.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`})}}),j.sort((d,u)=>new Date(u.timestamp).getTime()-new Date(d.timestamp).getTime()),{summary:{bp:{avgSystolic:x,avgDiastolic:a,count:t.length,status:gt(x,a)},meds:{adherencePercent:i,takenCount:c.filter(d=>d.medsPercent===100).length,totalCount:c.length,status:i>=90?"good":i>=70?"fair":"poor"},water:{avgMl:b,daysRecorded:p.length,status:b>=1500?"good":b>=1e3?"fair":"poor"},activities:{total:j.length,byType:j.reduce((d,u)=>(d[u.type]=(d[u.type]||0)+1,d),{})}},chartData:o,activities:j.slice(0,30)}}const fe=new Date,Nt=[{id:"RPT-001",title:"รายงานส่งหมอ (1 หน้า)",range:"1 - 31 ม.ค. 2026",createdAt:"1 ก.พ. 2026 • 09:12 น.",status:"พร้อมดาวน์โหลด",expiresIn:"เหลือ 12 วัน"},{id:"RPT-002",title:"รายงานละเอียด 90 วัน",range:"1 พ.ย. 2025 - 31 ม.ค. 2026",createdAt:"31 ม.ค. 2026 • 20:05 น.",status:"พร้อมดาวน์โหลด",expiresIn:"เหลือ 3 วัน"},{id:"RPT-000",title:"รายงานเก่า (เกินกำหนด)",range:"1 - 15 ต.ค. 2025",createdAt:"16 ต.ค. 2025 • 08:30 น.",status:"หมดอายุแล้ว",expiresIn:"เก็บไว้ครบ 15 วัน"}],vt=r=>{switch(r){case"30d":return"30d";case"60d":return"90d";case"90d":return"90d";case"180d":return"90d";case"custom":return"30d";default:return"30d"}};function Ht(){const[,r]=Me(),{user:m,context:h}=ke(),o=h.patientId||(m.role==="patient"?m.profileId:null),[t,x]=v.useState("30d"),[a,c]=v.useState(!1),[i,p]=v.useState(!1),[b,j]=v.useState(!1),{data:f}=Ke(o),{data:R}=Ge(o),{data:d,isLoading:u}=pt(o,vt(t)),{data:M,isLoading:k}=De(o),n=Ce(),g=Te(),N=f?.drug_allergies||[],D=f?.food_allergies||[],ye=N.length>0||D.length>0,H=R?.filter(s=>s.active)||[],z=f?`${f.first_name} ${f.last_name}`:"ผู้ใช้งาน",Y=f?.birth_date?Math.floor((Date.now()-new Date(f.birth_date).getTime())/(365.25*24*60*60*1e3)):null,oe=f?.gender==="male"?"ชาย":f?.gender==="female"?"หญิง":null,{daysToSubtract:A,dateRangeText:E}=v.useMemo(()=>{let s=30;t==="30d"?s=30:t==="60d"?s=60:t==="90d"?s=90:t==="180d"&&(s=180);const y=P(fe,s);return{daysToSubtract:s,dateRangeText:`${S(y,"d MMM",{locale:F})} - ${S(fe,"d MMM yyyy",{locale:F})}`}},[t]),l=d?.summary,W=d?.chartData||[],q=d?.significantEvents||[],K=M?.filter(s=>!s.answered)||[],[G,le]=v.useState(""),[de,V]=v.useState(!1),ie=async()=>{G.trim()&&o&&(await n.mutateAsync({patientId:o,question:G.trim()}),le(""),V(!1))},je=async s=>{o&&await g.mutateAsync({id:s,patientId:o})},T=v.useMemo(()=>W.length?W.slice(-A):[],[W,A]),L=v.useMemo(()=>q.length?q:[],[q,i]),U=v.useMemo(()=>l?.bp?`${l.bp.avgSystolic}/${l.bp.avgDiastolic} mmHg`:"ไม่มีข้อมูล",[l]),J=v.useMemo(()=>l?.meds?`${l.meds.adherencePercent}%`:"ไม่มีข้อมูล",[l]),X=v.useMemo(()=>l?.sleep?`${l.sleep.avgHours.toFixed(1)} ชม.`:"ไม่มีข้อมูล",[l]),[Q,ce]=v.useState(!1),Ne=async()=>{if(!(!d||Q)){ce(!0);try{await jt(d,z,E,{patientName:z,patientAge:Y,patientGender:f?.gender,dateRange:E,drugAllergies:N,foodAllergies:D,medications:H.map(s=>({name:s.name,dosage_amount:s.dosage_amount,dosage_unit:s.dosage_unit})),doctorQuestions:K.map(s=>s.question)})}catch(s){console.error("PDF export failed:",s)}finally{ce(!1)}}};return e.jsxs("div",{className:"min-h-screen pb-32 font-sans relative z-10 bg-background",children:[e.jsxs("header",{className:"bg-card pt-12 pb-4 px-4 sticky top-0 z-20 flex justify-between items-center border-b border-border shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{variant:"ghost",size:"icon",onClick:()=>r("/settings"),className:"shrink-0",children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"รายงาน"})]}),e.jsx($,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-full bg-muted/30",onClick:()=>j(!0),children:e.jsx($e,{className:"h-5 w-5 text-foreground"})})]}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"overflow-x-auto pb-2 -mx-4 px-4 no-scrollbar",children:e.jsx("div",{className:"flex bg-muted/50 p-1 rounded-xl w-max",children:["30 วัน","60 วัน","90 วัน","180 วัน","กำหนดเอง"].map((s,y)=>{const Z=["30d","60d","90d","180d","custom"][y],ve=t===Z;return e.jsx("button",{onClick:()=>x(Z),className:w("px-4 py-2 text-xs font-semibold rounded-lg transition-all whitespace-nowrap",ve?"bg-card shadow-sm text-foreground":"text-muted-foreground"),children:s},Z)})})}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground pl-1",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-wider",children:E})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 px-1",children:[e.jsxs("div",{className:"bg-card border border-border/50 px-3 py-1.5 rounded-full text-[10px] font-bold text-foreground flex items-center gap-1.5 shadow-sm",children:[e.jsx(Fe,{className:"w-3 h-3 text-primary"})," ",z]}),Y&&oe&&e.jsxs("div",{className:"bg-card border border-border/50 px-3 py-1.5 rounded-full text-[10px] font-bold text-foreground shadow-sm",children:[Y," ปี / ",oe]}),ye&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-950/30 border border-red-100 dark:border-red-900/30 px-3 py-1.5 rounded-full text-[10px] font-bold text-red-600 dark:text-red-400 flex items-center gap-1.5 shadow-sm",children:[e.jsx(me,{className:"w-3 h-3"})," แพ้: ",[...N,...D].join(", ")]}),H.length>0&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-950/30 border border-orange-100 dark:border-orange-900/30 px-3 py-1.5 rounded-full text-[10px] font-bold text-orange-600 dark:text-orange-400 flex items-center gap-1.5 shadow-sm",children:[e.jsx(ee,{className:"w-3 h-3"})," ยา ",H.length," รายการ"]})]}),H.length>0&&e.jsxs("div",{className:"bg-card border border-border/50 rounded-2xl p-3 shadow-sm",children:[e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-2",children:"รายการยา"}),e.jsx("div",{className:"space-y-1.5",children:H.map(s=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(ee,{className:"w-3 h-3 text-orange-500 shrink-0"}),e.jsx("span",{className:"font-medium",children:s.name}),s.dosage_amount&&s.dosage_unit&&e.jsxs("span",{className:"text-muted-foreground",children:["(",s.dosage_amount," ",s.dosage_unit,")"]})]},s.id))})]})]}),e.jsx(B,{className:"border-none shadow-md bg-card overflow-hidden ring-1 ring-primary/10",children:e.jsxs(Re,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b border-border",children:[e.jsx(Xe,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-base font-bold text-foreground",children:"สรุป 10 วินาที"})]}),u?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(C,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:w("w-1.5 h-1.5 rounded-full mt-1.5 shrink-0",l?.bp?.status==="high"||l?.bp?.status==="crisis"?"bg-red-500":"bg-primary")}),e.jsxs("p",{className:"text-sm leading-relaxed",children:[e.jsx("span",{className:"font-bold",children:"ความดันเฉลี่ย:"})," ",U,l?.bp?.status==="high"&&" (สูงกว่าปกติ)",l?.bp?.status==="crisis"&&" (สูงมาก - ควรพบแพทย์)"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:w("w-1.5 h-1.5 rounded-full mt-1.5 shrink-0",l?.meds?.status==="poor"?"bg-orange-500":l?.meds?.status==="fair"?"bg-yellow-500":"bg-emerald-500")}),e.jsxs("p",{className:"text-sm leading-relaxed",children:[e.jsx("span",{className:"font-bold",children:"การกินยา:"})," ครบ ",J,l?.meds&&l.meds.totalCount>l.meds.takenCount&&` (พลาด ${l.meds.totalCount-l.meds.takenCount} ครั้ง)`]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:w("w-1.5 h-1.5 rounded-full mt-1.5 shrink-0",l?.water?.status==="poor"?"bg-orange-500":"bg-primary")}),e.jsxs("p",{className:"text-sm leading-relaxed",children:[e.jsx("span",{className:"font-bold",children:"น้ำดื่มเฉลี่ย:"})," ",l?.water?.avgMl||0," มล./วัน",l?.water?.status==="poor"&&" (น้อยเกินไป)"]})]}),l?.sleep&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:w("w-1.5 h-1.5 rounded-full mt-1.5 shrink-0",l.sleep.status==="poor"?"bg-purple-500":"bg-primary")}),e.jsxs("p",{className:"text-sm leading-relaxed",children:[e.jsx("span",{className:"font-bold",children:"การนอนเฉลี่ย:"})," ",X,l.sleep.status==="poor"&&" (น้อยกว่าที่ควร)"]})]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest pl-1",children:"กราฟสรุป"}),e.jsx(B,{className:"border-none shadow-sm bg-card p-4 space-y-6",children:u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(C,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-xs font-bold flex items-center gap-1.5",children:[e.jsx(xe,{className:"w-3 h-3 text-primary"})," ความดัน & ชีพจร"]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["เฉลี่ย ",U]})]}),e.jsx("div",{className:"h-[100px] w-full",children:T.length>0?e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:T,children:[e.jsx(se,{type:"monotone",dataKey:"systolic",stroke:"#0E8A9A",strokeWidth:2,dot:{r:2}}),e.jsx(se,{type:"monotone",dataKey:"diastolic",stroke:"#0E8A9A",strokeOpacity:.5,strokeWidth:2,dot:{r:2}}),e.jsx(se,{type:"monotone",dataKey:"pulse",stroke:"#F2994A",strokeWidth:2,dot:!1}),e.jsx(ae,{strokeDasharray:"3 3",vertical:!1,stroke:"#f0f0f0"}),e.jsx(et,{contentStyle:{fontSize:"10px"}})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-muted-foreground",children:"ไม่มีข้อมูล"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-xs font-bold flex items-center gap-1.5",children:[e.jsx(ee,{className:"w-3 h-3 text-orange-500"})," การกินยา"]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["ครบ ",J]})]}),e.jsx("div",{className:"h-[60px] w-full",children:T.length>0?e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(ue,{data:T,children:[e.jsx(he,{dataKey:"medsPercent",radius:[4,4,0,0],children:T.map((s,y)=>e.jsx(tt,{fill:s.medsPercent===100?"#10b981":(s.medsPercent??0)<50?"#ef4444":"#f97316"},`cell-${y}`))}),e.jsx(ae,{strokeDasharray:"3 3",vertical:!1,stroke:"#f0f0f0"})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-muted-foreground",children:"ไม่มีข้อมูล"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-xs font-bold flex items-center gap-1.5",children:[e.jsx(He,{className:"w-3 h-3 text-purple-500"})," การนอน"]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["เฉลี่ย ",X]})]}),e.jsx("div",{className:"h-[60px] w-full",children:T.some(s=>s.sleepHours!==void 0)?e.jsx(te,{width:"100%",height:"100%",children:e.jsxs(ue,{data:T,children:[e.jsx(he,{dataKey:"sleepHours",radius:[4,4,0,0],fill:"#8b5cf6"}),e.jsx(ae,{strokeDasharray:"3 3",vertical:!1,stroke:"#f0f0f0"})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-xs text-muted-foreground",children:"ไม่มีข้อมูล"})})]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest pl-1",children:"ความสม่ำเสมอ"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(B,{className:"border-none shadow-sm bg-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-2",children:[e.jsx(xe,{className:"w-3 h-3 text-primary"})," ความดัน"]}),e.jsx("div",{className:"space-y-1",children:u?e.jsx(C,{className:"w-4 h-4 animate-spin text-primary"}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold",children:[l?.bp?.avgSystolic||"-"," / ",l?.bp?.avgDiastolic||"-"," ",e.jsx("span",{className:"text-[10px] text-muted-foreground font-normal ml-1",children:"เฉลี่ย"})]}),e.jsxs("p",{className:w("text-[10px] font-medium",l?.bp?.count&&l.bp.count>=A*.8?"text-emerald-600":"text-orange-600"),children:["บันทึก ",l?.bp?.count||0,"/",A," วัน"]})]})})]}),e.jsxs(B,{className:"border-none shadow-sm bg-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-2",children:[e.jsx(_e,{className:"w-3 h-3 text-orange-500"})," ชีพจร"]}),e.jsx("div",{className:"space-y-1",children:u?e.jsx(C,{className:"w-4 h-4 animate-spin text-primary"}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold",children:[l?.bp?.avgHeartRate||"-"," ",e.jsx("span",{className:"text-[10px] text-muted-foreground font-normal ml-1",children:"เฉลี่ย"})]}),e.jsxs("p",{className:w("text-[10px] font-medium",l?.bp?.count&&l.bp.count>=A*.8?"text-emerald-600":"text-orange-600"),children:["บันทึก ",l?.bp?.count||0,"/",A," วัน"]})]})})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest pl-1 flex items-center gap-1.5",children:[e.jsx(ze,{className:"w-3 h-3 text-orange-400 fill-orange-400"})," วันที่มีนัยยะ (หมอควรดู)"]}),e.jsxs("button",{onClick:()=>p(!i),className:"text-[10px] font-bold text-primary flex items-center gap-1",children:[i?e.jsx(st,{className:"w-3 h-3"}):e.jsx("div",{className:"w-3 h-3 rounded-full border border-primary"}),"คัดมาให้แล้ว"]})]}),e.jsx("div",{className:"bg-card rounded-3xl shadow-sm divide-y divide-border/30 overflow-hidden ring-1 ring-orange-100 dark:ring-orange-900/30",children:u?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(C,{className:"w-6 h-6 animate-spin text-primary"})}):L.length===0?e.jsx("div",{className:"flex items-center justify-center py-8 text-xs text-muted-foreground",children:"ไม่มีเหตุการณ์สำคัญในช่วงนี้"}):L.map((s,y)=>e.jsxs("div",{className:"flex items-start gap-4 p-4 hover:bg-orange-50/30 dark:hover:bg-orange-950/10 transition-colors cursor-pointer active:bg-orange-50 dark:active:bg-orange-950/20",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 min-w-[40px]",children:[e.jsx("span",{className:"text-[10px] font-bold text-muted-foreground whitespace-nowrap",children:s.date.split(" ")[0]}),s.date.split(" ")[1]&&e.jsx("span",{className:"text-[9px] text-muted-foreground/70",children:s.date.split(" ")[1]})]}),e.jsx("div",{className:"flex-1 space-y-1",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("p",{className:"text-xs font-bold text-foreground leading-tight",children:s.title}),e.jsx("span",{className:w("text-[9px] px-1.5 py-0.5 rounded-md font-bold uppercase tracking-wide",s.type==="health"?"bg-blue-100 dark:bg-blue-950/30 text-blue-700 dark:text-blue-400":s.type==="meds"?"bg-orange-100 dark:bg-orange-950/30 text-orange-700 dark:text-orange-400":s.type==="sleep"?"bg-purple-100 dark:bg-purple-950/30 text-purple-700 dark:text-purple-400":"bg-red-100 dark:bg-red-950/30 text-red-700 dark:text-red-400"),children:s.tag})]})})]},y))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-widest pl-1",children:"คำถามถึงหมอ"}),e.jsxs("div",{className:"bg-card rounded-2xl p-4 shadow-sm border-2 border-dashed border-border relative space-y-3",children:[e.jsx(ct,{className:"absolute top-4 right-4 w-4 h-4 text-muted-foreground/30"}),k?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(C,{className:"w-5 h-5 animate-spin text-primary"})}):K.length===0&&!de?e.jsx("p",{className:"text-xs text-muted-foreground text-center py-2",children:"ยังไม่มีคำถาม"}):e.jsx("ul",{className:"space-y-2",children:K.map((s,y)=>e.jsxs("li",{className:"flex items-start gap-2 group",children:[e.jsxs("span",{className:"text-xs font-bold text-muted-foreground min-w-[16px] mt-0.5",children:[y+1,")"]}),e.jsx("p",{className:"text-xs text-foreground flex-1 leading-relaxed",children:s.question}),e.jsx("button",{onClick:()=>je(s.id),disabled:g.isPending,className:"text-muted-foreground hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity disabled:opacity-50",children:e.jsx(Ee,{className:"w-3.5 h-3.5"})})]},s.id))}),de?e.jsxs("div",{className:"flex gap-2 animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("input",{autoFocus:!0,type:"text",value:G,onChange:s=>le(s.target.value),placeholder:"พิมพ์คำถาม...",className:"flex-1 bg-muted/30 rounded-xl px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-primary/20",onKeyDown:s=>{s.key==="Enter"&&ie(),s.key==="Escape"&&V(!1)}}),e.jsx($,{size:"icon",className:"h-8 w-8 rounded-xl bg-primary text-primary-foreground",onClick:ie,disabled:n.isPending,children:n.isPending?e.jsx(C,{className:"w-4 h-4 animate-spin"}):e.jsx(Le,{className:"w-4 h-4"})})]}):e.jsx($,{variant:"ghost",onClick:()=>V(!0),className:"w-full h-8 text-xs font-bold text-accent border border-accent/20 rounded-xl mt-1 hover:bg-accent/5",children:"+ เพิ่มคำถาม"})]})]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{className:"border border-border rounded-2xl bg-muted/20 overflow-hidden",children:[e.jsxs("button",{onClick:()=>c(!a),className:"w-full flex items-center justify-between p-4 bg-card/50 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-foreground",children:[e.jsx(ot,{className:"w-4 h-4 text-primary"})," พรีวิวเอกสาร A4"]}),a?e.jsx(at,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(rt,{className:"w-4 h-4 text-muted-foreground"})]}),a&&e.jsx("div",{className:"p-4 flex justify-center bg-muted/50",children:e.jsxs("div",{className:"w-full max-w-[300px] bg-card shadow-2xl p-4 text-[8px] leading-relaxed flex flex-col gap-2 text-foreground rounded-lg",children:[e.jsx("div",{className:"flex justify-between border-b pb-2 border-border",children:e.jsxs("h1",{className:"text-sm font-bold",children:["รายงานสุขภาพ: ",z]})}),e.jsxs("div",{className:"text-[7px] text-muted-foreground",children:[e.jsxs("p",{children:["ช่วงเวลา: ",E]}),e.jsxs("p",{children:["สร้างเมื่อ: ",S(new Date,"d MMM yyyy",{locale:F})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("div",{className:"border border-border p-2 rounded",children:[e.jsx("h2",{className:"font-bold mb-1",children:"สรุปสำคัญ"}),e.jsxs("ul",{className:"list-disc pl-2 space-y-0.5",children:[e.jsxs("li",{children:["ความดัน: ",U]}),e.jsxs("li",{children:["กินยาครบ: ",J]}),L.length>0&&e.jsxs("li",{children:["เหตุการณ์สำคัญ: ",L.length," รายการ"]})]})]}),e.jsxs("div",{className:"border border-border p-2 rounded",children:[e.jsx("h2",{className:"font-bold mb-1",children:"สถิติรวม"}),e.jsxs("p",{children:["ความดันเฉลี่ย: ",l?.bp?`${l.bp.avgSystolic}/${l.bp.avgDiastolic}`:"-"]}),e.jsxs("p",{children:["ชีพจรเฉลี่ย: ",l?.bp?.avgHeartRate||"-"," bpm"]}),e.jsxs("p",{children:["นอนเฉลี่ย: ",X]})]})]}),e.jsx("div",{className:"h-16 border border-border bg-muted/30 flex items-center justify-center text-muted-foreground rounded mt-2",children:"[กราฟสรุป]"}),e.jsx("div",{className:"mt-auto border-t border-border pt-1 text-center text-[6px] text-muted-foreground",children:"ข้อมูลนี้เป็นข้อมูลที่ผู้ใช้บันทึกเอง"})]})})]}),e.jsxs($,{onClick:Ne,className:"w-full h-12 rounded-2xl bg-primary text-primary-foreground font-bold shadow-xl shadow-primary/20",disabled:u||!d||Q,children:[u||Q?e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(dt,{className:"w-4 h-4 mr-2"}),Q?"กำลังสร้าง PDF...":"ดาวน์โหลด PDF"]})]})]}),e.jsx(Qe,{open:b,onOpenChange:j,children:e.jsxs(Be,{className:"max-h-[80vh]",children:[e.jsxs(Ie,{children:[e.jsx(Oe,{className:"text-center text-lg font-bold",children:"ประวัติรายงานที่สร้างแล้ว"}),e.jsxs(Ye,{className:"text-center text-[11px] leading-snug",children:["รายงานที่สร้างจะถูกเก็บไว้ให้ดาวน์โหลดได้ภายใน"," ",e.jsx("span",{className:"font-semibold text-foreground",children:"15 วัน"})," นับจากวันที่สร้าง"]})]}),e.jsxs("div",{className:"px-4 pb-6 space-y-3 overflow-y-auto",children:[e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-900/30 rounded-2xl px-3 py-2 text-[11px] text-amber-800 dark:text-amber-400 flex items-start gap-2",children:[e.jsx(me,{className:"w-3.5 h-3.5 mt-0.5"}),e.jsx("p",{children:"ตัวอย่างนี้เป็นข้อมูลเดโม่ เพื่อให้เห็นหน้าตารายการรายงานที่เคยสร้าง"})]}),e.jsx("div",{className:"bg-card rounded-2xl shadow-sm divide-y divide-border/30 overflow-hidden",children:Nt.map(s=>{const y=s.status==="หมดอายุแล้ว";return e.jsxs("div",{className:"flex items-start gap-3 p-4 hover:bg-muted/30 transition-colors",children:[e.jsx("div",{className:"mt-1",children:e.jsx(We,{className:w("w-5 h-5",y?"text-muted-foreground":"text-primary")})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:s.title}),e.jsx("span",{className:w("text-[10px] px-2 py-0.5 rounded-full font-semibold whitespace-nowrap",y?"bg-muted text-muted-foreground":"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-700 dark:text-emerald-400"),children:s.status})]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["ช่วงข้อมูล: ",s.range]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground/80",children:["สร้างเมื่อ: ",s.createdAt]}),e.jsx("p",{className:w("text-[10px] font-medium",y?"text-muted-foreground":"text-orange-600 dark:text-orange-400"),children:s.expiresIn})]}),e.jsx("div",{className:"mt-1",children:e.jsx($,{variant:"ghost",size:"sm",disabled:y,className:w("h-8 px-3 text-[11px] rounded-xl border",y?"border-muted text-muted-foreground cursor-not-allowed opacity-50":"border-primary/30 text-primary hover:bg-primary/5"),children:"ดาวน์โหลด"})})]},s.id)})})]})]})}),e.jsx(qe,{})]})}export{Ht as default};
