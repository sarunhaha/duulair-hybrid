import{r as a,j as e}from"./vendor-query-CmnYLxAr.js";import{c as h,v as _,n as R,w as $,s as A,e as o,h as T,f as m,L as B,g as x,x as J,X as M}from"./index-DVcQm8JY.js";import{L as U}from"./lightbulb-C7old9bh.js";import{S as z}from"./share-2-BnbYGEbP.js";import{C as F}from"./copy-CEVl0-hP.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-pdf-IriBjpIe.js";import"./vendor-charts-Cp29jYec.js";import"./vendor-ui-Q3AHpcc6.js";const P=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Q=h("circle-check-big",P);const D=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],H=h("link",D);const W=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],X=h("user-check",W);function ae(){const N=_(),n=new URLSearchParams(N),d=n.get("patient_id"),u=n.get("caregiver_id"),p=n.get("returning")==="true",{closeWindow:y,shareTargetPicker:b,isInClient:w}=R(),{toast:c}=$(),[r,l]=a.useState("already-registered"),[s,v]=a.useState(null),[C,g]=a.useState(!1),[f,k]=a.useState(null);a.useEffect(()=>{d?(l("patient"),L(d)):l(u?"caregiver":"already-registered")},[d,u]);const L=async t=>{g(!0);try{const i=await A.generateLinkCode(t);v(i.code)}catch(i){console.error("Failed to generate link code:",i),k("ไม่สามารถสร้างรหัสเชื่อมต่อได้")}finally{g(!1)}},I=async()=>{if(!s)return;const t={type:"text",text:`รหัสเชื่อมต่อ OONJAI

รหัส: ${s}

ใช้รหัสนี้เพื่อเชื่อมต่อกับบัญชีผู้ป่วยของฉัน

เปิด LINE → OONJAI → ลงทะเบียนผู้ดูแล → กรอกรหัสนี้`};await b([t])?c({title:"แชร์รหัสเรียบร้อย",description:"รหัสถูกส่งไปยังผู้รับที่เลือกแล้ว"}):j()},j=async()=>{if(s)try{await navigator.clipboard.writeText(s),c({title:"คัดลอกรหัสเรียบร้อย",description:`รหัส ${s} ถูกคัดลอกแล้ว`})}catch{const t=document.createElement("input");t.value=s,document.body.appendChild(t),t.select();try{document.execCommand("copy"),c({title:"คัดลอกรหัสเรียบร้อย",description:`รหัส ${s} ถูกคัดลอกแล้ว`})}catch{c({title:"ไม่สามารถคัดลอกได้",description:"กรุณาคัดลอกรหัสด้วยตนเอง",variant:"destructive"})}document.body.removeChild(t)}},S=()=>{w?y():window.close()},E=()=>p?"ยินดีต้อนรับกลับ!":r==="caregiver"?"เชื่อมต่อสำเร็จ!":r==="already-registered"?"คุณลงทะเบียนแล้ว":"ลงทะเบียนสำเร็จ!",q=()=>p?"คุณลงทะเบียนไว้แล้ว":r==="caregiver"?"คุณสามารถติดตามสุขภาพของผู้ป่วยได้แล้ว":r==="already-registered"?"ขอบคุณที่ใช้บริการ":"ขอบคุณที่ใช้บริการ OONJAI",O=()=>s?`https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(`OONJAI:${s}`)}&color=1E7B9C`:"";return e.jsx("div",{className:"min-h-screen bg-background pb-8",children:e.jsxs("div",{className:"max-w-md mx-auto px-4 py-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-success to-success/80 flex items-center justify-center mx-auto mb-4 shadow-lg shadow-success/30 animate-in zoom-in-50 duration-500",children:e.jsx(Q,{className:"w-12 h-12 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-1",children:E()}),e.jsx("p",{className:"text-muted-foreground",children:q()})]}),r==="patient"&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{className:"border shadow-sm overflow-hidden mb-6",children:[e.jsx(T,{className:"bg-muted border-b p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/15 flex items-center justify-center",children:e.jsx(H,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-foreground",children:"รหัสเชื่อมต่อของคุณ"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"แชร์รหัสนี้กับผู้ดูแล"})]})]})}),e.jsxs(m,{className:"p-6 text-center space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"แชร์รหัสนี้กับผู้ดูแลเพื่อให้เขาเชื่อมต่อกับบัญชีของคุณ"}),C?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(B,{className:"w-8 h-8 animate-spin text-primary"})}):f?e.jsx("div",{className:"text-destructive text-sm py-4",children:f}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-block bg-muted px-6 py-4 rounded-xl border-2 border-dashed border-border",children:e.jsx("span",{className:"text-3xl font-bold text-primary font-mono tracking-wider",children:s})}),e.jsx("div",{className:"bg-white p-4 rounded-xl inline-block shadow-md",children:e.jsx("img",{src:O(),alt:"QR Code",width:180,height:180,className:"block"})}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-primary/8 border border-primary/20 rounded-xl text-left",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/15 flex items-center justify-center flex-shrink-0",children:e.jsx(U,{className:"w-4 h-4 text-primary"})}),e.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:"ผู้ดูแลสามารถสแกน QR Code หรือกรอกรหัส 6 หลักเพื่อเชื่อมต่อกับคุณ"})]})]})]})]}),s&&e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs(x,{onClick:I,className:"w-full gap-2 h-12",children:[e.jsx(z,{className:"w-5 h-5"}),"แชร์รหัส"]}),e.jsxs(x,{onClick:j,variant:"outline",className:"w-full gap-2 h-12",children:[e.jsx(F,{className:"w-5 h-5"}),"คัดลอกรหัส"]})]})]}),r==="caregiver"&&e.jsx(o,{className:"border shadow-sm mb-6",children:e.jsxs(m,{className:"p-6 text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-success/15 flex items-center justify-center mx-auto",children:e.jsx(X,{className:"w-8 h-8 text-success"})}),e.jsxs("p",{className:"text-muted-foreground",children:["คุณได้เชื่อมต่อกับผู้ป่วยเรียบร้อยแล้ว",e.jsx("br",{}),"ตอนนี้คุณสามารถดูข้อมูลและติดตามสุขภาพของผู้ป่วยได้แล้ว"]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-primary/8 border border-primary/20 rounded-xl text-left",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/15 flex items-center justify-center flex-shrink-0",children:e.jsx(J,{className:"w-4 h-4 text-primary"})}),e.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:"คุณจะได้รับแจ้งเตือนเกี่ยวกับสุขภาพของผู้ป่วยผ่าน LINE ทันที"})]})]})}),r==="already-registered"&&e.jsx(o,{className:"border shadow-sm mb-6",children:e.jsx(m,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"คุณได้ลงทะเบียนไว้แล้ว"})})}),e.jsxs(x,{onClick:S,variant:"outline",className:"w-full gap-2 h-12 mb-6",children:[e.jsx(M,{className:"w-5 h-5"}),"ปิด"]}),e.jsxs("p",{className:"text-center text-sm text-muted-foreground leading-relaxed",children:["คุณสามารถเริ่มใช้งานระบบได้ทันที",e.jsx("br",{}),'พิมพ์ "สวัสดี" ใน LINE Chat เพื่อทดสอบ']})]})})}export{ae as default};
