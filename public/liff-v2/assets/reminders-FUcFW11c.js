import{r as o,j as e}from"./vendor-query-OvJu5Khy.js";import{c as K,a as N,y as ee,a1 as se,Q as te,a2 as ae,g as f,W as z,L,e as I,f as q,a0 as le,R as T,m as ne,a4 as ie,q as re,r as ce,s as oe,t as de,X as ue,E as w,P as me,_ as xe,H as fe,a6 as he,I as pe,a7 as be,J as ge,a5 as ve,$ as je}from"./index-Bd4h0egF.js";import{e as O,u as ye,a as we,d as M,f as Ne,g as _e,h as ke}from"./vendor-ui-CYcp45lG.js";import{S as Ce,a as Se,b as Pe,c as Re,d as Ee}from"./select-D9BVi-_l.js";import{k as Le,l as Ie,m as qe,n as Te}from"./use-profile-DgpZCTWV.js";import{B as De,P as Ae}from"./pen-B0RFyO8g.js";import"./vendor-react-qkC6yhPU.js";import"./chevron-down-CDKzBmJi.js";import"./chevron-up-TwEeb8dx.js";const ze=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],Be=K("utensils",ze);var S="Switch",[Oe]=we(S),[Me,He]=Oe(S),H=o.forwardRef((c,m)=>{const{__scopeSwitch:a,name:x,checked:n,defaultChecked:_,required:p,disabled:i,value:h="on",onCheckedChange:b,form:d,...k}=c,[v,u]=o.useState(null),g=O(m,y=>u(y)),j=o.useRef(!1),t=v?d||!!v.closest("form"):!0,[r,P]=ye({prop:n,defaultProp:_??!1,onChange:b,caller:S});return e.jsxs(Me,{scope:a,checked:r,disabled:i,children:[e.jsx(M.button,{type:"button",role:"switch","aria-checked":r,"aria-required":p,"data-state":W(r),"data-disabled":i?"":void 0,disabled:i,value:h,...k,ref:g,onClick:Ne(c.onClick,y=>{P(R=>!R),t&&(j.current=y.isPropagationStopped(),j.current||y.stopPropagation())})}),t&&e.jsx(V,{control:v,bubbles:!j.current,name:x,value:h,checked:r,required:p,disabled:i,form:d,style:{transform:"translateX(-100%)"}})]})});H.displayName=S;var F="SwitchThumb",U=o.forwardRef((c,m)=>{const{__scopeSwitch:a,...x}=c,n=He(F,a);return e.jsx(M.span,{"data-state":W(n.checked),"data-disabled":n.disabled?"":void 0,...x,ref:m})});U.displayName=F;var Fe="SwitchBubbleInput",V=o.forwardRef(({__scopeSwitch:c,control:m,checked:a,bubbles:x=!0,...n},_)=>{const p=o.useRef(null),i=O(p,_),h=_e(a),b=ke(m);return o.useEffect(()=>{const d=p.current;if(!d)return;const k=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(k,"checked").set;if(h!==a&&u){const g=new Event("click",{bubbles:x});u.call(d,a),d.dispatchEvent(g)}},[h,a,x]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...n,tabIndex:-1,ref:i,style:{...n.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});V.displayName=Fe;function W(c){return c?"checked":"unchecked"}var X=H,Ue=U;const Y=o.forwardRef(({className:c,...m},a)=>e.jsx(X,{className:N("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",c),...m,ref:a,children:e.jsx(Ue,{className:N("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Y.displayName=X.displayName;const D=[{value:"medication",label:"กินยา",icon:me,color:"bg-purple-500/10 text-purple-500",gradient:"from-purple-500 to-purple-600"},{value:"water",label:"ดื่มน้ำ",icon:xe,color:"bg-blue-500/10 text-blue-500",gradient:"from-blue-500 to-blue-600"},{value:"vitals",label:"วัดความดัน",icon:fe,color:"bg-red-500/10 text-red-500",gradient:"from-red-500 to-red-600"},{value:"food",label:"ทานอาหาร",icon:Be,color:"bg-orange-500/10 text-orange-500",gradient:"from-orange-500 to-orange-600"},{value:"exercise",label:"ออกกำลังกาย",icon:he,color:"bg-green-500/10 text-green-500",gradient:"from-green-500 to-green-600"}],A=[{value:"monday",label:"จ",fullLabel:"จันทร์"},{value:"tuesday",label:"อ",fullLabel:"อังคาร"},{value:"wednesday",label:"พ",fullLabel:"พุธ"},{value:"thursday",label:"พฤ",fullLabel:"พฤหัสบดี"},{value:"friday",label:"ศ",fullLabel:"ศุกร์"},{value:"saturday",label:"ส",fullLabel:"เสาร์"},{value:"sunday",label:"อา",fullLabel:"อาทิตย์"}],B={type:"medication",title:"",time:"08:00",note:"",frequency:"daily",days_of_week:[],is_active:!0};function Ke(){const[,c]=ee(),m=se(),{toast:a}=te(),x=ae(),n=x.patientId,[_,p]=o.useState(!1);!m.isLoading&&!x.isLoading&&!n&&!_&&(p(!0),x.ensurePatient());const{data:i,isLoading:h}=Le(n),b=Ie(),d=qe(),k=Te(),[v,u]=o.useState(!1),[g,j]=o.useState(null),[t,r]=o.useState(B),P=()=>{j(null),r(B),u(!0)},y=s=>{j(s.id),r({type:s.type,title:s.title,time:s.custom_time||s.time||"08:00",note:s.note||"",frequency:s.frequency==="specific_days"?"specific_days":"daily",days_of_week:s.days_of_week||[],is_active:s.is_active}),u(!0)},R=async s=>{if(n&&confirm("ต้องการลบการเตือนนี้หรือไม่?"))try{await k.mutateAsync({id:s,patientId:n}),a({title:"ลบการเตือนเรียบร้อยแล้ว"})}catch{a({title:"ไม่สามารถลบการเตือนได้",variant:"destructive"})}},$=async s=>{if(n)try{await d.mutateAsync({id:s.id,data:{is_active:!s.is_active,patient_id:n}})}catch{a({title:"ไม่สามารถเปลี่ยนสถานะได้",variant:"destructive"})}},J=async()=>{if(!n){a({title:"กรุณาคุยกับน้องอุ่นใน LINE Chat ก่อนนะคะ",variant:"destructive"});return}if(!t.title.trim()){a({title:"กรุณาระบุชื่อเตือน",variant:"destructive"});return}if(!t.time){a({title:"กรุณาระบุเวลาเตือน",variant:"destructive"});return}if(t.frequency==="specific_days"&&t.days_of_week.length===0){a({title:"กรุณาเลือกวันที่ต้องการเตือน",variant:"destructive"});return}try{g?(await d.mutateAsync({id:g,data:{...t,custom_time:t.time,days_of_week:t.frequency==="specific_days"?t.days_of_week:void 0,patient_id:n}}),a({title:"แก้ไขการเตือนเรียบร้อยแล้ว"})):(await b.mutateAsync({...t,custom_time:t.time,days_of_week:t.frequency==="specific_days"?t.days_of_week:void 0,patient_id:n}),a({title:"เพิ่มการเตือนเรียบร้อยแล้ว"})),u(!1)}catch{a({title:"ไม่สามารถบันทึกการเตือนได้",variant:"destructive"})}},Q=s=>{r(l=>({...l,days_of_week:l.days_of_week.includes(s)?l.days_of_week.filter(E=>E!==s):[...l.days_of_week,s]}))},Z=s=>D.find(l=>l.value===s)||D[0];return m.isLoading?e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-12 pb-4 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>c("/settings"),children:e.jsx(z,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"ตั้งเวลาเตือน"})]}),e.jsx("main",{className:"max-w-md mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-3",children:[e.jsx(L,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"กำลังโหลด..."})]})})]}):e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-12 pb-4 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>c("/settings"),children:e.jsx(z,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"ตั้งเวลาเตือน"})]}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-4",children:[e.jsx(I,{className:"border-none shadow-lg bg-gradient-to-br from-teal-500 to-teal-600 text-white overflow-hidden",children:e.jsxs(q,{className:"p-6 relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("p",{className:"text-sm text-white/80",children:"การเตือนทั้งหมด"}),e.jsxs("p",{className:"text-4xl font-bold mt-1",children:[i?.length||0," ",e.jsx("span",{className:"text-lg font-normal",children:"รายการ"})]}),e.jsxs("p",{className:"text-sm text-white/80 mt-1",children:["เปิดใช้งาน ",i?.filter(s=>s.is_active).length||0," รายการ"]})]})]})}),e.jsxs(f,{className:"w-full gap-2",size:"lg",onClick:P,children:[e.jsx(le,{className:"w-5 h-5"}),"เพิ่มการเตือน"]}),h&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{className:"w-8 h-8 animate-spin text-primary"})}),!h&&(!i||i.length===0)&&e.jsx(I,{className:"border-none shadow-sm bg-card",children:e.jsxs(q,{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-muted rounded-full flex items-center justify-center",children:e.jsx(T,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"font-bold text-foreground",children:"ยังไม่มีการเตือน"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"กดปุ่มด้านบนเพื่อเพิ่มการเตือน"})]})}),i&&i.length>0&&e.jsx("div",{className:"space-y-3",children:i.map(s=>{const l=Z(s.type),E=l.icon;return e.jsx(I,{className:"border-none shadow-sm bg-card overflow-hidden",children:e.jsxs(q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:N("p-2 rounded-xl",l.color),children:e.jsx(E,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-foreground",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.label})]})]}),e.jsx("div",{className:N("p-1.5 rounded-full",s.is_active?"bg-green-100 dark:bg-green-950/30":"bg-muted"),children:s.is_active?e.jsx(T,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx(De,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:s.custom_time||s.time}),e.jsx(Y,{checked:s.is_active,onCheckedChange:()=>$(s)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-3",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:s.frequency==="daily"?"ทุกวัน":s.days_of_week?.map(C=>A.find(G=>G.value===C)?.fullLabel).join(", ")||"ตามกำหนด"})]}),s.frequency==="specific_days"&&s.days_of_week&&e.jsx("div",{className:"flex gap-1 mb-3",children:A.map(C=>e.jsx("span",{className:N("w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-bold",s.days_of_week?.includes(C.value)?"bg-primary text-white":"bg-muted text-muted-foreground"),children:C.label},C.value))}),s.note&&e.jsx("div",{className:"p-2 bg-accent/10 border-l-2 border-accent rounded text-xs text-muted-foreground mb-3",children:s.note}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"default",size:"sm",className:"flex-1 gap-1",onClick:()=>y(s),children:[e.jsx(Ae,{className:"w-4 h-4"}),"แก้ไข"]}),e.jsxs(f,{variant:"destructive",size:"sm",className:"flex-1 gap-1",onClick:()=>R(s.id),children:[e.jsx(ie,{className:"w-4 h-4"}),"ลบ"]})]})]})},s.id)})})]}),e.jsx(re,{open:v,onOpenChange:u,children:e.jsxs(ce,{className:"max-h-[90vh]",children:[e.jsx(oe,{className:"border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-primary"}),g?"แก้ไขการเตือน":"เพิ่มการเตือน"]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>u(!1),children:e.jsx(ue,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"ประเภท"}),e.jsxs(Ce,{value:t.type,onValueChange:s=>r(l=>({...l,type:s})),children:[e.jsx(Se,{children:e.jsx(Pe,{})}),e.jsx(Re,{children:D.map(s=>e.jsx(Ee,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"reminder_title",children:"ชื่อเตือน *"}),e.jsx(pe,{id:"reminder_title",value:t.title,onChange:s=>r(l=>({...l,title:s.target.value})),placeholder:"เช่น กินยาความดัน"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"เวลาเตือน *"}),e.jsx(be,{value:t.time,onChange:s=>r(l=>({...l,time:s})),placeholder:"เลือกเวลา"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"ความถี่"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"button",variant:t.frequency==="daily"?"default":"outline",className:"flex-1",onClick:()=>r(s=>({...s,frequency:"daily"})),children:"ทุกวัน"}),e.jsx(f,{type:"button",variant:t.frequency==="specific_days"?"default":"outline",className:"flex-1",onClick:()=>r(s=>({...s,frequency:"specific_days"})),children:"เลือกวัน"})]})]}),t.frequency==="specific_days"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"เลือกวันที่ต้องการเตือน"}),e.jsx("div",{className:"flex gap-2 justify-center",children:A.map(s=>e.jsx("button",{type:"button",onClick:()=>Q(s.value),className:N("w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold transition-colors",t.days_of_week.includes(s.value)?"bg-primary text-white":"bg-muted text-muted-foreground hover:bg-muted/80"),children:s.label},s.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"หมายเหตุ (ถ้ามี)"}),e.jsx(ge,{value:t.note,onChange:s=>r(l=>({...l,note:s.target.value})),placeholder:"เพิ่มรายละเอียดเพิ่มเติม",rows:2})]})]}),e.jsx(ve,{className:"border-t border-border",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",className:"flex-1",onClick:()=>u(!1),children:"ยกเลิก"}),e.jsxs(f,{className:"flex-1 gap-2",onClick:J,disabled:b.isPending||d.isPending,children:[(b.isPending||d.isPending)&&e.jsx(L,{className:"w-4 h-4 animate-spin"}),e.jsx(je,{className:"w-4 h-4"}),"บันทึก"]})]})})]})})]})}export{Ke as default};
