import{r as h,j as e}from"./vendor-query-OvJu5Khy.js";import{c as k,G as B,E,I as P,u as X,e as x,f as p,i as j,U as _,J as d,K as o,N as O,O as U,g as R,L as A,b as H,Q as T}from"./index-DdYhxTwe.js";import{S as J,a as q,b as M,c as G,d as Q}from"./select-Bxg0JgmD.js";import{I as f}from"./info-DhoFDz7A.js";import{L as V}from"./lightbulb-CqdS7vDS.js";import{S as Y}from"./shield-check-D3k1qpiK.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-CYcp45lG.js";const z=[["path",{d:"M11 14h2a2 2 0 0 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 16",key:"1v1a37"}],["path",{d:"m14.45 13.39 5.05-4.694C20.196 8 21 6.85 21 5.75a2.75 2.75 0 0 0-4.797-1.837.276.276 0 0 1-.406 0A2.75 2.75 0 0 0 11 5.75c0 1.2.802 2.248 1.5 2.946L16 11.95",key:"fhfbnt"}],["path",{d:"m2 15 6 6",key:"10dquu"}],["path",{d:"m7 20 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a1 1 0 0 0-2.75-2.91",key:"1x6kdw"}]],K=k("hand-heart",z),$=[{value:"child",label:"ลูก"},{value:"grandchild",label:"หลาน"},{value:"sibling",label:"พี่/น้อง"},{value:"spouse",label:"คู่สมรส"},{value:"nurse",label:"พยาบาล/ผู้ดูแลมืออาชีพ"},{value:"other",label:"อื่นๆ"}];function le(){const[,b]=B(),{profile:n}=E(),{isGroup:m,groupId:u}=P(),{setUser:y,setContext:I,setIsRegistered:F}=X(),[N,g]=h.useState(!1),[s,v]=h.useState({}),L=()=>{const i=(n?.displayName||"").split(" "),r=i[0]||"",l=i.length>=2?i.slice(1).join(" "):"";return{caregiverFirstName:r,caregiverLastName:l,caregiverPhoneNumber:"",relationship:"",patientFirstName:"",patientLastName:"",patientBirthDate:"",patientConditions:""}},[a,w]=h.useState(L),c=(t,i)=>{w(r=>({...r,[t]:i})),s[t]&&v(r=>{const l={...r};return delete l[t],l})},C=()=>{const t={};if(a.caregiverFirstName.trim()||(t.caregiverFirstName="กรุณากรอกชื่อ"),a.caregiverLastName.trim()||(t.caregiverLastName="กรุณากรอกนามสกุล"),a.relationship||(t.relationship="กรุณาเลือกความสัมพันธ์"),a.patientFirstName.trim()||(t.patientFirstName="กรุณากรอกชื่อสมาชิก"),a.patientLastName.trim()||(t.patientLastName="กรุณากรอกนามสกุลสมาชิก"),!a.patientBirthDate)t.patientBirthDate="กรุณาเลือกวันเกิด";else{const i=new Date(a.patientBirthDate),l=new Date().getFullYear()-i.getFullYear();(l<18||l>120)&&(t.patientBirthDate="วันเกิดไม่ถูกต้อง (อายุ 18-120 ปี)")}return v(t),Object.keys(t).length===0},D=async t=>{if(t.preventDefault(),!!C()){if(!n?.userId){alert("ไม่สามารถระบุตัวตนได้ กรุณาลองใหม่อีกครั้ง");return}g(!0);try{const i={lineUserId:n.userId,displayName:n.displayName||"",pictureUrl:n.pictureUrl||null,statusMessage:n.statusMessage,contextType:m?"group":"utou",groupId:m&&u?u:null,caregiver:{firstName:a.caregiverFirstName.trim(),lastName:a.caregiverLastName.trim(),phoneNumber:a.caregiverPhoneNumber.trim()||null,relationship:a.relationship},patient:{firstName:a.patientFirstName.trim(),lastName:a.patientLastName.trim(),birthDate:a.patientBirthDate,medicalCondition:a.patientConditions.trim()||null}},r=await T.quickRegister(i);if(r.success){y({role:"caregiver",profileId:r.caregiverId,lineUserId:n.userId}),I({caregiverId:r.caregiverId,patientId:r.patientId,groupId:r.groupId||null}),F(!0);const l={caregiverId:r.caregiverId,patientId:r.patientId,role:"caregiver",profile_id:r.patientId,groupId:r.groupId,contextType:m?"group":"utou"};localStorage.setItem("oonjai_context",JSON.stringify(l));const S={role:"caregiver",profile_id:r.caregiverId,line_user_id:n.userId};localStorage.setItem("oonjai_user",JSON.stringify(S)),b(`/registration/success?caregiver_id=${r.caregiverId}`)}}catch(i){console.error("Registration failed:",i),alert(i instanceof Error?i.message:"เกิดข้อผิดพลาดในการลงทะเบียน กรุณาลองใหม่อีกครั้ง")}finally{g(!1)}}};return e.jsx("div",{className:"min-h-screen bg-background pb-8",children:e.jsxs("div",{className:"max-w-md mx-auto px-4 py-6",children:[e.jsxs(x,{className:"bg-gradient-to-br from-primary to-primary/80 text-white border-none shadow-lg overflow-hidden relative mb-6",children:[e.jsx("div",{className:"absolute -right-12 -top-12 w-40 h-40 bg-white/10 rounded-full"}),e.jsx("div",{className:"absolute -left-8 -bottom-8 w-32 h-32 bg-white/5 rounded-full"}),e.jsxs(p,{className:"pt-8 pb-8 text-center relative z-10",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold mb-1",children:"ยินดีต้อนรับสู่ OONJAI"}),e.jsx("p",{className:"text-white/90",children:"กรุณากรอกข้อมูลเพื่อเริ่มใช้งาน"})]})]}),e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs(x,{className:"border shadow-sm overflow-hidden",children:[e.jsx(j,{className:"bg-muted border-b p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/15 flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-foreground",children:"ข้อมูลของคุณ (ผู้ดูแล)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"เชื่อมโยงกับบัญชี LINE โดยอัตโนมัติ"})]})]})}),e.jsxs(p,{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"caregiverFirstName",children:["ชื่อ ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(o,{id:"caregiverFirstName",value:a.caregiverFirstName,onChange:t=>c("caregiverFirstName",t.target.value),placeholder:"กรอกชื่อของคุณ",className:s.caregiverFirstName?"border-destructive":""}),s.caregiverFirstName&&e.jsx("p",{className:"text-xs text-destructive",children:s.caregiverFirstName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"caregiverLastName",children:["นามสกุล ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(o,{id:"caregiverLastName",value:a.caregiverLastName,onChange:t=>c("caregiverLastName",t.target.value),placeholder:"กรอกนามสกุลของคุณ",className:s.caregiverLastName?"border-destructive":""}),s.caregiverLastName&&e.jsx("p",{className:"text-xs text-destructive",children:s.caregiverLastName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"caregiverPhoneNumber",children:"เบอร์โทรศัพท์"}),e.jsx(o,{id:"caregiverPhoneNumber",type:"tel",value:a.caregiverPhoneNumber,onChange:t=>c("caregiverPhoneNumber",t.target.value),placeholder:"0XX-XXX-XXXX"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"relationship",children:["ความสัมพันธ์กับสมาชิก ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(J,{value:a.relationship,onValueChange:t=>c("relationship",t),children:[e.jsx(q,{className:s.relationship?"border-destructive":"",children:e.jsx(M,{placeholder:"-- เลือกความสัมพันธ์ --"})}),e.jsx(G,{children:$.map(t=>e.jsx(Q,{value:t.value,children:t.label},t.value))})]}),s.relationship&&e.jsx("p",{className:"text-xs text-destructive",children:s.relationship})]})]})]}),e.jsxs(x,{className:"border shadow-sm overflow-hidden",children:[e.jsx(j,{className:"bg-muted border-b p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent/15 flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-accent"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-foreground",children:"ข้อมูลสมาชิกที่ดูแล"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ไม่จำเป็นต้องมีบัญชี LINE"})]})]})}),e.jsxs(p,{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"patientFirstName",children:["ชื่อสมาชิก ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(o,{id:"patientFirstName",value:a.patientFirstName,onChange:t=>c("patientFirstName",t.target.value),placeholder:"กรอกชื่อสมาชิก",className:s.patientFirstName?"border-destructive":""}),s.patientFirstName&&e.jsx("p",{className:"text-xs text-destructive",children:s.patientFirstName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"patientLastName",children:["นามสกุลสมาชิก ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(o,{id:"patientLastName",value:a.patientLastName,onChange:t=>c("patientLastName",t.target.value),placeholder:"กรอกนามสกุลสมาชิก",className:s.patientLastName?"border-destructive":""}),s.patientLastName&&e.jsx("p",{className:"text-xs text-destructive",children:s.patientLastName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"patientBirthDate",children:["วันเกิดสมาชิก ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(o,{id:"patientBirthDate",type:"date",value:a.patientBirthDate,onChange:t=>c("patientBirthDate",t.target.value),className:s.patientBirthDate?"border-destructive":""}),e.jsxs("div",{className:"flex items-start gap-1.5 text-xs text-muted-foreground",children:[e.jsx(f,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"กรุณากรอกเป็น ค.ศ. (เช่น เกิดปี พ.ศ. 2496 = ค.ศ. 1953)"})]}),s.patientBirthDate&&e.jsx("p",{className:"text-xs text-destructive",children:s.patientBirthDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"patientConditions",children:"โรคประจำตัว (ถ้ามี)"}),e.jsx(U,{id:"patientConditions",value:a.patientConditions,onChange:t=>c("patientConditions",t.target.value),placeholder:"เช่น ความดันสูง, เบาหวาน",rows:3}),e.jsxs("div",{className:"flex items-start gap-1.5 text-xs text-muted-foreground",children:[e.jsx(f,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"กรอกโรคประจำตัวสำคัญ สามารถเพิ่มรายละเอียดเพิ่มเติมได้ภายหลัง"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-primary/8 border border-primary/20 rounded-xl mt-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/15 flex items-center justify-center flex-shrink-0",children:e.jsx(V,{className:"w-4 h-4 text-primary"})}),e.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:"คุณสามารถเพิ่มรายละเอียดอื่นๆ เช่น ข้อมูลสุขภาพ ยาที่ทาน และอื่นๆ ได้ภายหลังที่เมนูข้อมูลสมาชิก"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{type:"submit",className:"w-full gap-2 h-12 text-base",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-5 h-5 animate-spin"}),"กำลังบันทึก..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-5 h-5"}),"บันทึกและเริ่มใช้งาน"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Y,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"ข้อมูลของท่านจะถูกเก็บเป็นความลับและปลอดภัย"})]})]})]})]})})}export{le as default};
