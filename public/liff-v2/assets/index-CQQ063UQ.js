import{r,j as e}from"./vendor-query-OvJu5Khy.js";import{c as Le,G as Pe,W as Ee,a1 as Fe,m as Me,aw as Ie,ax as Te,ay as He,az as ze,aA as Re,aB as Oe,aC as Ae,aD as Ge,aE as Be,aF as We,q as Ve,p as I,n as me,P as T,ai as H,M as xe,ah as w,o as Ke,g as i,aG as qe,r as ee,h as Je,a as p,ac as j,L as te,a7 as Qe,a4 as Xe,C as se,e as Ye,f as Ue,ar as Ze,t as ae,v as re,w as le,x as oe,y as ne,X as ie,b as $e,B as et,aH as tt,aI as st,aJ as at,aK as rt,aL as lt,aM as ot,aN as nt,aO as it,aP as dt,aQ as ct}from"./index-tEBa2Yi-.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-CYcp45lG.js";const mt=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],xt=Le("ellipsis",mt),de={vitals:{icon:w,color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-950/30"},health:{icon:w,color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-950/30"},sleep:{icon:xe,color:"text-indigo-500",bg:"bg-indigo-50 dark:bg-indigo-950/30"},symptoms:{icon:H,color:"text-red-500",bg:"bg-red-50 dark:bg-red-950/30"},medications:{icon:T,color:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-950/30"},meds:{icon:T,color:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-950/30"},water:{icon:I,color:"text-sky-500",bg:"bg-sky-50 dark:bg-sky-950/30"},exercise:{icon:me,color:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-950/30"},glucose:{icon:I,color:"text-pink-500",bg:"bg-pink-50 dark:bg-pink-950/30"},lab_results:{icon:Ve,color:"text-teal-500",bg:"bg-teal-50 dark:bg-teal-950/30"}},ce=[{id:7,label:"7 วัน",shortLabel:"7 วัน"},{id:14,label:"14 วัน",shortLabel:"14 วัน"},{id:30,label:"30 วัน",shortLabel:"30 วัน"},{id:90,label:"3 เดือน",shortLabel:"3 เดือน"},{id:-1,label:"กำหนดเอง",shortLabel:"กำหนดเอง"}];function gt(){const[,ue]=Pe(),[d,y]=r.useState("all"),[x,z]=r.useState(7),[N,v]=r.useState(!1),[be,k]=r.useState(!1),[u,R]=r.useState(""),[b,O]=r.useState(""),[n,C]=r.useState(null),[pe,D]=r.useState(!1),[A,S]=r.useState(null),{toast:G}=Ee(),B=Fe(),{patientId:g,isLoading:W}=B,{data:h}=Me(g),he={symptoms:"symptoms_enabled",health:"vitals_enabled",glucose:"glucose_enabled",meds:"medications_enabled",water:"water_enabled",sleep:"sleep_enabled",lab_results:"lab_results_enabled"},ge=[{id:"symptoms",label:"อาการ"},{id:"health",label:"ความดัน"},{id:"glucose",label:"ระดับน้ำตาล"},{id:"meds",label:"ยา"},{id:"water",label:"น้ำ"},{id:"sleep",label:"การนอน"},{id:"lab_results",label:"ผลแล็บ"}],fe=r.useMemo(()=>ge.filter(t=>!h||h[he[t.id]]!==!1),[h]),_=Ie(),V=Te(),K=He(),q=ze(),J=Re(),L=Oe(),Q=Ae(),X=Ge(),Y=Be(),ye=t=>({health:_,vitals:_,symptoms:V,exercise:K,mood:q,medical_notes:J,meds:L,medications:L,sleep:Q,water:X,lab_results:Y})[t],U=_.isPending||V.isPending||K.isPending||q.isPending||J.isPending||L.isPending||Q.isPending||X.isPending||Y.isPending,je=x===-1&&u&&b?{startDate:u,endDate:b}:void 0,{data:Z,isLoading:we,refetch:P}=We(g,x===-1?30:x,je),Ne=async t=>{if(!g)return;const a=f.find(M=>M.id===t.id);if(!a)return;const s=a.rawId;if(!s)return;const m=ye(t.type);if(m)try{await m.mutateAsync({id:s,patientId:g}),G({description:"ลบข้อมูลเรียบร้อยแล้ว"}),S(null),P()}catch(M){console.error("Error deleting history item:",M),G({description:"เกิดข้อผิดพลาดในการลบข้อมูล",variant:"destructive"})}},[ve,ke]=r.useState(!1);!W&&!g&&!ve&&(ke(!0),B.ensurePatient());const Ce=[{id:1,type:"symptoms",title:"อาการ",detail:"ปวดหัว (ระดับ 3)",time:"10:30 น.",date:"วันนี้",icon:H,color:"text-red-500",bg:"bg-red-50 dark:bg-red-950/30"},{id:2,type:"health",title:"ความดัน",detail:"128/82 mmHg",time:"08:15 น.",date:"วันนี้",icon:w,color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-950/30"},{id:3,type:"meds",title:"ยาเช้า",detail:"ทานครบตามรายการ",time:"08:00 น.",date:"วันนี้",icon:T,color:"text-orange-500",bg:"bg-orange-50 dark:bg-orange-950/30"},{id:4,type:"sleep",title:"การนอน",detail:"6.5 ชม. (หลับดี)",time:"07:00 น.",date:"วันนี้",icon:xe,color:"text-indigo-500",bg:"bg-indigo-50 dark:bg-indigo-950/30"},{id:5,type:"water",title:"น้ำ",detail:"8 แก้ว",time:"18:00 น.",date:"เมื่อวาน",icon:I,color:"text-sky-500",bg:"bg-sky-50 dark:bg-sky-950/30"},{id:6,type:"exercise",title:"ออกกำลังกาย",detail:"เดินเร็ว 20 นาที",time:"17:45 น.",date:"เมื่อวาน",icon:me,color:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-950/30"},{id:7,type:"mood",title:"อารมณ์",detail:"สดชื่น แจ่มใส",time:"09:00 น.",date:"เมื่อวาน",icon:Ke,color:"text-yellow-500",bg:"bg-yellow-50 dark:bg-yellow-950/30"},{id:8,type:"other",title:"บันทึกทั่วไป",detail:"นัดหมอฟันเลื่อนเป็นอาทิตย์หน้า",time:"14:20 น.",date:"15 ม.ค.",icon:xt,color:"text-gray-500",bg:"bg-gray-50 dark:bg-gray-950/30"},{id:9,type:"health",title:"ความดัน",detail:"135/88 mmHg (สูงนิดหน่อย)",time:"18:30 น.",date:"15 ม.ค.",icon:w,color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-950/30"},{id:10,type:"symptoms",title:"อาการ",detail:"เวียนหัว บ้านหมุน",time:"15:00 น.",date:"14 ม.ค.",icon:H,color:"text-red-500",bg:"bg-red-50 dark:bg-red-950/30"}],f=(Z||[]).map((t,a)=>{const s=de[t.type]||de.health,m={vitals:"health",medications:"meds"};return{id:a+1,rawId:t.id,type:m[t.type]||t.type,title:t.title,detail:t.detail,time:t.time,date:t.date,icon:s.icon,color:s.color,bg:s.bg}}),De=r.useMemo(()=>{if(!h)return f;const t={health:"vitals_enabled",vitals:"vitals_enabled",glucose:"glucose_enabled",meds:"medications_enabled",medications:"medications_enabled",sleep:"sleep_enabled",water:"water_enabled",exercise:"exercise_enabled",symptoms:"symptoms_enabled",mood:"mood_enabled",medical_notes:"notes_enabled",lab_results:"lab_results_enabled"};return f.filter(a=>{const s=t[a.type];return!s||h[s]!==!1})},[f,h]),c=d==="example",E=W||we,$=c?Ce:De,F=d==="all"||d==="example"?$:$.filter(t=>t.type===d),o=()=>{D(!0),setTimeout(()=>{D(!1),C(null),P()},1500)},l=()=>{C(null),D(!1),P()},Se=()=>{if(!n)return null;switch({health:"vitals",meds:"medications"}[n.type]||n.type){case"vitals":return e.jsx(ct,{onSuccess:o,onCancel:l});case"glucose":return e.jsx(dt,{onSuccess:o,onCancel:l});case"water":return e.jsx(it,{onSuccess:o,onCancel:l});case"medications":return e.jsx(nt,{onSuccess:o,onCancel:l});case"symptoms":return e.jsx(ot,{onSuccess:o,onCancel:l});case"sleep":return e.jsx(lt,{onSuccess:o,onCancel:l});case"exercise":return e.jsx(rt,{onSuccess:o,onCancel:l});case"mood":return e.jsx(at,{onSuccess:o,onCancel:l});case"medical_notes":return e.jsx(st,{onSuccess:o,onCancel:l});case"lab_results":{const s=n?f.find(m=>m.id===n.id):null;return e.jsx(tt,{onSuccess:o,onCancel:l,initialEditData:s?.rawId?(Z||[]).find(m=>m.id===s.rawId)?.raw:void 0},s?.rawId)}default:return e.jsx("div",{className:"p-4 bg-muted/20 rounded-2xl text-center text-muted-foreground text-sm",children:"แบบฟอร์มสำหรับประเภทนี้ยังไม่พร้อมใช้งาน"})}},_e=()=>n?{health:"ความดัน/ชีพจร",vitals:"ความดัน/ชีพจร",glucose:"ระดับน้ำตาล",meds:"ยา",medications:"ยา",sleep:"การนอน",water:"การดื่มน้ำ",exercise:"ออกกำลังกาย",symptoms:"อาการ",mood:"อารมณ์",medical_notes:"โน้ต/บันทึกแพทย์",lab_results:"ผลตรวจเลือด"}[n.type]||n.title:"";return e.jsxs("div",{className:"min-h-screen bg-background pb-32 font-sans relative z-10",children:[e.jsxs("header",{className:"bg-card pt-4 pb-1 px-6 sticky top-0 z-20 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"rounded-full -ml-2",onClick:()=>ue("/records"),children:e.jsx(qe,{className:"w-6 h-6 text-foreground"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"ประวัติการบันทึก"})]}),e.jsxs(i,{variant:"outline",size:"sm",className:"rounded-full gap-1.5 px-3 h-9",onClick:()=>v(!N),children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:x===-1?"กำหนดเอง":ce.find(t=>t.id===x)?.shortLabel}),e.jsx(Je,{className:p("w-3 h-3 transition-transform",N&&"rotate-180")})]})]}),N&&e.jsx("div",{className:"mt-3 flex gap-2 flex-wrap animate-in slide-in-from-top-2 duration-200",children:ce.map(t=>e.jsx("button",{onClick:()=>{t.id===-1?(k(!0),v(!1)):(z(t.id),v(!1))},className:p("flex-1 min-w-[70px] py-2 px-3 rounded-xl text-xs font-bold transition-all border",x===t.id?"bg-primary text-primary-foreground border-primary shadow-md shadow-primary/20":"bg-card text-muted-foreground border-border hover:border-primary/50"),children:t.label},t.id))}),x===-1&&u&&b&&e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground text-center",children:[new Date(u).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"2-digit"})," - ",new Date(b).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"2-digit"})]})]}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:[e.jsx("button",{onClick:()=>y("all"),className:p("px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border",d==="all"?"bg-foreground text-background border-foreground":"bg-card text-muted-foreground border-border"),children:"ทั้งหมด"}),fe.map(t=>e.jsx("button",{onClick:()=>y(t.id),className:p("px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border",d===t.id?"bg-primary text-primary-foreground border-primary shadow-md shadow-primary/20":"bg-card text-muted-foreground border-border"),children:t.label},t.id)),e.jsxs("button",{onClick:()=>y("example"),className:p("px-4 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border flex items-center gap-1",d==="example"?"bg-amber-500 text-white border-amber-500 shadow-md shadow-amber-500/20":"bg-card text-muted-foreground border-border"),children:[e.jsx(j,{className:"w-3 h-3"}),"ตัวอย่าง"]})]}),E&&!c&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-3",children:[e.jsx(te,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"กำลังโหลด..."})]}),(!E||c)&&e.jsx("div",{className:"space-y-2",children:F.map(t=>e.jsxs("div",{className:"flex items-center justify-between bg-muted/50 rounded-xl p-3 cursor-pointer active:scale-[0.99] transition-transform group",onClick:()=>!c&&A!==t.id&&C(t),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:p("w-10 h-10 rounded-xl flex items-center justify-center shrink-0",t.bg),children:e.jsx(t.icon,{className:p("w-5 h-5",t.color)})}),e.jsxs("div",{className:"space-y-1 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"w-3 h-3 text-muted-foreground shrink-0"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.time}),e.jsx("span",{className:"text-[10px] font-medium text-muted-foreground bg-muted/50 px-2 py-0.5 rounded-full whitespace-nowrap",children:t.date})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:t.title}),e.jsx("span",{className:"text-sm font-bold text-foreground truncate",children:t.detail})]})]})]}),!c&&(A===t.id?e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(i,{variant:"destructive",size:"sm",className:"h-7 px-2 text-xs",onClick:a=>{a.stopPropagation(),Ne(t)},disabled:U,children:U?e.jsx(te,{className:"w-3 h-3 animate-spin"}):"ลบ"}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:a=>{a.stopPropagation(),S(null)},children:"ยกเลิก"})]}):e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(i,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-muted-foreground hover:text-destructive opacity-40 group-hover:opacity-100 transition-opacity",onClick:a=>{a.stopPropagation(),S(t.id)},children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx(se,{className:"w-4 h-4 text-muted-foreground/50 group-hover:text-muted-foreground group-hover:translate-x-0.5 transition-all"})]})),c&&e.jsx(se,{className:"w-4 h-4 text-muted-foreground/50 shrink-0"})]},t.id))}),F.length===0&&!E&&e.jsx(Ye,{className:"border-none shadow-sm",children:e.jsx(Ue,{className:"py-12 flex flex-col items-center text-center space-y-4",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 dark:bg-amber-950/30 rounded-full flex items-center justify-center",children:e.jsx(j,{className:"w-8 h-8 text-amber-500"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-bold text-foreground",children:"ข้อมูลตัวอย่าง"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-[250px]",children:"นี่คือตัวอย่างข้อมูลที่จะแสดงเมื่อมีการบันทึกจริง"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center",children:e.jsx(Ze,{className:"w-8 h-8 text-muted-foreground"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-bold text-foreground",children:"ยังไม่มีข้อมูล"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-[250px]",children:d==="all"?"เริ่มบันทึกสุขภาพประจำวันโดยพิมพ์คุยกับน้องอุ่นใน LINE Chat":"ยังไม่มีประวัติการบันทึกในหมวดนี้"})]}),e.jsxs(i,{variant:"outline",className:"mt-2",onClick:()=>y("example"),children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"ดูตัวอย่างข้อมูล"]})]})})}),c&&F.length>0&&e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 rounded-xl p-3 flex items-center gap-3",children:[e.jsx(j,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 shrink-0"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"นี่คือข้อมูลตัวอย่าง ไม่ใช่ข้อมูลจริงจากการบันทึกของคุณ"})]})]}),e.jsx(ae,{open:n!==null,onOpenChange:t=>!t&&l(),children:e.jsxs(re,{className:"max-h-[90vh]",children:[e.jsxs(le,{className:"flex items-center justify-between px-6",children:[e.jsx(oe,{className:"text-xl font-bold",children:_e()}),e.jsx(ne,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:e.jsx(ie,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"px-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:pe?e.jsxs("div",{className:"py-12 flex flex-col items-center text-center space-y-6 animate-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-100 dark:bg-emerald-950/30 text-emerald-600 rounded-full flex items-center justify-center",children:e.jsx($e,{className:"w-10 h-10 stroke-[3px]"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"อัปเดตเรียบร้อย!"}),e.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed px-8",children:"ข้อมูลของคุณถูกอัปเดตแล้ว"})]})]}):Se()})]})}),e.jsx(ae,{open:be,onOpenChange:k,children:e.jsxs(re,{className:"max-h-[85vh]",children:[e.jsxs(le,{className:"flex items-center justify-between px-6",children:[e.jsx(oe,{className:"text-xl font-bold",children:"กำหนดช่วงวันที่"}),e.jsx(ne,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"rounded-full h-10 w-10",children:e.jsx(ie,{className:"w-5 h-5"})})})]}),e.jsxs("div",{className:"px-6 pb-8 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"วันเริ่มต้น"}),e.jsx("input",{type:"date",value:u,onChange:t=>R(t.target.value),max:b||new Date().toISOString().split("T")[0],className:"w-full h-12 px-4 rounded-xl border border-border bg-card text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"วันสิ้นสุด"}),e.jsx("input",{type:"date",value:b,onChange:t=>O(t.target.value),min:u,max:new Date().toISOString().split("T")[0],className:"w-full h-12 px-4 rounded-xl border border-border bg-card text-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"เลือกด่วน"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"สัปดาห์นี้",days:7},{label:"เดือนนี้",days:30},{label:"3 เดือน",days:90},{label:"6 เดือน",days:180}].map(t=>e.jsx("button",{onClick:()=>{const a=new Date,s=new Date;s.setDate(s.getDate()-t.days),R(s.toISOString().split("T")[0]),O(a.toISOString().split("T")[0])},className:"px-4 py-2 rounded-xl text-xs font-medium bg-muted hover:bg-muted/80 transition-colors",children:t.label},t.days))})]}),e.jsxs(i,{className:"w-full h-14 rounded-2xl font-bold text-lg",disabled:!u||!b,onClick:()=>{z(-1),k(!1)},children:[e.jsx(ee,{className:"w-5 h-5 mr-2"}),"ใช้ช่วงวันที่นี้"]})]})]})}),e.jsx(et,{})]})}export{gt as default};
