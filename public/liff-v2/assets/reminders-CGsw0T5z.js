import{r as u,j as e}from"./vendor-query-CmnYLxAr.js";import{c as z,a as w,m as G,u as K,w as Q,P as J,G as ee,H as te,g as p,z as se,L as I,e as ae,f as ie,N as ne,x as T,Q as ce,R as re,V as le,W as oe,Y as de,X as ue,p as C,I as A,r as me,Z as fe,K as he}from"./index-Bo0YsN1t.js";import{e as B,u as pe,a as xe,d as L,f as ve,g as ye,h as be}from"./vendor-ui-Q3AHpcc6.js";import{k as je,l as ge,m as we,n as _e}from"./use-profile-BDU80U8B.js";import{P as Ne}from"./pen-xuwl7nFx.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-pdf-IriBjpIe.js";import"./vendor-charts-Cp29jYec.js";const ke=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]],Ce=z("footprints",ke);const Se=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],Pe=z("utensils",Se);var P="Switch",[Re]=xe(P),[Ee,qe]=Re(P),O=u.forwardRef((o,m)=>{const{__scopeSwitch:a,name:n,checked:f,defaultChecked:b,required:h,disabled:d,value:x="on",onCheckedChange:_,form:r,...v}=o,[y,s]=u.useState(null),l=B(m,g=>s(g)),N=u.useRef(!1),S=y?r||!!y.closest("form"):!0,[j,R]=pe({prop:f,defaultProp:b??!1,onChange:_,caller:P});return e.jsxs(Ee,{scope:a,checked:j,disabled:d,children:[e.jsx(L.button,{type:"button",role:"switch","aria-checked":j,"aria-required":h,"data-state":V(j),"data-disabled":d?"":void 0,disabled:d,value:x,...v,ref:l,onClick:ve(o.onClick,g=>{R(E=>!E),S&&(N.current=g.isPropagationStopped(),N.current||g.stopPropagation())})}),S&&e.jsx(U,{control:y,bubbles:!N.current,name:n,value:x,checked:j,required:h,disabled:d,form:r,style:{transform:"translateX(-100%)"}})]})});O.displayName=P;var F="SwitchThumb",H=u.forwardRef((o,m)=>{const{__scopeSwitch:a,...n}=o,f=qe(F,a);return e.jsx(L.span,{"data-state":V(f.checked),"data-disabled":f.disabled?"":void 0,...n,ref:m})});H.displayName=F;var De="SwitchBubbleInput",U=u.forwardRef(({__scopeSwitch:o,control:m,checked:a,bubbles:n=!0,...f},b)=>{const h=u.useRef(null),d=B(h,b),x=ye(a),_=be(m);return u.useEffect(()=>{const r=h.current;if(!r)return;const v=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(v,"checked").set;if(x!==a&&s){const l=new Event("click",{bubbles:n});s.call(r,a),r.dispatchEvent(l)}},[x,a,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...f,tabIndex:-1,ref:d,style:{...f.style,..._,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});U.displayName=De;function V(o){return o?"checked":"unchecked"}var Z=O,Ie=H;const Y=u.forwardRef(({className:o,...m},a)=>e.jsx(Z,{className:w("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",o),...m,ref:a,children:e.jsx(Ie,{className:w("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Y.displayName=Z.displayName;const q=[{value:"medication",label:"กินยา",icon:J,color:"bg-purple-500/10 text-purple-500"},{value:"water",label:"ดื่มน้ำ",icon:ee,color:"bg-blue-500/10 text-blue-500"},{value:"vitals",label:"วัดความดัน",icon:te,color:"bg-red-500/10 text-red-500"},{value:"food",label:"ทานอาหาร",icon:Pe,color:"bg-orange-500/10 text-orange-500"},{value:"exercise",label:"ออกกำลังกาย",icon:Ce,color:"bg-green-500/10 text-green-500"}],D=[{value:"monday",label:"จ"},{value:"tuesday",label:"อ"},{value:"wednesday",label:"พ"},{value:"thursday",label:"พฤ"},{value:"friday",label:"ศ"},{value:"saturday",label:"ส"},{value:"sunday",label:"อา"}],M={type:"medication",title:"",time:"08:00",note:"",frequency:"daily",days_of_week:[],is_active:!0};function He(){const[,o]=G(),{context:m}=K(),a=m.patientId,{toast:n}=Q(),{data:f,isLoading:b}=je(a),h=ge(),d=we(),x=_e(),[_,r]=u.useState(!1),[v,y]=u.useState(null),[s,l]=u.useState(M),N=q.map(t=>({...t,reminders:(f||[]).filter(c=>c.type===t.value)})),S=t=>{y(null),l({...M,type:t}),r(!0)},j=t=>{y(t.id),l({type:t.type,title:t.title,time:t.custom_time||t.time||"08:00",note:t.note||"",frequency:t.frequency==="specific_days"?"specific_days":"daily",days_of_week:t.days_of_week||[],is_active:t.is_active}),r(!0)},R=async t=>{if(a&&confirm("ต้องการลบการเตือนนี้หรือไม่?"))try{await x.mutateAsync({id:t,patientId:a}),n({title:"ลบการเตือนเรียบร้อยแล้ว"})}catch{n({title:"ไม่สามารถลบการเตือนได้",variant:"destructive"})}},g=async t=>{if(a)try{await d.mutateAsync({id:t.id,data:{is_active:!t.is_active,patient_id:a}})}catch{n({title:"ไม่สามารถเปลี่ยนสถานะได้",variant:"destructive"})}},E=async()=>{if(a){if(!s.title.trim()){n({title:"กรุณาระบุชื่อเตือน",variant:"destructive"});return}if(!s.time){n({title:"กรุณาระบุเวลาเตือน",variant:"destructive"});return}if(s.frequency==="specific_days"&&s.days_of_week.length===0){n({title:"กรุณาเลือกวันที่ต้องการเตือน",variant:"destructive"});return}try{v?(await d.mutateAsync({id:v,data:{...s,custom_time:s.time,days_of_week:s.frequency==="specific_days"?s.days_of_week:void 0,patient_id:a}}),n({title:"แก้ไขการเตือนเรียบร้อยแล้ว"})):(await h.mutateAsync({...s,custom_time:s.time,days_of_week:s.frequency==="specific_days"?s.days_of_week:void 0,patient_id:a}),n({title:"เพิ่มการเตือนเรียบร้อยแล้ว"})),r(!1)}catch{n({title:"ไม่สามารถบันทึกการเตือนได้",variant:"destructive"})}}},$=t=>{l(c=>({...c,days_of_week:c.days_of_week.includes(t)?c.days_of_week.filter(i=>i!==t):[...c.days_of_week,t]}))},W=t=>q.find(c=>c.value===t)||q[0];return e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-12 pb-4 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>o("/settings"),children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"ตั้งเวลาเตือน"})]}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-6",children:[b&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-primary"})}),!b&&N.map(t=>{const c=t.icon;return e.jsx(ae,{className:"border-none shadow-sm bg-card overflow-hidden",children:e.jsxs(ie,{className:"p-0",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:w("p-2 rounded-xl",t.color),children:e.jsx(c,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-bold text-foreground",children:t.label})]}),e.jsxs(p,{variant:"default",size:"sm",className:"gap-1",onClick:()=>S(t.value),children:[e.jsx(ne,{className:"w-4 h-4"}),"เพิ่มเตือน"]})]}),e.jsx("div",{className:"p-4",children:t.reminders.length===0?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(T,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"ยังไม่มีการเตือน"})]}):e.jsx("div",{className:"space-y-3",children:t.reminders.map(i=>e.jsxs("div",{className:w("p-3 bg-muted/50 rounded-xl border-l-4 transition-opacity",i.is_active?"border-primary":"border-muted-foreground opacity-50"),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground text-sm",children:i.title}),e.jsx("p",{className:"text-xl font-bold text-primary mt-1",children:i.custom_time||i.time}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i.frequency==="daily"?"ทุกวัน":i.days_of_week?.map(k=>D.find(X=>X.value===k)?.label).join(", ")||"ตามกำหนด"}),i.note&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i.note})]}),e.jsx(Y,{checked:i.is_active,onCheckedChange:()=>g(i)})]}),i.frequency==="specific_days"&&i.days_of_week&&e.jsx("div",{className:"flex gap-1 mt-2",children:D.map(k=>e.jsx("span",{className:w("w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-bold",i.days_of_week?.includes(k.value)?"bg-primary text-white":"bg-muted text-muted-foreground"),children:k.label},k.value))}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs(p,{variant:"outline",size:"sm",className:"flex-1 gap-1 h-8",onClick:()=>j(i),children:[e.jsx(Ne,{className:"w-3 h-3"}),"แก้ไข"]}),e.jsxs(p,{variant:"destructive",size:"sm",className:"flex-1 gap-1 h-8",onClick:()=>R(i.id),children:[e.jsx(ce,{className:"w-3 h-3"}),"ลบ"]})]})]},i.id))})})]})},t.value)})]}),e.jsx(re,{open:_,onOpenChange:r,children:e.jsxs(le,{className:"max-h-[90vh]",children:[e.jsx(oe,{className:"border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-primary"}),v?"แก้ไขการเตือน":`เพิ่มเตือน${W(s.type).label}`]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>r(!1),children:e.jsx(ue,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"reminder_title",children:"ชื่อเตือน *"}),e.jsx(A,{id:"reminder_title",value:s.title,onChange:t=>l(c=>({...c,title:t.target.value})),placeholder:"เช่น กินยาความดัน"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"reminder_time",children:"เวลาเตือน *"}),e.jsx(A,{id:"reminder_time",type:"time",value:s.time,onChange:t=>l(c=>({...c,time:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"ความถี่"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"button",variant:s.frequency==="daily"?"default":"outline",className:"flex-1",onClick:()=>l(t=>({...t,frequency:"daily"})),children:"ทุกวัน"}),e.jsx(p,{type:"button",variant:s.frequency==="specific_days"?"default":"outline",className:"flex-1",onClick:()=>l(t=>({...t,frequency:"specific_days"})),children:"เลือกวัน"})]})]}),s.frequency==="specific_days"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"เลือกวันที่ต้องการเตือน"}),e.jsx("div",{className:"flex gap-2 justify-center",children:D.map(t=>e.jsx("button",{type:"button",onClick:()=>$(t.value),className:w("w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold transition-colors",s.days_of_week.includes(t.value)?"bg-primary text-white":"bg-muted text-muted-foreground hover:bg-muted/80"),children:t.label},t.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"หมายเหตุ (ถ้ามี)"}),e.jsx(me,{value:s.note,onChange:t=>l(c=>({...c,note:t.target.value})),placeholder:"เพิ่มรายละเอียดเพิ่มเติม",rows:2})]})]}),e.jsx(fe,{className:"border-t border-border",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",className:"flex-1",onClick:()=>r(!1),children:"ยกเลิก"}),e.jsxs(p,{className:"flex-1 gap-2",onClick:E,disabled:h.isPending||d.isPending,children:[(h.isPending||d.isPending)&&e.jsx(I,{className:"w-4 h-4 animate-spin"}),e.jsx(he,{className:"w-4 h-4"}),"บันทึก"]})]})})]})})]})}export{He as default};
