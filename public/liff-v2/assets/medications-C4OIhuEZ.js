import{r as h,j as e}from"./vendor-query-OvJu5Khy.js";import{c as Y,G as U,a2 as G,W as J,a3 as K,g as d,_ as M,L as w,e as Q,f as W,P as _,Y as I,a4 as X,a5 as $,a1 as Z,t as ee,v as se,w as ae,x as te,X as ne,J as o,K as le,a as L,k,O as re,a6 as ie,a0 as ce}from"./index-Dxj55EkB.js";import{S as j,a as g,b as f,c as p,d as n}from"./select-DO2inAoj.js";import{g as de,h as oe,i as xe,j as me}from"./use-profile-Bg0pBo9K.js";import{P as ue}from"./pen-nhdO8aqj.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-CYcp45lG.js";const he=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]],je=Y("bell-off",he),ge=[{value:"morning",label:"เช้า (08:00)"},{value:"afternoon",label:"กลางวัน (12:00)"},{value:"evening",label:"เย็น (18:00)"},{value:"night",label:"ก่อนนอน (21:00)"}],fe={morning:"เช้า",afternoon:"กลางวัน",evening:"เย็น",night:"ก่อนนอน"},pe=[{value:"daily",label:"ทุกวัน"},{value:"specific_days",label:"เลือกวัน"},{value:"as_needed",label:"เมื่อจำเป็น"}],ve=[{value:"monday",label:"จันทร์"},{value:"tuesday",label:"อังคาร"},{value:"wednesday",label:"พุธ"},{value:"thursday",label:"พฤหัสบดี"},{value:"friday",label:"ศุกร์"},{value:"saturday",label:"เสาร์"},{value:"sunday",label:"อาทิตย์"}],D={name:"",dosage_amount:1,dosage_unit:"tablet",dosage_form:"tablet",frequency:"daily",days_of_week:[],times:[],instructions:"",note:"",reminder_enabled:!1};function Pe(){const[,C]=U(),x=G(),{toast:r}=J(),m=K(),i=m.patientId,[E,A]=h.useState(!1);!x.isLoading&&!m.isLoading&&!i&&!E&&(A(!0),m.ensurePatient()),console.log("[MedicationsPage] auth:",{isLoading:x.isLoading,isAuthenticated:x.isAuthenticated,isRegistered:x.isRegistered,patientId:m.patientId,role:x.role,error:m.error});const{data:c,isLoading:P}=de(i),v=oe(),b=xe(),O=me(),[T,u]=h.useState(!1),[N,S]=h.useState(null),[t,l]=h.useState(D),q=()=>{S(null),l(D),u(!0)},z=s=>{S(s.id),l({name:s.name,dosage_amount:s.dosage_amount||1,dosage_unit:s.dosage_unit||"tablet",dosage_form:s.dosage_form||"tablet",frequency:s.frequency||"daily",days_of_week:s.days_of_week||[],times:s.times||[],instructions:s.instructions||"",note:s.note||"",reminder_enabled:s.reminder_enabled!==!1}),u(!0)},F=async s=>{if(i&&confirm("ต้องการลบรายการยานี้หรือไม่?"))try{await O.mutateAsync({id:s,patientId:i}),r({title:"ลบรายการยาเรียบร้อยแล้ว"})}catch{r({title:"ไม่สามารถลบรายการยาได้",variant:"destructive"})}},V=async()=>{if(console.log("[MedicationsPage] handleSubmit called, patientId:",i),!i){r({title:"กรุณาคุยกับน้องอุ่นใน LINE Chat ก่อนนะคะ",variant:"destructive"});return}if(!t.name.trim()){r({title:"กรุณาระบุชื่อยา",variant:"destructive"});return}if(t.times.length===0&&t.frequency!=="as_needed"){r({title:"กรุณาเลือกเวลาทานยา",variant:"destructive"});return}try{console.log("[MedicationsPage] Submitting medication:",t),N?(await b.mutateAsync({id:N,data:{...t,patient_id:i}}),r({title:"แก้ไขรายการยาเรียบร้อยแล้ว"})):(await v.mutateAsync({...t,patient_id:i,active:!0}),r({title:"เพิ่มรายการยาเรียบร้อยแล้ว"})),u(!1)}catch(s){console.error("[MedicationsPage] Error saving medication:",s),r({title:"ไม่สามารถบันทึกรายการยาได้",variant:"destructive"})}},B=s=>{l(a=>({...a,times:a.times.includes(s)?a.times.filter(y=>y!==s):[...a.times,s]}))},R=s=>{l(a=>({...a,days_of_week:a.days_of_week.includes(s)?a.days_of_week.filter(y=>y!==s):[...a.days_of_week,s]}))},H=s=>{const a=s.dosage_amount||1;return a===.25?"1/4 เม็ด":a===.5?"1/2 เม็ด":a===.75?"3/4 เม็ด":`${a} เม็ด`};return x.isLoading||m.isLoading?e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-4 pb-1 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>C("/settings"),children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"รายการยา"})]}),e.jsx("main",{className:"max-w-md mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-3",children:[e.jsx(w,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"กำลังโหลด..."})]})})]}):e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-4 pb-1 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>C("/settings"),children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"รายการยา"})]}),e.jsx("main",{className:"max-w-md mx-auto px-4 py-6 space-y-4",children:e.jsx(Q,{className:"border-none shadow-sm",children:e.jsxs(W,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent/10 flex items-center justify-center text-accent",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-bold",children:"ยาของฉัน"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"จัดการรายการยาและเวลาเตือน"})]}),c&&c.length>0&&e.jsxs("span",{className:"text-xs font-bold text-muted-foreground bg-muted/50 px-2 py-1 rounded-lg",children:[c.length," รายการ"]})]}),P&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(w,{className:"w-6 h-6 animate-spin text-primary"})}),!P&&(!c||c.length===0)&&e.jsxs("div",{className:"flex flex-col items-center py-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 mb-3 bg-muted/50 rounded-full flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-muted-foreground"})}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"ยังไม่มีรายการยา"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-0.5",children:"กดปุ่มด้านล่างเพื่อเพิ่มยา"})]}),c&&c.length>0&&e.jsx("div",{className:"space-y-2",children:c.map(s=>e.jsxs("div",{className:"bg-muted/20 p-3 rounded-xl space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-bold text-foreground truncate",children:s.name}),s.reminder_enabled&&e.jsx(I,{className:"w-3 h-3 text-green-500 shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:H(s)}),s.times&&s.times.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-muted-foreground/30",children:"·"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.times.map(a=>fe[a]||a).join(", ")})]})]}),s.instructions&&e.jsxs("p",{className:"text-[11px] text-muted-foreground/70 mt-0.5",children:[e.jsx(X,{className:"w-3 h-3 inline mr-0.5 -mt-0.5"}),s.instructions]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0 ml-2",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-primary",onClick:()=>z(s),children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-red-500",onClick:()=>F(s.id),children:e.jsx($,{className:"w-4 h-4"})})]})]}),s.note&&e.jsx("div",{className:"text-[11px] text-muted-foreground bg-accent/5 border-l-2 border-accent/30 px-2 py-1 rounded",children:s.note})]},s.id))}),e.jsxs(d,{className:"w-full h-11 rounded-xl text-sm font-bold bg-accent/10 text-accent hover:bg-accent/20 border border-accent/20",onClick:q,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"})," เพิ่มยาของคุณ"]})]})})}),e.jsx(ee,{open:T,onOpenChange:u,children:e.jsxs(se,{className:"max-h-[90vh]",children:[e.jsx(ae,{className:"border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-primary"}),N?"แก้ไขรายการยา":"เพิ่มรายการยา"]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>u(!1),children:e.jsx(ne,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"med_name",children:"ชื่อยา *"}),e.jsx(le,{id:"med_name",value:t.name,onChange:s=>l(a=>({...a,name:s.target.value})),placeholder:"เช่น ยาลดความดัน"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"จำนวน"}),e.jsxs(j,{value:String(t.dosage_amount),onValueChange:s=>l(a=>({...a,dosage_amount:parseFloat(s)})),children:[e.jsx(g,{children:e.jsx(f,{})}),e.jsxs(p,{children:[e.jsx(n,{value:"0.25",children:"1/4 เม็ด"}),e.jsx(n,{value:"0.5",children:"1/2 เม็ด"}),e.jsx(n,{value:"0.75",children:"3/4 เม็ด"}),e.jsx(n,{value:"1",children:"1 เม็ด"}),e.jsx(n,{value:"1.5",children:"1.5 เม็ด"}),e.jsx(n,{value:"2",children:"2 เม็ด"}),e.jsx(n,{value:"3",children:"3 เม็ด"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"รูปแบบยา"}),e.jsxs(j,{value:t.dosage_form,onValueChange:s=>l(a=>({...a,dosage_form:s})),children:[e.jsx(g,{children:e.jsx(f,{})}),e.jsxs(p,{children:[e.jsx(n,{value:"tablet",children:"เม็ด"}),e.jsx(n,{value:"capsule",children:"แคปซูล"}),e.jsx(n,{value:"liquid",children:"น้ำ"}),e.jsx(n,{value:"injection",children:"ฉีด"}),e.jsx(n,{value:"topical",children:"ทา"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"ความถี่"}),e.jsxs(j,{value:t.frequency,onValueChange:s=>l(a=>({...a,frequency:s})),children:[e.jsx(g,{children:e.jsx(f,{})}),e.jsx(p,{children:pe.map(s=>e.jsx(n,{value:s.value,children:s.label},s.value))})]})]}),t.frequency==="specific_days"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"เลือกวัน"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ve.map(s=>e.jsxs("label",{className:L("flex items-center gap-2 p-2 border rounded-lg cursor-pointer transition-colors",t.days_of_week.includes(s.value)?"bg-primary/10 border-primary":"border-border"),children:[e.jsx(k,{checked:t.days_of_week.includes(s.value),onCheckedChange:()=>R(s.value)}),e.jsx("span",{className:"text-sm",children:s.label})]},s.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"เวลาทานยา *"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ge.map(s=>e.jsxs("label",{className:L("flex items-center gap-2 p-2 border rounded-lg cursor-pointer transition-colors",t.times.includes(s.value)?"bg-primary/10 border-primary":"border-border"),children:[e.jsx(k,{checked:t.times.includes(s.value),onCheckedChange:()=>B(s.value)}),e.jsx("span",{className:"text-sm",children:s.label})]},s.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"วิธีรับประทาน"}),e.jsxs(j,{value:t.instructions,onValueChange:s=>l(a=>({...a,instructions:s})),children:[e.jsx(g,{children:e.jsx(f,{placeholder:"เลือกวิธีรับประทาน"})}),e.jsxs(p,{children:[e.jsx(n,{value:"ก่อนอาหาร",children:"ก่อนอาหาร"}),e.jsx(n,{value:"หลังอาหาร",children:"หลังอาหาร"}),e.jsx(n,{value:"ระหว่างอาหาร",children:"ระหว่างอาหาร"}),e.jsx(n,{value:"ห่างอาหาร",children:"ห่างอาหาร"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"หมายเหตุ"}),e.jsx(re,{value:t.note,onChange:s=>l(a=>({...a,note:s.target.value})),placeholder:"เช่น ทานพร้อมน้ำมากๆ",rows:2})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-muted rounded-lg cursor-pointer",children:[e.jsx(k,{checked:t.reminder_enabled,onCheckedChange:s=>l(a=>({...a,reminder_enabled:s===!0}))}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:"เปิดการเตือน"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"รับการแจ้งเตือนเมื่อถึงเวลาทานยา"})]}),t.reminder_enabled?e.jsx(I,{className:"w-5 h-5 text-green-500"}):e.jsx(je,{className:"w-5 h-5 text-muted-foreground"})]})]}),e.jsx(ie,{className:"border-t border-border",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"outline",className:"flex-1",onClick:()=>u(!1),children:"ยกเลิก"}),e.jsxs(d,{className:"flex-1 gap-2",onClick:V,disabled:v.isPending||b.isPending,children:[(v.isPending||b.isPending)&&e.jsx(w,{className:"w-4 h-4 animate-spin"}),e.jsx(ce,{className:"w-4 h-4"}),"บันทึก"]})]})})]})})]})}export{Pe as default};
