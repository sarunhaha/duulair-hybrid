import{r as h,j as e}from"./vendor-query-OvJu5Khy.js";import{G,a0 as H,a1 as J,W as R,L as F,g as m,_ as W,a2 as I,e as p,f as g,J as r,K as t,O as E,X as D,a3 as S}from"./index-tEBa2Yi-.js";import{S as L,a as z,b as B,c as K,d as i}from"./select-DqW61qmP.js";import{u as q,e as M}from"./use-profile-4hQw1HTv.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-CYcp45lG.js";function le(){const[,A]=G(),T=H(),u=J(),j=u.patientId,{toast:f}=R(),[U,$]=h.useState(!1);!T.isLoading&&!u.isLoading&&!j&&!U&&($(!0),u.ensurePatient());const{data:d,isLoading:O}=q(j),x=M(),[a,b]=h.useState({}),[v,_]=h.useState(""),[y,N]=h.useState(""),[w,C]=h.useState("");h.useEffect(()=>{d&&(console.log("[ProfileEdit] Profile loaded from API:",d),console.log("[ProfileEdit] Profile gender:",d.gender),console.log("[ProfileEdit] Profile blood_type:",d.blood_type),b(d))},[d]);const X=async s=>{s.preventDefault(),console.log("[ProfileEdit] handleSubmit - patientId:",j),console.log("[ProfileEdit] handleSubmit - formData:",a);try{const l=j||await u.ensurePatient();if(!l){f({title:"เกิดข้อผิดพลาด",description:"เกิดข้อผิดพลาด กรุณาปิดแล้วเปิดแอปใหม่อีกครั้ง",variant:"destructive"});return}console.log("[ProfileEdit] Calling updateProfile.mutateAsync...");const o=await x.mutateAsync({patientId:l,data:a});console.log("[ProfileEdit] Update result:",o),f({title:"บันทึกสำเร็จ",description:"อัพเดทข้อมูลโปรไฟล์เรียบร้อยแล้ว"}),A("/settings")}catch(l){console.error("[ProfileEdit] Update error:",l),f({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง",variant:"destructive"})}},n=(s,l)=>{console.log(`[ProfileEdit] handleInputChange - field: ${s}, value:`,l),b(o=>{const k={...o,[s]:l};return console.log(`[ProfileEdit] Updated formData.${s}:`,k[s]),k})},c=(s,l)=>{l.trim()&&b(o=>({...o,[s]:[...o[s]||[],l.trim()]}))},P=(s,l)=>{b(o=>({...o,[s]:(o[s]||[]).filter((k,V)=>V!==l)}))};return O?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(F,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-4 pb-1 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>A("/settings"),children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"แก้ไขโปรไฟล์"}),e.jsxs(m,{onClick:X,disabled:x.isPending,className:"gap-2",children:[x.isPending?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(I,{className:"w-4 h-4"}),"บันทึก"]})]}),e.jsxs("form",{onSubmit:X,className:"max-w-md mx-auto px-4 py-6 space-y-6",children:[e.jsx(p,{className:"border-none shadow-sm bg-card",children:e.jsxs(g,{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"font-bold text-foreground border-b border-border pb-2",children:"ข้อมูลพื้นฐาน"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"first_name",children:"ชื่อ"}),e.jsx(t,{id:"first_name",value:a.first_name||"",onChange:s=>n("first_name",s.target.value),placeholder:"ชื่อจริง"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"last_name",children:"นามสกุล"}),e.jsx(t,{id:"last_name",value:a.last_name||"",onChange:s=>n("last_name",s.target.value),placeholder:"นามสกุล"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"nickname",children:"ชื่อเล่น"}),e.jsx(t,{id:"nickname",value:a.nickname||"",onChange:s=>n("nickname",s.target.value),placeholder:"ชื่อเล่น"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"birth_date",children:"วันเกิด"}),e.jsx(t,{id:"birth_date",type:"date",value:a.birth_date||"",onChange:s=>n("birth_date",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"gender",children:"เพศ"}),e.jsxs(L,{value:a.gender??void 0,onValueChange:s=>{console.log("[ProfileEdit] Gender selected:",s),n("gender",s)},children:[e.jsx(z,{children:e.jsx(B,{placeholder:"เลือกเพศ"})}),e.jsxs(K,{children:[e.jsx(i,{value:"male",children:"ชาย"}),e.jsx(i,{value:"female",children:"หญิง"}),e.jsx(i,{value:"other",children:"อื่นๆ"})]})]},`gender-${a.gender||"none"}`)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"phone_number",children:"เบอร์โทรศัพท์"}),e.jsx(t,{id:"phone_number",type:"tel",value:a.phone_number||"",onChange:s=>n("phone_number",s.target.value),placeholder:"081-234-5678"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"address",children:"ที่อยู่"}),e.jsx(E,{id:"address",value:a.address||"",onChange:s=>n("address",s.target.value),placeholder:"ที่อยู่",rows:3})]})]})}),e.jsx(p,{className:"border-none shadow-sm bg-card",children:e.jsxs(g,{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"font-bold text-foreground border-b border-border pb-2",children:"สถิติร่างกาย"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"weight_kg",children:"น้ำหนัก (กก.)"}),e.jsx(t,{id:"weight_kg",type:"number",step:"0.1",value:a.weight_kg||"",onChange:s=>n("weight_kg",parseFloat(s.target.value)||void 0),placeholder:"65"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"height_cm",children:"ส่วนสูง (ซม.)"}),e.jsx(t,{id:"height_cm",type:"number",value:a.height_cm||"",onChange:s=>n("height_cm",parseInt(s.target.value)||void 0),placeholder:"168"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"blood_type",children:"กรุ๊ปเลือด"}),e.jsxs(L,{value:a.blood_type??void 0,onValueChange:s=>{console.log("[ProfileEdit] Blood type selected:",s),n("blood_type",s)},children:[e.jsx(z,{children:e.jsx(B,{placeholder:"-"})}),e.jsxs(K,{children:[e.jsx(i,{value:"A",children:"A"}),e.jsx(i,{value:"B",children:"B"}),e.jsx(i,{value:"AB",children:"AB"}),e.jsx(i,{value:"O",children:"O"})]})]},`blood_type-${a.blood_type||"none"}`)]})]})]})}),e.jsx(p,{className:"border-none shadow-sm bg-card",children:e.jsxs(g,{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"font-bold text-foreground border-b border-border pb-2",children:"ข้อมูลสุขภาพ"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"โรคประจำตัว"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(a.chronic_diseases||[]).map((s,l)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-red-100 dark:bg-red-950/30 text-red-600 dark:text-red-400 rounded-full text-xs font-medium",children:[s,e.jsx("button",{type:"button",onClick:()=>P("chronic_diseases",l),children:e.jsx(D,{className:"w-3 h-3"})})]},l))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{value:w,onChange:s=>C(s.target.value),placeholder:"เพิ่มโรคประจำตัว",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),c("chronic_diseases",w),C(""))}}),e.jsx(m,{type:"button",variant:"outline",size:"icon",onClick:()=>{c("chronic_diseases",w),C("")},children:e.jsx(S,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"medical_condition",children:"อาการ/สภาพ"}),e.jsx(E,{id:"medical_condition",value:a.medical_condition||"",onChange:s=>n("medical_condition",s.target.value),placeholder:"อาการหรือสภาพปัจจุบัน",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"medical_notes",children:"หมายเหตุการรักษา"}),e.jsx(E,{id:"medical_notes",value:a.medical_notes||"",onChange:s=>n("medical_notes",s.target.value),placeholder:"หมายเหตุเพิ่มเติม",rows:2})]})]})}),e.jsx(p,{className:"border-none shadow-sm bg-card",children:e.jsxs(g,{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"font-bold text-foreground border-b border-border pb-2",children:"การแพ้"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"แพ้ยา"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(a.drug_allergies||[]).map((s,l)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-red-100 dark:bg-red-950/30 text-red-600 dark:text-red-400 rounded-full text-xs font-medium",children:[s,e.jsx("button",{type:"button",onClick:()=>P("drug_allergies",l),children:e.jsx(D,{className:"w-3 h-3"})})]},l))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{value:v,onChange:s=>_(s.target.value),placeholder:"เพิ่มยาที่แพ้",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),c("drug_allergies",v),_(""))}}),e.jsx(m,{type:"button",variant:"outline",size:"icon",onClick:()=>{c("drug_allergies",v),_("")},children:e.jsx(S,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"แพ้อาหาร"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(a.food_allergies||[]).map((s,l)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-orange-100 dark:bg-orange-950/30 text-orange-600 dark:text-orange-400 rounded-full text-xs font-medium",children:[s,e.jsx("button",{type:"button",onClick:()=>P("food_allergies",l),children:e.jsx(D,{className:"w-3 h-3"})})]},l))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{value:y,onChange:s=>N(s.target.value),placeholder:"เพิ่มอาหารที่แพ้",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),c("food_allergies",y),N(""))}}),e.jsx(m,{type:"button",variant:"outline",size:"icon",onClick:()=>{c("food_allergies",y),N("")},children:e.jsx(S,{className:"w-4 h-4"})})]})]})]})}),e.jsx(p,{className:"border-none shadow-sm bg-card",children:e.jsxs(g,{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"font-bold text-foreground border-b border-border pb-2",children:"โรงพยาบาล/ผู้ติดต่อฉุกเฉิน"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"hospital_name",children:"ชื่อโรงพยาบาล"}),e.jsx(t,{id:"hospital_name",value:a.hospital_name||"",onChange:s=>n("hospital_name",s.target.value),placeholder:"โรงพยาบาลที่ดูแล"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"hospital_phone",children:"เบอร์โรงพยาบาล"}),e.jsx(t,{id:"hospital_phone",type:"tel",value:a.hospital_phone||"",onChange:s=>n("hospital_phone",s.target.value),placeholder:"02-XXX-XXXX"})]}),e.jsxs("div",{className:"pt-4 border-t border-border space-y-4",children:[e.jsx("p",{className:"text-sm font-bold text-muted-foreground",children:"ผู้ติดต่อฉุกเฉิน"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"emergency_contact_name",children:"ชื่อผู้ติดต่อ"}),e.jsx(t,{id:"emergency_contact_name",value:a.emergency_contact_name||"",onChange:s=>n("emergency_contact_name",s.target.value),placeholder:"ชื่อผู้ติดต่อฉุกเฉิน"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"emergency_contact_relation",children:"ความสัมพันธ์"}),e.jsx(t,{id:"emergency_contact_relation",value:a.emergency_contact_relation||"",onChange:s=>n("emergency_contact_relation",s.target.value),placeholder:"เช่น ลูกสาว"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"emergency_contact_phone",children:"เบอร์โทร"}),e.jsx(t,{id:"emergency_contact_phone",type:"tel",value:a.emergency_contact_phone||"",onChange:s=>n("emergency_contact_phone",s.target.value),placeholder:"081-XXX-XXXX"})]})]})]})]})}),e.jsx(m,{type:"submit",className:"w-full",size:"lg",disabled:x.isPending,children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 animate-spin mr-2"}),"กำลังบันทึก..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"บันทึกข้อมูล"]})})]})]})}export{le as default};
