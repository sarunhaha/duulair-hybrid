import{r as m,j as e}from"./vendor-query-CmnYLxAr.js";import{n as V,u as R,w as U,L as C,g as o,z as q,N as I,e as x,f as p,p as r,I as t,r as k,X as F,O as X}from"./index-CKkR8Kf6.js";import{S as z,a as E,b as L,c as B,d as i}from"./select-nNdoGFc7.js";import{u as G,e as H}from"./use-profile-B1_vc2G0.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-pdf-IriBjpIe.js";import"./vendor-charts-Cp29jYec.js";import"./vendor-ui-Q3AHpcc6.js";import"./chevron-down-Cv5_EQn6.js";import"./chevron-up-DHyNc9Cp.js";function le(){const[,S]=V(),{context:T,user:A}=R(),j=T.patientId||(A.role==="patient"?A.profileId:null),{toast:D}=U(),{data:u,isLoading:K}=G(j),h=H(),[a,g]=m.useState({}),[b,v]=m.useState(""),[_,y]=m.useState(""),[f,N]=m.useState("");m.useEffect(()=>{u&&g(u)},[u]);const P=async s=>{if(s.preventDefault(),!!j)try{await h.mutateAsync({patientId:j,data:a}),D({title:"บันทึกสำเร็จ",description:"อัพเดทข้อมูลโปรไฟล์เรียบร้อยแล้ว"}),S("/settings")}catch{D({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง",variant:"destructive"})}},l=(s,n)=>{g(c=>({...c,[s]:n}))},d=(s,n)=>{n.trim()&&g(c=>({...c,[s]:[...c[s]||[],n.trim()]}))},w=(s,n)=>{g(c=>({...c,[s]:(c[s]||[]).filter((J,O)=>O!==n)}))};return K?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(C,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-12 pb-4 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>S("/settings"),children:e.jsx(q,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"แก้ไขโปรไฟล์"}),e.jsxs(o,{onClick:P,disabled:h.isPending,className:"gap-2",children:[h.isPending?e.jsx(C,{className:"w-4 h-4 animate-spin"}):e.jsx(I,{className:"w-4 h-4"}),"บันทึก"]})]}),e.jsxs("form",{onSubmit:P,className:"max-w-md mx-auto px-4 py-6 space-y-6",children:[e.jsx(x,{className:"border-none shadow-sm bg-card",children:e.jsxs(p,{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"font-bold text-foreground border-b border-border pb-2",children:"ข้อมูลพื้นฐาน"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"first_name",children:"ชื่อ"}),e.jsx(t,{id:"first_name",value:a.first_name||"",onChange:s=>l("first_name",s.target.value),placeholder:"ชื่อจริง"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"last_name",children:"นามสกุล"}),e.jsx(t,{id:"last_name",value:a.last_name||"",onChange:s=>l("last_name",s.target.value),placeholder:"นามสกุล"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"nickname",children:"ชื่อเล่น"}),e.jsx(t,{id:"nickname",value:a.nickname||"",onChange:s=>l("nickname",s.target.value),placeholder:"ชื่อเล่น"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"birth_date",children:"วันเกิด"}),e.jsx(t,{id:"birth_date",type:"date",value:a.birth_date||"",onChange:s=>l("birth_date",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"gender",children:"เพศ"}),e.jsxs(z,{value:a.gender||void 0,onValueChange:s=>l("gender",s),children:[e.jsx(E,{children:e.jsx(L,{placeholder:"เลือกเพศ"})}),e.jsxs(B,{children:[e.jsx(i,{value:"male",children:"ชาย"}),e.jsx(i,{value:"female",children:"หญิง"}),e.jsx(i,{value:"other",children:"อื่นๆ"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"phone_number",children:"เบอร์โทรศัพท์"}),e.jsx(t,{id:"phone_number",type:"tel",value:a.phone_number||"",onChange:s=>l("phone_number",s.target.value),placeholder:"081-234-5678"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"address",children:"ที่อยู่"}),e.jsx(k,{id:"address",value:a.address||"",onChange:s=>l("address",s.target.value),placeholder:"ที่อยู่",rows:3})]})]})}),e.jsx(x,{className:"border-none shadow-sm bg-card",children:e.jsxs(p,{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"font-bold text-foreground border-b border-border pb-2",children:"สถิติร่างกาย"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"weight_kg",children:"น้ำหนัก (กก.)"}),e.jsx(t,{id:"weight_kg",type:"number",step:"0.1",value:a.weight_kg||"",onChange:s=>l("weight_kg",parseFloat(s.target.value)||void 0),placeholder:"65"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"height_cm",children:"ส่วนสูง (ซม.)"}),e.jsx(t,{id:"height_cm",type:"number",value:a.height_cm||"",onChange:s=>l("height_cm",parseInt(s.target.value)||void 0),placeholder:"168"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"blood_type",children:"กรุ๊ปเลือด"}),e.jsxs(z,{value:a.blood_type||void 0,onValueChange:s=>l("blood_type",s),children:[e.jsx(E,{children:e.jsx(L,{placeholder:"-"})}),e.jsxs(B,{children:[e.jsx(i,{value:"A",children:"A"}),e.jsx(i,{value:"B",children:"B"}),e.jsx(i,{value:"AB",children:"AB"}),e.jsx(i,{value:"O",children:"O"})]})]})]})]})]})}),e.jsx(x,{className:"border-none shadow-sm bg-card",children:e.jsxs(p,{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"font-bold text-foreground border-b border-border pb-2",children:"ข้อมูลสุขภาพ"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"โรคประจำตัว"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(a.chronic_diseases||[]).map((s,n)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-red-100 dark:bg-red-950/30 text-red-600 dark:text-red-400 rounded-full text-xs font-medium",children:[s,e.jsx("button",{type:"button",onClick:()=>w("chronic_diseases",n),children:e.jsx(F,{className:"w-3 h-3"})})]},n))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{value:f,onChange:s=>N(s.target.value),placeholder:"เพิ่มโรคประจำตัว",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),d("chronic_diseases",f),N(""))}}),e.jsx(o,{type:"button",variant:"outline",size:"icon",onClick:()=>{d("chronic_diseases",f),N("")},children:e.jsx(X,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"medical_condition",children:"อาการ/สภาพ"}),e.jsx(k,{id:"medical_condition",value:a.medical_condition||"",onChange:s=>l("medical_condition",s.target.value),placeholder:"อาการหรือสภาพปัจจุบัน",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"medical_notes",children:"หมายเหตุการรักษา"}),e.jsx(k,{id:"medical_notes",value:a.medical_notes||"",onChange:s=>l("medical_notes",s.target.value),placeholder:"หมายเหตุเพิ่มเติม",rows:2})]})]})}),e.jsx(x,{className:"border-none shadow-sm bg-card",children:e.jsxs(p,{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"font-bold text-foreground border-b border-border pb-2",children:"การแพ้"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"แพ้ยา"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(a.drug_allergies||[]).map((s,n)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-red-100 dark:bg-red-950/30 text-red-600 dark:text-red-400 rounded-full text-xs font-medium",children:[s,e.jsx("button",{type:"button",onClick:()=>w("drug_allergies",n),children:e.jsx(F,{className:"w-3 h-3"})})]},n))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{value:b,onChange:s=>v(s.target.value),placeholder:"เพิ่มยาที่แพ้",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),d("drug_allergies",b),v(""))}}),e.jsx(o,{type:"button",variant:"outline",size:"icon",onClick:()=>{d("drug_allergies",b),v("")},children:e.jsx(X,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"แพ้อาหาร"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(a.food_allergies||[]).map((s,n)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-orange-100 dark:bg-orange-950/30 text-orange-600 dark:text-orange-400 rounded-full text-xs font-medium",children:[s,e.jsx("button",{type:"button",onClick:()=>w("food_allergies",n),children:e.jsx(F,{className:"w-3 h-3"})})]},n))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{value:_,onChange:s=>y(s.target.value),placeholder:"เพิ่มอาหารที่แพ้",onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),d("food_allergies",_),y(""))}}),e.jsx(o,{type:"button",variant:"outline",size:"icon",onClick:()=>{d("food_allergies",_),y("")},children:e.jsx(X,{className:"w-4 h-4"})})]})]})]})}),e.jsx(x,{className:"border-none shadow-sm bg-card",children:e.jsxs(p,{className:"p-4 space-y-4",children:[e.jsx("h2",{className:"font-bold text-foreground border-b border-border pb-2",children:"โรงพยาบาล/ผู้ติดต่อฉุกเฉิน"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"hospital_name",children:"ชื่อโรงพยาบาล"}),e.jsx(t,{id:"hospital_name",value:a.hospital_name||"",onChange:s=>l("hospital_name",s.target.value),placeholder:"โรงพยาบาลที่ดูแล"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"hospital_phone",children:"เบอร์โรงพยาบาล"}),e.jsx(t,{id:"hospital_phone",type:"tel",value:a.hospital_phone||"",onChange:s=>l("hospital_phone",s.target.value),placeholder:"02-XXX-XXXX"})]}),e.jsxs("div",{className:"pt-4 border-t border-border space-y-4",children:[e.jsx("p",{className:"text-sm font-bold text-muted-foreground",children:"ผู้ติดต่อฉุกเฉิน"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"emergency_contact_name",children:"ชื่อผู้ติดต่อ"}),e.jsx(t,{id:"emergency_contact_name",value:a.emergency_contact_name||"",onChange:s=>l("emergency_contact_name",s.target.value),placeholder:"ชื่อผู้ติดต่อฉุกเฉิน"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"emergency_contact_relation",children:"ความสัมพันธ์"}),e.jsx(t,{id:"emergency_contact_relation",value:a.emergency_contact_relation||"",onChange:s=>l("emergency_contact_relation",s.target.value),placeholder:"เช่น ลูกสาว"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"emergency_contact_phone",children:"เบอร์โทร"}),e.jsx(t,{id:"emergency_contact_phone",type:"tel",value:a.emergency_contact_phone||"",onChange:s=>l("emergency_contact_phone",s.target.value),placeholder:"081-XXX-XXXX"})]})]})]})]})}),e.jsx(o,{type:"submit",className:"w-full",size:"lg",disabled:h.isPending,children:h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 animate-spin mr-2"}),"กำลังบันทึก..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"บันทึกข้อมูล"]})})]})]})}export{le as default};
