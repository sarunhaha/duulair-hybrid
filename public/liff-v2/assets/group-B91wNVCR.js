import{r as x,j as e}from"./vendor-query-OvJu5Khy.js";import{y as P,x as U,z as X,u as _,e as h,f as p,N as O,g as f,h as b,U as R,E as d,I as m,G as T,J as A,L as G,b as J,K as H}from"./index-C8FjmR9I.js";import{S as q,a as z,b as M,c as V,d as Y}from"./select-BZ0Vr6_3.js";import{U as K}from"./users-D2JjmQaU.js";import{I as y}from"./info-Jmx3w2_B.js";import{L as Q}from"./lightbulb-CdjhK7YC.js";import{S as W}from"./shield-check-DeqFyhnk.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-CYcp45lG.js";import"./chevron-down-BV-bojfB.js";const Z=[{value:"child",label:"ลูก"},{value:"grandchild",label:"หลาน"},{value:"sibling",label:"พี่/น้อง"},{value:"spouse",label:"คู่สมรส"},{value:"nurse",label:"พยาบาล/ผู้ดูแลมืออาชีพ"},{value:"other",label:"อื่นๆ"}];function de(){const[,I]=P(),{profile:n}=U(),{isGroup:u,groupId:o}=X(),{setUser:w,setContext:F,setIsRegistered:L}=_(),[N,g]=x.useState(!1),[a,v]=x.useState({}),[j,C]=x.useState(null);x.useEffect(()=>{(!u||!o)&&C("กรุณาเปิดจากกลุ่ม LINE")},[u,o]);const D=()=>{const i=(n?.displayName||"").split(" "),r=i[0]||"",l=i.length>=2?i.slice(1).join(" "):"";return{caregiverFirstName:r,caregiverLastName:l,caregiverPhoneNumber:"",relationship:"",patientFirstName:"",patientLastName:"",patientBirthDate:"",patientConditions:""}},[s,S]=x.useState(D),c=(t,i)=>{S(r=>({...r,[t]:i})),a[t]&&v(r=>{const l={...r};return delete l[t],l})},E=()=>{const t={};if(s.caregiverFirstName.trim()||(t.caregiverFirstName="กรุณากรอกชื่อ"),s.caregiverLastName.trim()||(t.caregiverLastName="กรุณากรอกนามสกุล"),s.relationship||(t.relationship="กรุณาเลือกความสัมพันธ์"),s.patientFirstName.trim()||(t.patientFirstName="กรุณากรอกชื่อสมาชิก"),s.patientLastName.trim()||(t.patientLastName="กรุณากรอกนามสกุลสมาชิก"),!s.patientBirthDate)t.patientBirthDate="กรุณาเลือกวันเกิด";else{const i=new Date(s.patientBirthDate),l=new Date().getFullYear()-i.getFullYear();(l<18||l>120)&&(t.patientBirthDate="วันเกิดไม่ถูกต้อง (อายุ 18-120 ปี)")}return v(t),Object.keys(t).length===0},B=async t=>{if(t.preventDefault(),!!E()){if(!n?.userId){alert("ไม่สามารถระบุตัวตนได้ กรุณาลองใหม่อีกครั้ง");return}if(!o){alert("ไม่พบ Group ID กรุณาเปิดจากกลุ่ม LINE");return}g(!0);try{const i={lineUserId:n.userId,displayName:n.displayName||"",pictureUrl:n.pictureUrl||null,statusMessage:n.statusMessage,contextType:"group",groupId:o,caregiver:{firstName:s.caregiverFirstName.trim(),lastName:s.caregiverLastName.trim(),phoneNumber:s.caregiverPhoneNumber.trim()||null,relationship:s.relationship},patient:{firstName:s.patientFirstName.trim(),lastName:s.patientLastName.trim(),birthDate:s.patientBirthDate,medicalCondition:s.patientConditions.trim()||null}},r=await H.quickRegister(i);if(r.success){w({role:"caregiver",profileId:r.caregiverId,lineUserId:n.userId}),F({caregiverId:r.caregiverId,patientId:r.patientId,groupId:r.groupId||o}),L(!0);const l={caregiverId:r.caregiverId,patientId:r.patientId,role:"caregiver",profile_id:r.patientId,groupId:r.groupId||o,contextType:"group"};localStorage.setItem("oonjai_context",JSON.stringify(l));const k={role:"caregiver",profile_id:r.patientId,caregiver_id:r.caregiverId,line_user_id:n.userId};localStorage.setItem("oonjai_user",JSON.stringify(k)),I("/dashboard")}}catch(i){console.error("Registration failed:",i),alert(i instanceof Error?i.message:"เกิดข้อผิดพลาดในการลงทะเบียน กรุณาลองใหม่อีกครั้ง")}finally{g(!1)}}};return j?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center p-6 bg-background",children:e.jsx(h,{className:"w-full max-w-sm border-destructive/20",children:e.jsxs(p,{className:"pt-6 text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center mx-auto",children:e.jsx(O,{className:"w-8 h-8 text-destructive"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"ไม่สามารถใช้งานได้"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:j}),e.jsx(f,{onClick:()=>window.location.reload(),variant:"outline",className:"w-full",children:"ลองอีกครั้ง"})]})})}):e.jsx("div",{className:"min-h-screen bg-background pb-8",children:e.jsxs("div",{className:"max-w-md mx-auto px-4 py-6",children:[e.jsxs(h,{className:"bg-gradient-to-br from-primary to-primary/80 text-white border-none shadow-lg overflow-hidden relative mb-6",children:[e.jsx("div",{className:"absolute -right-12 -top-12 w-40 h-40 bg-white/10 rounded-full"}),e.jsx("div",{className:"absolute -left-8 -bottom-8 w-32 h-32 bg-white/5 rounded-full"}),e.jsxs(p,{className:"pt-8 pb-8 text-center relative z-10",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center mx-auto mb-4",children:e.jsx(K,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold mb-1",children:"ลงทะเบียนกลุ่ม OONJAI"}),e.jsx("p",{className:"text-white/90",children:"กรุณากรอกข้อมูลเพื่อเริ่มใช้งานในกลุ่ม"})]})]}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs(h,{className:"border shadow-sm overflow-hidden",children:[e.jsx(b,{className:"bg-muted border-b p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/15 flex items-center justify-center",children:e.jsx(R,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-foreground",children:"ข้อมูลของคุณ (ผู้ดูแล)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"เชื่อมโยงกับบัญชี LINE โดยอัตโนมัติ"})]})]})}),e.jsxs(p,{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"caregiverFirstName",children:["ชื่อ ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(m,{id:"caregiverFirstName",value:s.caregiverFirstName,onChange:t=>c("caregiverFirstName",t.target.value),placeholder:"กรอกชื่อของคุณ",className:a.caregiverFirstName?"border-destructive":""}),a.caregiverFirstName&&e.jsx("p",{className:"text-xs text-destructive",children:a.caregiverFirstName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"caregiverLastName",children:["นามสกุล ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(m,{id:"caregiverLastName",value:s.caregiverLastName,onChange:t=>c("caregiverLastName",t.target.value),placeholder:"กรอกนามสกุลของคุณ",className:a.caregiverLastName?"border-destructive":""}),a.caregiverLastName&&e.jsx("p",{className:"text-xs text-destructive",children:a.caregiverLastName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"caregiverPhoneNumber",children:"เบอร์โทรศัพท์"}),e.jsx(m,{id:"caregiverPhoneNumber",type:"tel",value:s.caregiverPhoneNumber,onChange:t=>c("caregiverPhoneNumber",t.target.value),placeholder:"0XX-XXX-XXXX"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"relationship",children:["ความสัมพันธ์กับสมาชิก ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(q,{value:s.relationship,onValueChange:t=>c("relationship",t),children:[e.jsx(z,{className:a.relationship?"border-destructive":"",children:e.jsx(M,{placeholder:"-- เลือกความสัมพันธ์ --"})}),e.jsx(V,{children:Z.map(t=>e.jsx(Y,{value:t.value,children:t.label},t.value))})]}),a.relationship&&e.jsx("p",{className:"text-xs text-destructive",children:a.relationship})]})]})]}),e.jsxs(h,{className:"border shadow-sm overflow-hidden",children:[e.jsx(b,{className:"bg-muted border-b p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent/15 flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-accent"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-foreground",children:"ข้อมูลสมาชิกที่ดูแล"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ไม่จำเป็นต้องมีบัญชี LINE"})]})]})}),e.jsxs(p,{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"patientFirstName",children:["ชื่อสมาชิก ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(m,{id:"patientFirstName",value:s.patientFirstName,onChange:t=>c("patientFirstName",t.target.value),placeholder:"กรอกชื่อสมาชิก",className:a.patientFirstName?"border-destructive":""}),a.patientFirstName&&e.jsx("p",{className:"text-xs text-destructive",children:a.patientFirstName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"patientLastName",children:["นามสกุลสมาชิก ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(m,{id:"patientLastName",value:s.patientLastName,onChange:t=>c("patientLastName",t.target.value),placeholder:"กรอกนามสกุลสมาชิก",className:a.patientLastName?"border-destructive":""}),a.patientLastName&&e.jsx("p",{className:"text-xs text-destructive",children:a.patientLastName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"patientBirthDate",children:["วันเกิดสมาชิก ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(m,{id:"patientBirthDate",type:"date",value:s.patientBirthDate,onChange:t=>c("patientBirthDate",t.target.value),className:a.patientBirthDate?"border-destructive":""}),e.jsxs("div",{className:"flex items-start gap-1.5 text-xs text-muted-foreground",children:[e.jsx(y,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"กรุณากรอกเป็น ค.ศ. (เช่น เกิดปี พ.ศ. 2496 = ค.ศ. 1953)"})]}),a.patientBirthDate&&e.jsx("p",{className:"text-xs text-destructive",children:a.patientBirthDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"patientConditions",children:"โรคประจำตัว (ถ้ามี)"}),e.jsx(A,{id:"patientConditions",value:s.patientConditions,onChange:t=>c("patientConditions",t.target.value),placeholder:"เช่น ความดันสูง, เบาหวาน",rows:3}),e.jsxs("div",{className:"flex items-start gap-1.5 text-xs text-muted-foreground",children:[e.jsx(y,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"กรอกโรคประจำตัวสำคัญ สามารถเพิ่มรายละเอียดเพิ่มเติมได้ภายหลัง"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-primary/8 border border-primary/20 rounded-xl mt-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/15 flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"w-4 h-4 text-primary"})}),e.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:"คุณสามารถเพิ่มรายละเอียดอื่นๆ เช่น ข้อมูลสุขภาพ ยาที่ทาน และอื่นๆ ได้ภายหลังที่เมนูข้อมูลสมาชิก"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{type:"submit",className:"w-full gap-2 h-12 text-base",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5 animate-spin"}),"กำลังบันทึก..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-5 h-5"}),"บันทึกและเริ่มใช้งาน"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-muted-foreground",children:[e.jsx(W,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"ข้อมูลของท่านจะถูกเก็บเป็นความลับและปลอดภัย"})]})]})]})]})})}export{de as default};
