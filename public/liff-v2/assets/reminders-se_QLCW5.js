import{r as u,j as e}from"./vendor-query-CmnYLxAr.js";import{c as O,a as w,n as G,Q as K,w as ee,g as x,z as M,L,e as I,f as q,O as te,x as D,E as se,V as ae,W as le,Y as ne,Z as ie,_ as re,X as ce,p as y,P as oe,J as de,H as ue,I as z,r as me,$ as xe,N as he}from"./index-9zVoDnz5.js";import{e as F,u as fe,a as pe,d as H,f as be,g as ge,h as ve}from"./vendor-ui-Q3AHpcc6.js";import{S as je,a as ye,b as we,c as Ne,d as _e}from"./select-BzYaAO3I.js";import{k as ke,l as Ce,m as Se,n as Pe}from"./use-profile-DQ9Ep7q8.js";import{B as Re,P as Ee}from"./pen-BWcH3r3D.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-pdf-IriBjpIe.js";import"./vendor-charts-Cp29jYec.js";import"./chevron-down-CWmnhnrU.js";import"./chevron-up-BIr7pAs0.js";const Le=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]],Ie=O("footprints",Le);const qe=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],De=O("utensils",qe);var S="Switch",[Te]=pe(S),[Ae,Me]=Te(S),V=u.forwardRef((o,m)=>{const{__scopeSwitch:a,name:n,checked:i,defaultChecked:g,required:h,disabled:d,value:f="on",onCheckedChange:N,form:r,...p}=o,[b,s]=u.useState(null),c=F(m,j=>s(j)),_=u.useRef(!1),C=b?r||!!b.closest("form"):!0,[v,P]=fe({prop:i,defaultProp:g??!1,onChange:N,caller:S});return e.jsxs(Ae,{scope:a,checked:v,disabled:d,children:[e.jsx(H.button,{type:"button",role:"switch","aria-checked":v,"aria-required":h,"data-state":$(v),"data-disabled":d?"":void 0,disabled:d,value:f,...p,ref:c,onClick:be(o.onClick,j=>{P(R=>!R),C&&(_.current=j.isPropagationStopped(),_.current||j.stopPropagation())})}),C&&e.jsx(Y,{control:b,bubbles:!_.current,name:n,value:f,checked:v,required:h,disabled:d,form:r,style:{transform:"translateX(-100%)"}})]})});V.displayName=S;var U="SwitchThumb",Z=u.forwardRef((o,m)=>{const{__scopeSwitch:a,...n}=o,i=Me(U,a);return e.jsx(H.span,{"data-state":$(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:m})});Z.displayName=U;var ze="SwitchBubbleInput",Y=u.forwardRef(({__scopeSwitch:o,control:m,checked:a,bubbles:n=!0,...i},g)=>{const h=u.useRef(null),d=F(h,g),f=ge(a),N=ve(m);return u.useEffect(()=>{const r=h.current;if(!r)return;const p=window.HTMLInputElement.prototype,s=Object.getOwnPropertyDescriptor(p,"checked").set;if(f!==a&&s){const c=new Event("click",{bubbles:n});s.call(r,a),r.dispatchEvent(c)}},[f,a,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...i,tabIndex:-1,ref:d,style:{...i.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Y.displayName=ze;function $(o){return o?"checked":"unchecked"}var W=V,Be=Z;const X=u.forwardRef(({className:o,...m},a)=>e.jsx(W,{className:w("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",o),...m,ref:a,children:e.jsx(Be,{className:w("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));X.displayName=W.displayName;const T=[{value:"medication",label:"กินยา",icon:oe,color:"bg-purple-500/10 text-purple-500",gradient:"from-purple-500 to-purple-600"},{value:"water",label:"ดื่มน้ำ",icon:de,color:"bg-blue-500/10 text-blue-500",gradient:"from-blue-500 to-blue-600"},{value:"vitals",label:"วัดความดัน",icon:ue,color:"bg-red-500/10 text-red-500",gradient:"from-red-500 to-red-600"},{value:"food",label:"ทานอาหาร",icon:De,color:"bg-orange-500/10 text-orange-500",gradient:"from-orange-500 to-orange-600"},{value:"exercise",label:"ออกกำลังกาย",icon:Ie,color:"bg-green-500/10 text-green-500",gradient:"from-green-500 to-green-600"}],A=[{value:"monday",label:"จ",fullLabel:"จันทร์"},{value:"tuesday",label:"อ",fullLabel:"อังคาร"},{value:"wednesday",label:"พ",fullLabel:"พุธ"},{value:"thursday",label:"พฤ",fullLabel:"พฤหัสบดี"},{value:"friday",label:"ศ",fullLabel:"ศุกร์"},{value:"saturday",label:"ส",fullLabel:"เสาร์"},{value:"sunday",label:"อา",fullLabel:"อาทิตย์"}],B={type:"medication",title:"",time:"08:00",note:"",frequency:"daily",days_of_week:[],is_active:!0};function Qe(){const[,o]=G(),m=K(),{toast:a}=ee(),n=m.patientId,{data:i,isLoading:g}=ke(n),h=Ce(),d=Se(),f=Pe(),[N,r]=u.useState(!1),[p,b]=u.useState(null),[s,c]=u.useState(B),_=()=>{b(null),c(B),r(!0)},C=t=>{b(t.id),c({type:t.type,title:t.title,time:t.custom_time||t.time||"08:00",note:t.note||"",frequency:t.frequency==="specific_days"?"specific_days":"daily",days_of_week:t.days_of_week||[],is_active:t.is_active}),r(!0)},v=async t=>{if(n&&confirm("ต้องการลบการเตือนนี้หรือไม่?"))try{await f.mutateAsync({id:t,patientId:n}),a({title:"ลบการเตือนเรียบร้อยแล้ว"})}catch{a({title:"ไม่สามารถลบการเตือนได้",variant:"destructive"})}},P=async t=>{if(n)try{await d.mutateAsync({id:t.id,data:{is_active:!t.is_active,patient_id:n}})}catch{a({title:"ไม่สามารถเปลี่ยนสถานะได้",variant:"destructive"})}},j=async()=>{if(!n){a({title:"กรุณาคุยกับน้องอุ่นใน LINE Chat ก่อนนะคะ",variant:"destructive"});return}if(!s.title.trim()){a({title:"กรุณาระบุชื่อเตือน",variant:"destructive"});return}if(!s.time){a({title:"กรุณาระบุเวลาเตือน",variant:"destructive"});return}if(s.frequency==="specific_days"&&s.days_of_week.length===0){a({title:"กรุณาเลือกวันที่ต้องการเตือน",variant:"destructive"});return}try{p?(await d.mutateAsync({id:p,data:{...s,custom_time:s.time,days_of_week:s.frequency==="specific_days"?s.days_of_week:void 0,patient_id:n}}),a({title:"แก้ไขการเตือนเรียบร้อยแล้ว"})):(await h.mutateAsync({...s,custom_time:s.time,days_of_week:s.frequency==="specific_days"?s.days_of_week:void 0,patient_id:n}),a({title:"เพิ่มการเตือนเรียบร้อยแล้ว"})),r(!1)}catch{a({title:"ไม่สามารถบันทึกการเตือนได้",variant:"destructive"})}},R=t=>{c(l=>({...l,days_of_week:l.days_of_week.includes(t)?l.days_of_week.filter(E=>E!==t):[...l.days_of_week,t]}))},J=t=>T.find(l=>l.value===t)||T[0];return m.isLoading?e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-12 pb-4 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>o("/settings"),children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"ตั้งเวลาเตือน"})]}),e.jsx("main",{className:"max-w-md mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-3",children:[e.jsx(L,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"กำลังโหลด..."})]})})]}):e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-12 pb-4 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>o("/settings"),children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"ตั้งเวลาเตือน"})]}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-4",children:[e.jsx(I,{className:"border-none shadow-lg bg-gradient-to-br from-teal-500 to-teal-600 text-white overflow-hidden",children:e.jsxs(q,{className:"p-6 relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("p",{className:"text-sm text-white/80",children:"การเตือนทั้งหมด"}),e.jsxs("p",{className:"text-4xl font-bold mt-1",children:[i?.length||0," ",e.jsx("span",{className:"text-lg font-normal",children:"รายการ"})]}),e.jsxs("p",{className:"text-sm text-white/80 mt-1",children:["เปิดใช้งาน ",i?.filter(t=>t.is_active).length||0," รายการ"]})]})]})}),e.jsxs(x,{className:"w-full gap-2",size:"lg",onClick:_,children:[e.jsx(te,{className:"w-5 h-5"}),"เพิ่มการเตือน"]}),g&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{className:"w-8 h-8 animate-spin text-primary"})}),!g&&(!i||i.length===0)&&e.jsx(I,{className:"border-none shadow-sm bg-card",children:e.jsxs(q,{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-muted rounded-full flex items-center justify-center",children:e.jsx(D,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"font-bold text-foreground",children:"ยังไม่มีการเตือน"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"กดปุ่มด้านบนเพื่อเพิ่มการเตือน"})]})}),i&&i.length>0&&e.jsx("div",{className:"space-y-3",children:i.map(t=>{const l=J(t.type),E=l.icon;return e.jsx(I,{className:"border-none shadow-sm bg-card overflow-hidden",children:e.jsxs(q,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:w("p-2 rounded-xl",l.color),children:e.jsx(E,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-foreground",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.label})]})]}),e.jsx("div",{className:w("p-1.5 rounded-full",t.is_active?"bg-green-100 dark:bg-green-950/30":"bg-muted"),children:t.is_active?e.jsx(D,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx(Re,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:t.custom_time||t.time}),e.jsx(X,{checked:t.is_active,onCheckedChange:()=>P(t)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-3",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:t.frequency==="daily"?"ทุกวัน":t.days_of_week?.map(k=>A.find(Q=>Q.value===k)?.fullLabel).join(", ")||"ตามกำหนด"})]}),t.frequency==="specific_days"&&t.days_of_week&&e.jsx("div",{className:"flex gap-1 mb-3",children:A.map(k=>e.jsx("span",{className:w("w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-bold",t.days_of_week?.includes(k.value)?"bg-primary text-white":"bg-muted text-muted-foreground"),children:k.label},k.value))}),t.note&&e.jsx("div",{className:"p-2 bg-accent/10 border-l-2 border-accent rounded text-xs text-muted-foreground mb-3",children:t.note}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:"default",size:"sm",className:"flex-1 gap-1",onClick:()=>C(t),children:[e.jsx(Ee,{className:"w-4 h-4"}),"แก้ไข"]}),e.jsxs(x,{variant:"destructive",size:"sm",className:"flex-1 gap-1",onClick:()=>v(t.id),children:[e.jsx(ae,{className:"w-4 h-4"}),"ลบ"]})]})]})},t.id)})})]}),e.jsx(le,{open:N,onOpenChange:r,children:e.jsxs(ne,{className:"max-h-[90vh]",children:[e.jsx(ie,{className:"border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-primary"}),p?"แก้ไขการเตือน":"เพิ่มการเตือน"]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>r(!1),children:e.jsx(ce,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"ประเภท"}),e.jsxs(je,{value:s.type,onValueChange:t=>c(l=>({...l,type:t})),children:[e.jsx(ye,{children:e.jsx(we,{})}),e.jsx(Ne,{children:T.map(t=>e.jsx(_e,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"reminder_title",children:"ชื่อเตือน *"}),e.jsx(z,{id:"reminder_title",value:s.title,onChange:t=>c(l=>({...l,title:t.target.value})),placeholder:"เช่น กินยาความดัน"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"reminder_time",children:"เวลาเตือน *"}),e.jsx(z,{id:"reminder_time",type:"time",value:s.time,onChange:t=>c(l=>({...l,time:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"ความถี่"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"button",variant:s.frequency==="daily"?"default":"outline",className:"flex-1",onClick:()=>c(t=>({...t,frequency:"daily"})),children:"ทุกวัน"}),e.jsx(x,{type:"button",variant:s.frequency==="specific_days"?"default":"outline",className:"flex-1",onClick:()=>c(t=>({...t,frequency:"specific_days"})),children:"เลือกวัน"})]})]}),s.frequency==="specific_days"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"เลือกวันที่ต้องการเตือน"}),e.jsx("div",{className:"flex gap-2 justify-center",children:A.map(t=>e.jsx("button",{type:"button",onClick:()=>R(t.value),className:w("w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold transition-colors",s.days_of_week.includes(t.value)?"bg-primary text-white":"bg-muted text-muted-foreground hover:bg-muted/80"),children:t.label},t.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"หมายเหตุ (ถ้ามี)"}),e.jsx(me,{value:s.note,onChange:t=>c(l=>({...l,note:t.target.value})),placeholder:"เพิ่มรายละเอียดเพิ่มเติม",rows:2})]})]}),e.jsx(xe,{className:"border-t border-border",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"outline",className:"flex-1",onClick:()=>r(!1),children:"ยกเลิก"}),e.jsxs(x,{className:"flex-1 gap-2",onClick:j,disabled:h.isPending||d.isPending,children:[(h.isPending||d.isPending)&&e.jsx(L,{className:"w-4 h-4 animate-spin"}),e.jsx(he,{className:"w-4 h-4"}),"บันทึก"]})]})})]})})]})}export{Qe as default};
