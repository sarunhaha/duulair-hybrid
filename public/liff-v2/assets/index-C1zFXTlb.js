import{r as M,j as e}from"./vendor-query-OvJu5Khy.js";import{c as u,x as L,u as O,w as _,g as a,V as A,e as r,h as c,a6 as d,f as l,b as I}from"./index-CkSmyO3D.js";import{a as T,b as $}from"./use-profile-CU7jKnbf.js";import{L as J}from"./link-2-BrmuTS-B.js";import{C as S}from"./copy-BNCo8na4.js";import{S as q}from"./share-2-EK5OU3Mf.js";import{U as z}from"./users-5YtOauE0.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-CYcp45lG.js";const H=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],E=u("qr-code",H);const P=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],R=u("refresh-cw",P);function X(){const[,j]=L(),{user:i}=O(),{shareTargetPicker:N}=_(),o=i.role==="patient"?i.profileId:null,{data:s,refetch:g,isLoading:b}=T(o),{data:n=[]}=$(o),[x,m]=M.useState(!1),y=async()=>{s?.code&&(await navigator.clipboard.writeText(s.code),m(!0),setTimeout(()=>m(!1),2e3))},k=async()=>{if(s?.code)try{await N([{type:"text",text:`เชิญคุณเป็นผู้ดูแลของฉันใน OONJAI

รหัสเชื่อมต่อ: ${s.code}

กรอกรหัสนี้ในแอป OONJAI เพื่อเชื่อมต่อ`}])}catch{navigator.share&&navigator.share({title:"เชื่อมต่อผู้ดูแล OONJAI",text:`เชิญคุณเป็นผู้ดูแลของฉันใน OONJAI

รหัสเชื่อมต่อ: ${s.code}`})}},v=()=>{g()},w=()=>{if(!s?.expires_at)return null;const t=new Date(s.expires_at),C=new Date,h=t.getTime()-C.getTime(),f=Math.floor(h/(1e3*60*60)),p=Math.floor(h%(1e3*60*60)/(1e3*60));return f>0?`${f} ชม. ${p} นาที`:`${p} นาที`};return e.jsxs("div",{className:"min-h-screen bg-background pb-8 font-sans",children:[e.jsx("header",{className:"bg-card pt-12 pb-4 px-4 sticky top-0 z-20 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{variant:"ghost",size:"icon",onClick:()=>j("/profile"),className:"shrink-0",children:e.jsx(A,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"เชื่อมต่อผู้ดูแล"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"แชร์รหัสให้ผู้ดูแลเพื่อเชื่อมต่อ"})]})]})}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-6",children:[e.jsxs(r,{className:"border-none shadow-sm bg-gradient-to-br from-accent/10 to-accent/5",children:[e.jsx(c,{className:"pb-2",children:e.jsxs(d,{className:"text-base font-bold flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-accent"}),"รหัสเชื่อมต่อของคุณ"]})}),e.jsx(l,{children:b?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"กำลังโหลด..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-card rounded-2xl p-6 text-center mb-4",children:[e.jsx("p",{className:"text-4xl font-mono font-bold tracking-[0.3em] text-accent",children:s?.code||"------"}),s?.expires_at&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["หมดอายุใน ",w()]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs(a,{variant:"outline",className:"flex-col h-auto py-3 rounded-2xl",onClick:y,children:[x?e.jsx(I,{className:"w-5 h-5 text-green-500 mb-1"}):e.jsx(S,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs",children:x?"คัดลอกแล้ว":"คัดลอก"})]}),e.jsxs(a,{variant:"outline",className:"flex-col h-auto py-3 rounded-2xl",onClick:k,children:[e.jsx(q,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs",children:"แชร์"})]}),e.jsxs(a,{variant:"outline",className:"flex-col h-auto py-3 rounded-2xl",onClick:v,children:[e.jsx(R,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs",children:"สร้างใหม่"})]})]})]})})]}),e.jsxs(r,{className:"border-none shadow-sm",children:[e.jsx(c,{className:"pb-2",children:e.jsxs(d,{className:"text-base font-bold flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-muted-foreground"}),"วิธีเชื่อมต่อ"]})}),e.jsxs(l,{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent/10 flex items-center justify-center text-accent font-bold text-sm shrink-0",children:"1"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"แชร์รหัสนี้ให้ผู้ดูแลของคุณ (ลูก/หลาน/ญาติ)"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent/10 flex items-center justify-center text-accent font-bold text-sm shrink-0",children:"2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'ผู้ดูแลเปิดแอป OONJAI และเลือก "เป็นผู้ดูแล"'})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent/10 flex items-center justify-center text-accent font-bold text-sm shrink-0",children:"3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ผู้ดูแลกรอกรหัสนี้เพื่อเชื่อมต่อกับคุณ"})]})]})]}),e.jsxs(r,{className:"border-none shadow-sm",children:[e.jsx(c,{className:"pb-2",children:e.jsxs(d,{className:"text-base font-bold flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-muted-foreground"}),"ผู้ดูแลที่เชื่อมต่อแล้ว (",n.length,")"]})}),e.jsx(l,{children:n.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"ยังไม่มีผู้ดูแลเชื่อมต่อ"}):e.jsx("div",{className:"space-y-2",children:n.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-muted/20",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center text-accent font-bold",children:t.first_name?.charAt(0)||"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium truncate",children:[t.first_name," ",t.last_name]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.relationship||"ผู้ดูแล"})]}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500",title:"เชื่อมต่อแล้ว"})]},t.id))})})]})]})]})}export{X as default};
