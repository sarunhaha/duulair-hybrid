import{r as f,j as e}from"./vendor-query-OvJu5Khy.js";import{G as w,a0 as P,W as k,a1 as C,g as d,_ as p,L as l,e as L,f as M,P as g,a4 as A,K as E,a3 as z}from"./index-DdYhxTwe.js";import{g as D,h as I,i as K}from"./use-profile-CQGf2qKJ.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-CYcp45lG.js";function H(){const[,o]=w(),m=P(),{toast:a}=k(),n=C(),i=n.patientId,[j,N]=f.useState(!1),[r,x]=f.useState("");!m.isLoading&&!n.isLoading&&!i&&!j&&(N(!0),n.ensurePatient());const{data:t,isLoading:u}=D(i),c=I(),b=K(),h=async()=>{if(!r.trim()){a({title:"กรุณาระบุชื่อยา",variant:"destructive"});return}try{const s=i||await n.ensurePatient();if(!s){a({title:"ไม่สามารถสร้างโปรไฟล์ได้ กรุณาลองใหม่อีกครั้ง",variant:"destructive"});return}await c.mutateAsync({name:r.trim(),patient_id:s,active:!0}),x(""),a({title:"เพิ่มรายการยาเรียบร้อยแล้ว"})}catch{a({title:"ไม่สามารถเพิ่มรายการยาได้",variant:"destructive"})}},v=async s=>{if(i&&confirm("ต้องการลบรายการยานี้หรือไม่?"))try{await b.mutateAsync({id:s,patientId:i}),a({title:"ลบรายการยาเรียบร้อยแล้ว"})}catch{a({title:"ไม่สามารถลบรายการยาได้",variant:"destructive"})}},y=s=>{s.key==="Enter"&&!c.isPending&&h()};return m.isLoading||n.isLoading?e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-4 pb-1 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>o("/settings"),children:e.jsx(p,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"รายการยา"})]}),e.jsx("main",{className:"max-w-md mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-3",children:[e.jsx(l,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"กำลังโหลด..."})]})})]}):e.jsxs("div",{className:"min-h-screen pb-8 font-sans bg-background",children:[e.jsxs("header",{className:"bg-card pt-4 pb-1 px-6 sticky top-0 z-20 flex items-center gap-4 border-b border-border",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>o("/settings"),children:e.jsx(p,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold text-foreground flex-1",children:"รายการยา"})]}),e.jsx("main",{className:"max-w-md mx-auto px-4 py-6 space-y-4",children:e.jsx(L,{className:"border-none shadow-sm",children:e.jsxs(M,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-accent/10 flex items-center justify-center text-accent",children:e.jsx(g,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-bold",children:"ยาของฉัน"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"จัดการรายการยาและเวลาเตือน"})]}),t&&t.length>0&&e.jsxs("span",{className:"text-xs font-bold text-muted-foreground bg-muted/50 px-2 py-1 rounded-lg",children:[t.length," รายการ"]})]}),u&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(l,{className:"w-6 h-6 animate-spin text-primary"})}),!u&&(!t||t.length===0)&&e.jsxs("div",{className:"flex flex-col items-center py-6 text-center",children:[e.jsx("div",{className:"w-12 h-12 mb-3 bg-muted/50 rounded-full flex items-center justify-center",children:e.jsx(g,{className:"w-6 h-6 text-muted-foreground"})}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"ยังไม่มีรายการยา"}),e.jsx("p",{className:"text-xs text-muted-foreground/70 mt-0.5",children:"เพิ่มชื่อยาด้านล่างได้เลย"})]}),t&&t.length>0&&e.jsx("div",{className:"space-y-3",children:t.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-muted/20 p-3 rounded-xl",children:[e.jsx("p",{className:"text-sm font-bold text-foreground",children:s.name}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-red-500",onClick:()=>v(s.id),children:e.jsx(A,{className:"w-4 h-4"})})]},s.id))}),e.jsxs("div",{className:"pt-4 border-t space-y-3",children:[e.jsx("p",{className:"text-xs font-bold text-foreground",children:"เพิ่มรายการยาใหม่"}),e.jsx(E,{value:r,onChange:s=>x(s.target.value),onKeyDown:y,placeholder:"ชื่อยา และขนาด (เช่น Paracetamol 500mg)",className:"bg-muted/20"}),e.jsxs(d,{className:"w-full h-11 rounded-xl text-sm font-bold bg-accent/10 text-accent hover:bg-accent/20 border border-accent/20",onClick:h,disabled:c.isPending||!r.trim(),children:[c.isPending?e.jsx(l,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(z,{className:"w-4 h-4 mr-2"}),"เพิ่มยาของคุณ"]})]})]})})})]})}export{H as default};
