import{u as L,r as p,j as e}from"./vendor-query-CmnYLxAr.js";import{k as C,u as X,a as E,H as G,P as Q,M as J,L as U,e as j,f as N,l as Z,B as ee}from"./index-9zVoDnz5.js";import{s as R,f as V,t as te}from"./th-WB27h3IP.js";import{b as se,L as ae,C as k,X as w,Y as M,T as A,d as D,e as re,B as _,f as F,g as W}from"./vendor-charts-Cp29jYec.js";import{I as ne}from"./info-D1t1Y9ue.js";import{M as oe}from"./message-circle-heart-Dah3HnQq.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-pdf-IriBjpIe.js";import"./vendor-ui-Q3AHpcc6.js";function S(t){const s=new Date;return Array.from({length:t},(l,i)=>{const n=R(s,t-1-i);return V(n,"d MMM",{locale:te})})}function $(t){const s=new Date;return Array.from({length:t},(l,i)=>{const n=R(s,t-1-i);return V(n,"yyyy-MM-dd")})}const K={"7d":7,"15d":15,"30d":30},g={all:["trends"],vitals:(t,s)=>[...g.all,"vitals",t,s],meds:(t,s)=>[...g.all,"meds",t,s],sleep:(t,s)=>[...g.all,"sleep",t,s]};function le(t,s){return L({queryKey:t?g.vitals(t,s):["trends","vitals","none"],queryFn:async()=>{if(!t)return z(s);try{return await C.get(`/trends/vitals/${t}?range=${s}`)}catch{return console.warn("Vitals trend API not available, using mock data"),z(s)}},enabled:!0,staleTime:60*1e3})}function de(t,s){return L({queryKey:t?g.meds(t,s):["trends","meds","none"],queryFn:async()=>{if(!t)return q(s);try{return await C.get(`/trends/meds/${t}?range=${s}`)}catch{return console.warn("Meds trend API not available, using mock data"),q(s)}},enabled:!0,staleTime:60*1e3})}function ie(t,s){return L({queryKey:t?g.sleep(t,s):["trends","sleep","none"],queryFn:async()=>{if(!t)return H(s);try{return await C.get(`/trends/sleep/${t}?range=${s}`)}catch{return console.warn("Sleep trend API not available, using mock data"),H(s)}},enabled:!0,staleTime:60*1e3})}function z(t){const s=K[t],l=S(s),i=$(s),n=l.map((d,m)=>{const c=120+Math.floor(Math.random()*25),f=75+Math.floor(Math.random()*15),b=70+Math.floor(Math.random()*20),y=c>=140||f>=90;return{day:d,date:i[m],systolic:c,diastolic:f,pulse:b,event:y?"สูง":void 0,note:y&&Math.random()>.5?"ความดันสูงกว่าปกติ":void 0}}),o=Math.round(n.reduce((d,m)=>d+(m.systolic||0),0)/n.length),h=Math.round(n.reduce((d,m)=>d+(m.diastolic||0),0)/n.length),a=n.filter(d=>d.systolic!==null).length;return{data:n,summary:{avg:`${o}/${h}`,label1:"ค่าเฉลี่ย",count:`วัดแล้ว ${a}/${s} วัน`,label2:"วันที่มีการวัด"},insight:ce(o,h,t)}}function q(t){const s=K[t],l=S(s),i=$(s),n=l.map((a,d)=>{const c=Math.random()>.2?2:Math.random()>.5?1:0,f=Math.round(c/2*100);return{day:a,date:i[d],target:2,done:c,percent:f,event:c===0?"ลืม":c<2?"พลาด":void 0,note:c<2?c===0?"ลืมทั้งวัน":"พลาดบางมื้อ":void 0}}),o=Math.round(n.reduce((a,d)=>a+(d.percent||0),0)/n.length),h=n.filter(a=>a.percent===100).length;return{data:n,summary:{avg:`${o}%`,label1:"% กินยาครบ",count:`กินครบ ${h}/${s} วัน`,label2:"วันกินครบ"},insight:me(o)}}function H(t){const s=K[t],l=S(s),i=$(s),n=l.map((a,d)=>{const m=parseFloat((5+Math.random()*3.5).toFixed(1)),c=m<6;return{day:a,date:i[d],hours:m,event:c?"น้อย":void 0,note:c?"นอนน้อยกว่าเกณฑ์":void 0}}),o=(n.reduce((a,d)=>a+(d.hours||0),0)/n.length).toFixed(1),h=n.filter(a=>a.hours!==null).length;return{data:n,summary:{avg:`${o} ชม.`,label1:"ชม.นอนเฉลี่ย",count:`บันทึก ${h}/${s} คืน`,label2:"คืนที่บันทึก"},insight:ue(parseFloat(o))}}function ce(t,s,l){return t>=140||s>=90?"ความดันโดยเฉลี่ยสูงกว่าปกติ ควรปรึกษาแพทย์เพื่อปรับยา":t>=130||s>=80?"ความดันอยู่ในระดับสูงกว่าปกติเล็กน้อย ควรระวังเรื่องอาหารเค็มและพักผ่อนให้เพียงพอ":`ความดัน${l==="7d"?"สัปดาห์นี้":l==="15d"?"15 วันที่ผ่านมา":"เดือนนี้"}อยู่ในเกณฑ์ดี ควบคุมได้ต่อเนื่อง`}function me(t,s,l){return t>=95?"กินยาครบถ้วนมาก สุดยอดครับ!":t>=80?"กินยาได้ดี แต่ยังพลาดบ้าง ลองตั้งเตือนเพิ่มไหมครับ":t>=60?"ช่วงนี้พลาดกินยาบ่อย ลองหาวิธีจดจำที่เหมาะกับคุณนะครับ":"ต้องปรับปรุงการกินยา ลองตั้งนาฬิกาเตือนหรือบอกคนใกล้ชิดให้ช่วยเตือน"}function ue(t,s){return t>=7?"พักผ่อนเพียงพอ สุขภาพโดยรวมจะดีครับ":t>=6?"นอนได้พอประมาณ ลองเข้านอนเร็วขึ้นอีกสัก 30 นาทีจะดีมากครับ":"นอนน้อยกว่าเกณฑ์ ลองพักงีบช่วงบ่าย และเข้านอนเร็วขึ้นนะครับ"}const B={data:[{day:"จ",date:"2026-01-06",systolic:122,diastolic:80,pulse:72},{day:"อ",date:"2026-01-07",systolic:125,diastolic:82,pulse:75,event:"สูงนิดหน่อย"},{day:"พ",date:"2026-01-08",systolic:118,diastolic:78,pulse:70},{day:"พฤ",date:"2026-01-09",systolic:120,diastolic:79,pulse:73},{day:"ศ",date:"2026-01-10",systolic:123,diastolic:81,pulse:74,note:"ตื่นมาเหนื่อย"},{day:"ส",date:"2026-01-11",systolic:119,diastolic:77,pulse:71},{day:"อา",date:"2026-01-12",systolic:121,diastolic:80,pulse:72}],summary:{avg:"121/79",count:"7/7 วัน",label1:"ค่าเฉลี่ย",label2:"บันทึกครบ"},insight:"ความดันคุณอยู่ในเกณฑ์ปกติตลอดสัปดาห์ ยอดเยี่ยม!"},xe={data:[{day:"จ",date:"2026-01-06",percent:100,target:3,done:3},{day:"อ",date:"2026-01-07",percent:67,target:3,done:2,note:"ลืมมื้อเที่ยง"},{day:"พ",date:"2026-01-08",percent:100,target:3,done:3},{day:"พฤ",date:"2026-01-09",percent:100,target:3,done:3},{day:"ศ",date:"2026-01-10",percent:100,target:3,done:3},{day:"ส",date:"2026-01-11",percent:33,target:3,done:1,note:"ลืม 2 มื้อ"},{day:"อา",date:"2026-01-12",percent:100,target:3,done:3}],summary:{avg:"86%",count:"5/7 วัน",label1:"อัตราครบ",label2:"กินครบทั้งวัน"},insight:"สัปดาห์นี้คุณลืมยา 2 วัน ลองตั้งเตือนเพิ่มช่วงเที่ยงนะคะ"},he={data:[{day:"จ",date:"2026-01-06",hours:7.5},{day:"อ",date:"2026-01-07",hours:6.2,note:"นอนดึก"},{day:"พ",date:"2026-01-08",hours:7},{day:"พฤ",date:"2026-01-09",hours:5.5,note:"ตื่นกลางดึก"},{day:"ศ",date:"2026-01-10",hours:8},{day:"ส",date:"2026-01-11",hours:7.2},{day:"อา",date:"2026-01-12",hours:6.8}],summary:{avg:"6.9 ชม.",count:"7/7 วัน",label1:"เฉลี่ย/คืน",label2:"บันทึกครบ"},insight:"สัปดาห์นี้คุณนอนเฉลี่ย 6.9 ชม. ลองนอนก่อน 22:00 จะดีขึ้นนะคะ"};function we(){const{context:t,user:s}=X(),l=t.patientId||(s.role==="patient"?s.profileId:null),[i,n]=p.useState("7d"),[o,h]=p.useState("heart"),[a,d]=p.useState(null),{data:m,isLoading:c}=le(l,i),{data:f,isLoading:b}=de(l,i),{data:y,isLoading:T}=ie(l,i),u=p.useMemo(()=>{switch(o){case"heart":return m||B;case"meds":return f||xe;case"sleep":return y||he;default:return m||B}},[o,m,f,y]),P=p.useMemo(()=>{switch(o){case"heart":return c;case"meds":return b;case"sleep":return T;default:return!1}},[o,c,b,T]);p.useEffect(()=>{d(null)},[i,o]);const I=[{id:"heart",label:"ความดัน",icon:G},{id:"meds",label:"ยา",icon:Q},{id:"sleep",label:"นอน",icon:J}],v=r=>{r&&r.activePayload&&r.activePayload[0]&&d(r.activePayload[0].payload)};return e.jsxs("div",{className:"min-h-screen pb-32 font-sans overflow-x-hidden relative z-10 bg-background",children:[e.jsx("header",{className:"bg-card pt-12 pb-4 px-6 sticky top-0 z-20 flex justify-between items-center border-b border-border",children:e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"แนวโน้ม"})}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-6 animate-in fade-in duration-500",children:[e.jsx("div",{className:"flex bg-muted/50 p-1 rounded-xl",children:["7d","15d","30d"].map((r,x)=>{const Y=["7 วัน","15 วัน","30 วัน"][x],O=i===r;return e.jsx("button",{onClick:()=>n(r),className:E("flex-1 py-2 text-xs font-semibold rounded-lg transition-all",O?"bg-primary/10 text-primary shadow-sm border border-primary/30":"text-muted-foreground"),children:Y},r)})}),e.jsx("div",{className:"flex bg-muted/50 p-1 rounded-xl",children:I.map(r=>{const x=o===r.id;return e.jsxs("button",{onClick:()=>h(r.id),className:E("flex-1 py-2 text-xs font-semibold rounded-lg transition-all flex items-center justify-center gap-1.5",x?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground"),children:[e.jsx(r.icon,{className:"w-4 h-4"}),r.label]},r.id)})}),P&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(U,{className:"w-8 h-8 animate-spin text-primary"})}),!P&&u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 transition-all",children:[e.jsx(j,{className:"border-none shadow-sm bg-card hover:shadow-md transition-shadow",children:e.jsxs(N,{className:"p-4",children:[e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-1",children:u.summary.label1}),e.jsx("p",{className:"text-xl font-bold text-foreground",children:u.summary.avg})]})}),e.jsx(j,{className:"border-none shadow-sm bg-card hover:shadow-md transition-shadow",children:e.jsxs(N,{className:"p-4",children:[e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-1",children:u.summary.label2}),e.jsx("p",{className:"text-xl font-bold text-foreground",children:u.summary.count})]})})]}),e.jsxs(j,{className:"border-none shadow-sm bg-card p-6 relative",children:[o==="heart"&&e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 text-[10px] font-bold uppercase tracking-wider",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-1 bg-[#0E8A9A] rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"SYS"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-1 border-t-2 border-dashed border-[#0E8A9A]"}),e.jsx("span",{className:"text-muted-foreground",children:"DIA"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-3 h-1 bg-[#F2994A] rounded"}),e.jsx("span",{className:"text-muted-foreground",children:"HR"})]})]}),e.jsx("div",{className:"h-[240px] w-full",children:e.jsx(se,{width:"100%",height:"100%",children:o==="heart"?e.jsxs(ae,{data:u.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:v,children:[e.jsx(k,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(w,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(M,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"}}),e.jsx(A,{cursor:{stroke:"#0E8A9A",strokeWidth:1,strokeDasharray:"4 4"},content:()=>null}),e.jsx(D,{type:"monotone",dataKey:"systolic",stroke:"#0E8A9A",strokeWidth:3,dot:{r:4,fill:"white",strokeWidth:2,stroke:"#0E8A9A"},activeDot:{r:6,strokeWidth:0,fill:"#0E8A9A"}}),e.jsx(D,{type:"monotone",dataKey:"diastolic",stroke:"rgba(14, 138, 154, 0.5)",strokeWidth:2,strokeDasharray:"5 5",dot:{r:3,fill:"white",strokeWidth:2,stroke:"rgba(14, 138, 154, 0.5)"}}),e.jsx(D,{type:"monotone",dataKey:"pulse",stroke:"#F2994A",strokeWidth:2,dot:{r:3,fill:"white",strokeWidth:2,stroke:"#F2994A"}}),u.data.map((r,x)=>r.event?e.jsx(re,{x:r.day,y:r.systolic,r:6,fill:"hsl(var(--destructive) / 0.2)",stroke:"hsl(var(--destructive))",strokeWidth:1},x):null)]}):o==="meds"?e.jsxs(_,{data:u.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:v,children:[e.jsx(k,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(w,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(M,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[0,100]}),e.jsx(A,{cursor:{fill:"transparent"},content:()=>null}),e.jsx(F,{dataKey:"percent",radius:[6,6,0,0],children:u.data.map((r,x)=>e.jsx(W,{fill:r.percent===100?"#10b981":r.percent===0?"#ef4444":"#f97316"},`cell-${x}`))})]}):e.jsxs(_,{data:u.data,margin:{top:10,right:10,left:-25,bottom:0},onClick:v,children:[e.jsx(k,{strokeDasharray:"3 3",vertical:!1,stroke:"hsl(var(--muted))"}),e.jsx(w,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},dy:10}),e.jsx(M,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"hsl(var(--muted-foreground))"},domain:[0,10]}),e.jsx(A,{cursor:{fill:"transparent"},content:()=>null}),e.jsx(F,{dataKey:"hours",radius:[6,6,0,0],children:u.data.map((r,x)=>e.jsx(W,{fill:r.hours&&r.hours<6?"#f97316":"#8b5cf6"},`cell-${x}`))})]})})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("p",{className:"text-[10px] text-muted-foreground font-medium bg-muted/30 px-3 py-1 rounded-full flex items-center gap-1.5",children:[e.jsx(ne,{className:"w-3 h-3"})," แตะจุดบนกราฟเพื่อดูรายละเอียด"]})}),a&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-muted/50 animate-in fade-in slide-in-from-top-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-muted-foreground",children:a.day}),o==="heart"&&e.jsxs("div",{className:"flex items-baseline gap-2 mt-1",children:[e.jsxs("p",{className:"text-xl font-bold text-primary",children:[a.systolic,"/",a.diastolic," ",e.jsx("span",{className:"text-xs font-normal text-muted-foreground",children:"mmHg"})]}),e.jsxs("p",{className:"text-base font-bold text-orange-500",children:[a.pulse," ",e.jsx("span",{className:"text-xs font-normal text-muted-foreground",children:"bpm"})]})]}),o==="meds"&&e.jsx("div",{className:"mt-1",children:e.jsxs("p",{className:"text-sm font-bold text-foreground",children:["ตั้งไว้ ",a.target," ช่วง | ทำได้ ",a.done," ช่วง |"," ","= ",a.percent,"%"]})}),o==="sleep"&&e.jsx("div",{className:"mt-1",children:e.jsxs("p",{className:"text-xl font-bold text-indigo-600",children:[a.hours," ",e.jsx("span",{className:"text-xs font-normal text-muted-foreground",children:"ชม."})]})})]}),a.note&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-950/30 px-3 py-2 rounded-xl text-xs font-medium text-yellow-700 dark:text-yellow-400 max-w-[150px]",children:['"',a.note,'"']})]}),a.event&&!a.note&&e.jsxs("div",{className:"mt-2 inline-flex items-center gap-1.5 bg-red-50 dark:bg-red-950/30 text-red-600 dark:text-red-400 px-2.5 py-1 rounded-full",children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px] font-bold",children:a.event})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-sm font-bold text-foreground flex items-center gap-2 pl-1",children:[e.jsx("div",{className:"w-1 h-4 bg-accent rounded-full"}),"อุ่นใจสังเกตให้"]}),e.jsx(j,{className:"border-none shadow-sm bg-accent/5 overflow-hidden group hover:bg-accent/10 transition-colors",children:e.jsxs(N,{className:"p-5 flex gap-4 items-start",children:[e.jsx("div",{className:"bg-accent/10 p-3 rounded-2xl text-accent group-hover:scale-110 transition-transform",children:e.jsx(oe,{className:"w-6 h-6"})}),e.jsx("div",{className:"flex-1 space-y-2",children:e.jsxs("p",{className:"text-sm leading-relaxed font-semibold text-foreground",children:['"',u.insight,'"']})})]})})]})]})]}),e.jsx(ee,{})]})}export{we as default};
