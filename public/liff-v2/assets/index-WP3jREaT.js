import{u as ae,r as _,j as e}from"./vendor-query-CmnYLxAr.js";import{c as X,k as re,m as ne,u as oe,g as S,z as le,e as y,f as b,H as F,T as de,a3 as ce,P as A,D as R,a4 as L,h as k,$,a0 as ie}from"./index-D-hba6Ji.js";import{E as me,a as H}from"./vendor-pdf-IriBjpIe.js";import{n as he,c as ue,s as D,f,t as C}from"./th-Czkms0GK.js";import{u as xe}from"./use-profile-6EwYg9As.js";import{C as pe}from"./calendar-SbU6UT1B.js";import{C as ge}from"./chevron-down-rktdoo5w.js";import{b as E,L as fe,C as O,X as B,Y as K,T as W,h as ye,d as V,B as U,f as q}from"./vendor-charts-BXW63HGx.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-B_i-mS0z.js";const be=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],je=X("download",be);const ve=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Ne=X("trending-down",ve);function we(s,l){const[m,t]=he(s,l.start,l.end);return{start:m,end:t}}function Me(s,l){const{start:m,end:t}=we(l?.in,s);let n=+m>+t;const r=n?+m:+t,h=n?t:m;h.setHours(0,0,0,0);let u=1;const c=[];for(;+h<=r;)c.push(ue(m,h)),h.setDate(h.getDate()+u),h.setHours(0,0,0,0);return n?c.reverse():c}const Q={all:["reports"],data:(s,l,m)=>[...Q.all,"data",s,l,m]};function Z(s,l,m){const t=new Date;let n;switch(s){case"7d":n=D(t,6);break;case"30d":n=D(t,29);break;case"90d":n=D(t,89);break;case"custom":return n=D(t,6),{startDate:n,endDate:t};default:n=D(t,6)}return{startDate:n,endDate:t}}function De(s,l){const m=f(s,"d MMM",{locale:C}),t=f(l,"d MMM yyyy",{locale:C});return`${m} - ${t}`}function Se(s,l,m,t){const{startDate:n,endDate:r}=Z(l),h=f(n,"yyyy-MM-dd"),u=f(r,"yyyy-MM-dd");return ae({queryKey:s?Q.data(s,h,u):["reports","data","none"],queryFn:async()=>{if(!s)return G(n,r);try{return await re.get(`/reports/${s}?start=${h}&end=${u}`)}catch{return console.warn("Reports API not available, using mock data"),G(n,r)}},enabled:!!s||!0,staleTime:60*1e3})}function ke(s,l){return s>=180||l>=120?"crisis":s>=140||l>=90?"high":s>=130||l>=80?"elevated":"normal"}function ee(s){return{normal:"ปกติ",elevated:"สูงเล็กน้อย",high:"สูง",crisis:"สูงมาก"}[s]||s}function te(s){return{good:"ดีมาก",fair:"พอใช้",poor:"ต้องปรับปรุง"}[s]||s}function se(s){return{good:"เพียงพอ",fair:"พอใช้",poor:"น้อยเกินไป"}[s]||s}function Y(s){return{medication:"กินยา",vitals:"วัดความดัน",water:"ดื่มน้ำ",symptom:"อาการ",sleep:"การนอน",exercise:"ออกกำลังกาย"}[s]||s}function $e(s,l,m){const t=[];t.push(["รายงานสุขภาพ - "+l]),t.push(["ช่วงเวลา: "+m]),t.push([]),t.push(["สรุปภาพรวม"]),t.push(["ความดันเฉลี่ย",`${s.summary.bp.avgSystolic}/${s.summary.bp.avgDiastolic} mmHg`]),t.push(["การกินยา",`${s.summary.meds.adherencePercent}%`]),t.push(["น้ำดื่มเฉลี่ย",`${s.summary.water.avgMl} มล./วัน`]),t.push(["กิจกรรมทั้งหมด",`${s.summary.activities.total} รายการ`]),t.push([]),t.push(["ข้อมูลรายวัน"]),t.push(["วันที่","Systolic","Diastolic","ยา (%)","น้ำ (มล.)"]),s.chartData.forEach(c=>{t.push([c.date,c.systolic?.toString()||"-",c.diastolic?.toString()||"-",c.medsPercent?.toString()||"-",c.waterMl?.toString()||"-"])}),t.push([]),t.push(["รายละเอียดกิจกรรม"]),t.push(["วันที่","เวลา","ประเภท","รายละเอียด"]),s.activities.forEach(c=>{t.push([c.date,c.time,Y(c.type),c.value])});const n=t.map(c=>c.join(",")).join(`
`),r="\uFEFF",h=new Blob([r+n],{type:"text/csv;charset=utf-8;"}),u=document.createElement("a");u.href=URL.createObjectURL(h),u.download=`health-report-${f(new Date,"yyyy-MM-dd")}.csv`,u.click()}function Ce(s,l,m){const t=new me,n=t.internal.pageSize.getWidth();let r=20;t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Health Report - OONJAI",n/2,r,{align:"center"}),r+=10,t.setFontSize(12),t.setFont("helvetica","normal"),t.text(`Patient: ${l}`,n/2,r,{align:"center"}),r+=7,t.text(`Period: ${m}`,n/2,r,{align:"center"}),r+=15,t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Summary",14,r),r+=10,t.setFontSize(11),t.setFont("helvetica","normal");const h=[["Blood Pressure (Average)",`${s.summary.bp.avgSystolic}/${s.summary.bp.avgDiastolic} mmHg`,ee(s.summary.bp.status)],["Medication Adherence",`${s.summary.meds.adherencePercent}%`,te(s.summary.meds.status)],["Water Intake (Average)",`${s.summary.water.avgMl} ml/day`,se(s.summary.water.status)],["Total Activities",`${s.summary.activities.total}`,""]];H(t,{startY:r,head:[["Metric","Value","Status"]],body:h,theme:"striped",headStyles:{fillColor:[30,123,156]},margin:{left:14,right:14}}),r=t.lastAutoTable.finalY+15,t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Daily Records",14,r),r+=10;const u=s.chartData.map(a=>[a.date,a.systolic?.toString()||"-",a.diastolic?.toString()||"-",a.medsPercent!==void 0?`${a.medsPercent}%`:"-",a.waterMl?.toString()||"-"]);H(t,{startY:r,head:[["Date","Systolic","Diastolic","Meds (%)","Water (ml)"]],body:u,theme:"striped",headStyles:{fillColor:[30,123,156]},margin:{left:14,right:14},styles:{fontSize:9}}),r=t.lastAutoTable.finalY+15,r>230&&(t.addPage(),r=20),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Activity Log",14,r),r+=10;const c=s.activities.slice(0,20).map(a=>[a.date,a.time,Y(a.type),a.value]);H(t,{startY:r,head:[["Date","Time","Type","Detail"]],body:c,theme:"striped",headStyles:{fillColor:[30,123,156]},margin:{left:14,right:14},styles:{fontSize:9}});const g=t.getNumberOfPages();for(let a=1;a<=g;a++)t.setPage(a),t.setFontSize(8),t.setFont("helvetica","italic"),t.text(`Generated by OONJAI - ${f(new Date,"yyyy-MM-dd HH:mm")} - Page ${a} of ${g}`,n/2,t.internal.pageSize.getHeight()-10,{align:"center"});t.save(`health-report-${f(new Date,"yyyy-MM-dd")}.pdf`)}function G(s,l){const m=Me({start:s,end:l}),t=m.map(o=>{const x=115+Math.floor(Math.random()*30),M=70+Math.floor(Math.random()*20),j=Math.random()>.2?100:Math.random()>.5?50:0,N=1e3+Math.floor(Math.random()*1500);return{date:f(o,"yyyy-MM-dd"),day:f(o,"d MMM",{locale:C}),systolic:Math.random()>.1?x:void 0,diastolic:Math.random()>.1?M:void 0,medsPercent:j,waterMl:Math.random()>.15?N:void 0}}),n=t.filter(o=>o.systolic&&o.diastolic),r=n.length>0?Math.round(n.reduce((o,x)=>o+(x.systolic||0),0)/n.length):0,h=n.length>0?Math.round(n.reduce((o,x)=>o+(x.diastolic||0),0)/n.length):0,u=t.filter(o=>o.medsPercent!==void 0),c=u.length>0?Math.round(u.reduce((o,x)=>o+(x.medsPercent||0),0)/u.length):0,g=t.filter(o=>o.waterMl!==void 0),a=g.length>0?Math.round(g.reduce((o,x)=>o+(x.waterMl||0),0)/g.length):0,v=[],w=["medication","vitals","water","symptom"];return m.forEach(o=>{const x=2+Math.floor(Math.random()*4);for(let M=0;M<x;M++){const j=w[Math.floor(Math.random()*w.length)],N=6+Math.floor(Math.random()*14),d=Math.floor(Math.random()*60);let p="",i="";switch(j){case"medication":p="กินยา",i=["ยาลดความดัน","Metformin","วิตามิน"][Math.floor(Math.random()*3)];break;case"vitals":p="วัดความดัน",i=`${115+Math.floor(Math.random()*30)}/${70+Math.floor(Math.random()*20)} mmHg`;break;case"water":p="ดื่มน้ำ",i=`${250+Math.floor(Math.random()*500)} มล.`;break;case"symptom":p="บันทึกอาการ",i=["ปวดหัว","เวียนศีรษะ","อ่อนเพลีย"][Math.floor(Math.random()*3)];break}v.push({id:`${f(o,"yyyy-MM-dd")}-${M}`,type:j,title:p,value:i,timestamp:new Date(o.setHours(N,d)).toISOString(),date:f(o,"d MMM",{locale:C}),time:`${N.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`})}}),v.sort((o,x)=>new Date(x.timestamp).getTime()-new Date(o.timestamp).getTime()),{summary:{bp:{avgSystolic:r,avgDiastolic:h,count:n.length,status:ke(r,h)},meds:{adherencePercent:c,takenCount:u.filter(o=>o.medsPercent===100).length,totalCount:u.length,status:c>=90?"good":c>=70?"fair":"poor"},water:{avgMl:a,daysRecorded:g.length,status:a>=1500?"good":a>=1e3?"fair":"poor"},activities:{total:v.length,byType:v.reduce((o,x)=>(o[x.type]=(o[x.type]||0)+1,o),{})}},chartData:t,activities:v.slice(0,30)}}const J=[{value:"7d",label:"7 วัน"},{value:"30d",label:"30 วัน"},{value:"90d",label:"90 วัน"}];function Be(){const[,s]=ne(),{user:l}=oe(),m=l.role==="patient"?l.profileId:null,[t,n]=_.useState("7d"),[r,h]=_.useState(!1),{startDate:u,endDate:c}=Z(t),g=De(u,c),{data:a,isLoading:v}=Se(m,t),{data:w}=xe(m),P=w?`${w.first_name} ${w.last_name}`:"ผู้ใช้งาน",o=()=>{a&&$e(a,P,g)},x=()=>{a&&Ce(a,P,g)},j=(()=>{if(!a?.chartData||a.chartData.length<2)return null;const d=a.chartData.slice(-3),p=a.chartData.slice(0,3),i=d.reduce((z,T)=>z+(T.systolic||0),0)/d.length,I=p.reduce((z,T)=>z+(T.systolic||0),0)/p.length;return i>I+5?"up":i<I-5?"down":"stable"})(),N=a?.activities.reduce((d,p)=>{const i=p.date;return d[i]||(d[i]=[]),d[i].push(p),d},{});return e.jsxs("div",{className:"min-h-screen bg-background pb-8 font-sans",children:[e.jsx("header",{className:"bg-card pt-12 pb-4 px-4 sticky top-0 z-20 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>s("/settings"),className:"shrink-0",children:e.jsx(le,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"รายงานสุขภาพ"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g})]})]})}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(S,{variant:"outline",className:"w-full justify-between rounded-2xl h-12",onClick:()=>h(!r),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"font-medium",children:J.find(d=>d.value===t)?.label})]}),e.jsx(ge,{className:`w-4 h-4 transition-transform ${r?"rotate-180":""}`})]}),r&&e.jsx(y,{className:"absolute top-14 left-0 right-0 z-30 shadow-lg",children:e.jsx(b,{className:"p-2",children:J.map(d=>e.jsx("button",{onClick:()=>{n(d.value),h(!1)},className:`w-full text-left px-4 py-3 rounded-xl transition-colors ${t===d.value?"bg-accent/10 text-accent font-bold":"hover:bg-muted/50"}`,children:d.label},d.value))})})]}),v?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"กำลังโหลดข้อมูล..."}):a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(y,{className:"border-none shadow-sm",children:e.jsxs(b,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"bg-red-100 dark:bg-red-950/30 p-2 rounded-xl",children:e.jsx(F,{className:"w-5 h-5 text-red-500"})}),j==="up"&&e.jsx(de,{className:"w-4 h-4 text-red-500"}),j==="down"&&e.jsx(Ne,{className:"w-4 h-4 text-green-500"}),j==="stable"&&e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"})]}),e.jsxs("p",{className:"text-2xl font-bold mt-3",children:[a.summary.bp.avgSystolic,"/",a.summary.bp.avgDiastolic]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"mmHg เฉลี่ย"}),e.jsx("p",{className:`text-xs font-medium mt-1 ${a.summary.bp.status==="normal"?"text-green-600":a.summary.bp.status==="elevated"?"text-yellow-600":"text-red-600"}`,children:ee(a.summary.bp.status)})]})}),e.jsx(y,{className:"border-none shadow-sm",children:e.jsxs(b,{className:"p-4",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-950/30 p-2 rounded-xl w-fit",children:e.jsx(A,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("p",{className:"text-2xl font-bold mt-3",children:[a.summary.meds.adherencePercent,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"กินยาครบ"}),e.jsx("p",{className:`text-xs font-medium mt-1 ${a.summary.meds.status==="good"?"text-green-600":a.summary.meds.status==="fair"?"text-yellow-600":"text-red-600"}`,children:te(a.summary.meds.status)})]})}),e.jsx(y,{className:"border-none shadow-sm",children:e.jsxs(b,{className:"p-4",children:[e.jsx("div",{className:"bg-cyan-100 dark:bg-cyan-950/30 p-2 rounded-xl w-fit",children:e.jsx(R,{className:"w-5 h-5 text-cyan-500"})}),e.jsx("p",{className:"text-2xl font-bold mt-3",children:a.summary.water.avgMl}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"มล./วัน เฉลี่ย"}),e.jsx("p",{className:`text-xs font-medium mt-1 ${a.summary.water.status==="good"?"text-green-600":a.summary.water.status==="fair"?"text-yellow-600":"text-red-600"}`,children:se(a.summary.water.status)})]})}),e.jsx(y,{className:"border-none shadow-sm",children:e.jsxs(b,{className:"p-4",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-950/30 p-2 rounded-xl w-fit",children:e.jsx(L,{className:"w-5 h-5 text-purple-500"})}),e.jsx("p",{className:"text-2xl font-bold mt-3",children:a.summary.activities.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"กิจกรรมทั้งหมด"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Object.entries(a.summary.activities.byType).slice(0,2).map(([d,p])=>`${Y(d)} ${p}`).join(", ")})]})})]}),e.jsxs(y,{className:"border-none shadow-sm",children:[e.jsx(k,{className:"pb-2",children:e.jsxs($,{className:"text-base font-bold flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-red-500"}),"กราฟความดันโลหิต"]})}),e.jsx(b,{children:e.jsx("div",{className:"h-52",children:e.jsx(E,{width:"100%",height:"100%",children:e.jsxs(fe,{data:a.chartData,margin:{top:5,right:5,left:-20,bottom:5},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),e.jsx(B,{dataKey:"day",tick:{fontSize:10},stroke:"hsl(var(--muted-foreground))"}),e.jsx(K,{domain:[60,180],tick:{fontSize:10},stroke:"hsl(var(--muted-foreground))"}),e.jsx(W,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px",fontSize:"12px"}}),e.jsx(ye,{wrapperStyle:{fontSize:"11px"}}),e.jsx(V,{type:"monotone",dataKey:"systolic",name:"ตัวบน",stroke:"hsl(0, 84%, 60%)",strokeWidth:2,dot:{r:3},connectNulls:!0}),e.jsx(V,{type:"monotone",dataKey:"diastolic",name:"ตัวล่าง",stroke:"hsl(210, 84%, 60%)",strokeWidth:2,dot:{r:3},connectNulls:!0})]})})})})]}),e.jsxs(y,{className:"border-none shadow-sm",children:[e.jsx(k,{className:"pb-2",children:e.jsxs($,{className:"text-base font-bold flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-blue-500"}),"กราฟการกินยา"]})}),e.jsx(b,{children:e.jsx("div",{className:"h-40",children:e.jsx(E,{width:"100%",height:"100%",children:e.jsxs(U,{data:a.chartData,margin:{top:5,right:5,left:-20,bottom:5},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),e.jsx(B,{dataKey:"day",tick:{fontSize:10},stroke:"hsl(var(--muted-foreground))"}),e.jsx(K,{domain:[0,100],tick:{fontSize:10},stroke:"hsl(var(--muted-foreground))"}),e.jsx(W,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px",fontSize:"12px"},formatter:d=>[`${d??0}%`,"กินยา"]}),e.jsx(q,{dataKey:"medsPercent",name:"กินยา (%)",fill:"hsl(210, 84%, 60%)",radius:[4,4,0,0]})]})})})})]}),e.jsxs(y,{className:"border-none shadow-sm",children:[e.jsx(k,{className:"pb-2",children:e.jsxs($,{className:"text-base font-bold flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-cyan-500"}),"กราฟน้ำดื่ม"]})}),e.jsx(b,{children:e.jsx("div",{className:"h-40",children:e.jsx(E,{width:"100%",height:"100%",children:e.jsxs(U,{data:a.chartData,margin:{top:5,right:5,left:-20,bottom:5},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),e.jsx(B,{dataKey:"day",tick:{fontSize:10},stroke:"hsl(var(--muted-foreground))"}),e.jsx(K,{domain:[0,3e3],tick:{fontSize:10},stroke:"hsl(var(--muted-foreground))"}),e.jsx(W,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px",fontSize:"12px"},formatter:d=>[`${d??0} มล.`,"น้ำดื่ม"]}),e.jsx(q,{dataKey:"waterMl",name:"น้ำดื่ม (มล.)",fill:"hsl(187, 84%, 50%)",radius:[4,4,0,0]})]})})})})]}),e.jsxs(y,{className:"border-none shadow-sm",children:[e.jsx(k,{className:"pb-2",children:e.jsxs($,{className:"text-base font-bold flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-purple-500"}),"รายละเอียดกิจกรรม"]})}),e.jsx(b,{className:"space-y-4",children:N&&Object.entries(N).slice(0,5).map(([d,p])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-muted-foreground mb-2",children:d}),e.jsx("div",{className:"space-y-2",children:p.map(i=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-xl bg-muted/20",children:[e.jsxs("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${i.type==="medication"?"bg-blue-100 dark:bg-blue-950/30 text-blue-500":i.type==="vitals"?"bg-red-100 dark:bg-red-950/30 text-red-500":i.type==="water"?"bg-cyan-100 dark:bg-cyan-950/30 text-cyan-500":"bg-purple-100 dark:bg-purple-950/30 text-purple-500"}`,children:[i.type==="medication"&&e.jsx(A,{className:"w-4 h-4"}),i.type==="vitals"&&e.jsx(F,{className:"w-4 h-4"}),i.type==="water"&&e.jsx(R,{className:"w-4 h-4"}),i.type==="symptom"&&e.jsx(L,{className:"w-4 h-4"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:i.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:i.value})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i.time})]},i.id))})]},d))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(S,{onClick:o,variant:"outline",className:"flex-1 h-12 rounded-2xl",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"CSV"]}),e.jsxs(S,{onClick:x,variant:"outline",className:"flex-1 h-12 rounded-2xl",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"PDF"]})]})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"ไม่พบข้อมูล"})]})]})}export{Be as default};
