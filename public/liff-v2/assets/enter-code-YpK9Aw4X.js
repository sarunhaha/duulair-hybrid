import{r as i,c as y,j as e}from"./vendor-query-OvJu5Khy.js";import{c as v,y as k,u as w,e as n,f as l,g as h,W as C,h as u,a8 as f,I as S,p as A,l as E}from"./index-_Km7b4ag.js";import{C as I}from"./circle-check-H950hwhS.js";import{L}from"./link-2-DWrL3BC9.js";import"./vendor-react-qkC6yhPU.js";import"./vendor-ui-CYcp45lG.js";const P=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],_=v("user-plus",P);function O(){const[,p]=k(),{user:d}=w(),o=d.role==="caregiver"?d.profileId:null,[t,j]=i.useState(""),[x,a]=i.useState(null),[g,m]=i.useState(!1),c=y({mutationFn:async s=>{if(!o)throw new Error("ไม่พบข้อมูลผู้ดูแล");return E.post("/registration/link-patient",{link_code:s,caregiver_id:o,relationship:"family"})},onSuccess:()=>{m(!0),a(null),setTimeout(()=>{p("/dashboard")},2e3)},onError:s=>{a(s.message||"รหัสไม่ถูกต้องหรือหมดอายุ"),m(!1)}}),N=s=>{s.preventDefault();const r=t.toUpperCase().replace(/[^A-Z0-9]/g,"");if(r.length!==6){a("กรุณากรอกรหัส 6 หลัก");return}a(null),c.mutate(r)},b=s=>{const r=s.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"");r.length<=6&&(j(r),a(null))};return g?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsx(n,{className:"border-none shadow-lg max-w-sm w-full",children:e.jsxs(l,{className:"pt-8 pb-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 dark:bg-green-950/30 flex items-center justify-center mx-auto mb-4",children:e.jsx(I,{className:"w-8 h-8 text-green-600 dark:text-green-400"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:"เชื่อมต่อสำเร็จ!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"คุณได้เชื่อมต่อกับผู้สูงอายุเรียบร้อยแล้ว กำลังนำไปหน้าหลัก..."})]})})}):e.jsxs("div",{className:"min-h-screen bg-background pb-8 font-sans",children:[e.jsx("header",{className:"bg-card pt-12 pb-4 px-4 sticky top-0 z-20 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>window.history.back(),className:"shrink-0",children:e.jsx(C,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"เชื่อมต่อกับผู้สูงอายุ"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"กรอกรหัสที่ได้รับจากผู้สูงอายุ"})]})]})}),e.jsxs("main",{className:"max-w-md mx-auto px-4 py-6 space-y-6",children:[e.jsxs(n,{className:"border-none shadow-sm",children:[e.jsx(u,{className:"pb-2",children:e.jsxs(f,{className:"text-base font-bold flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-accent"}),"กรอกรหัสเชื่อมต่อ"]})}),e.jsx(l,{children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(S,{type:"text",value:t,onChange:b,placeholder:"ABC123",className:"text-center text-3xl font-mono tracking-[0.3em] h-16 rounded-2xl uppercase",maxLength:6,autoComplete:"off",autoFocus:!0}),t.length>0&&e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-sm text-muted-foreground",children:[t.length,"/6"]})]}),x&&e.jsxs("div",{className:"flex items-center gap-2 text-red-500 text-sm",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:x})]}),e.jsx(h,{type:"submit",className:"w-full h-12 rounded-2xl",disabled:t.length!==6||c.isPending,children:c.isPending?"กำลังเชื่อมต่อ...":e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"เชื่อมต่อ"]})})]})})]}),e.jsxs(n,{className:"border-none shadow-sm",children:[e.jsx(u,{className:"pb-2",children:e.jsx(f,{className:"text-base font-bold",children:"ขอรหัสได้อย่างไร?"})}),e.jsxs(l,{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent/10 flex items-center justify-center text-accent font-bold text-sm shrink-0",children:"1"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ให้ผู้สูงอายุเปิดแอป OONJAI"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent/10 flex items-center justify-center text-accent font-bold text-sm shrink-0",children:"2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'ไปที่ "โปรไฟล์" → "เชื่อมต่อผู้ดูแล"'})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent/10 flex items-center justify-center text-accent font-bold text-sm shrink-0",children:"3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"คัดลอกหรือแชร์รหัส 6 หลักมาให้คุณ"})]})]})]}),e.jsx(n,{className:"border-none shadow-sm bg-accent/5",children:e.jsxs(l,{className:"py-4",children:[e.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"ทำไมต้องเชื่อมต่อ?"}),e.jsxs("ul",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• ดูข้อมูลสุขภาพของผู้สูงอายุได้แบบเรียลไทม์"}),e.jsx("li",{children:"• รับแจ้งเตือนเมื่อมีความผิดปกติ"}),e.jsx("li",{children:"• ช่วยเตือนการกินยาและนัดพบแพทย์"}),e.jsx("li",{children:"• ติดตามดูแลได้ทุกที่ทุกเวลา"})]})]})})]})]})}export{O as default};
