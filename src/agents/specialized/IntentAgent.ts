// src/agents/specialized/IntentAgent.ts
import { BaseAgent, Message, Response, Config } from '../core/BaseAgent';
import { AGENT_MODELS } from '../../services/openrouter.service';

export class IntentAgent extends BaseAgent {
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î patterns ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏ö intent (Group-Based Care Model)
  // ‡πÄ‡∏û‡∏¥‡πà‡∏° patterns ‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
  private patterns = {
    // Activity logging intents (Message commands)
    medication: [
      /‡∏¢‡∏≤/, /‡∏Å‡∏¥‡∏ô.*‡∏¢‡∏≤/, /‡∏ó‡∏≤‡∏ô.*‡∏¢‡∏≤/, /‡∏•‡∏∑‡∏°‡∏¢‡∏≤/, /‡πÅ‡∏•‡πâ‡∏ß.*‡∏¢‡∏≤/, /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≤/,
      /‡∏¢‡∏≤.*‡∏Å‡∏¥‡∏ô/, /‡∏¢‡∏≤.*‡∏ó‡∏≤‡∏ô/, /‡∏¢‡∏≤.*‡πÅ‡∏•‡πâ‡∏ß/, /‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô.*‡∏¢‡∏≤/, /‡∏¢‡∏≤.*‡πÄ‡∏™‡∏£‡πá‡∏à/,
      /‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤/, /‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤/, /‡∏Å‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß/, /‡∏ó‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß/, /‡∏¢‡∏≤‡πÄ‡∏ä‡πâ‡∏≤/, /‡∏¢‡∏≤‡πÄ‡∏¢‡πá‡∏ô/
    ],
    vitals: [
      /‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô/, /‡∏ß‡∏±‡∏î/, /bp/, /‡∏´‡∏±‡∏ß‡πÉ‡∏à/, /‡∏ä‡∏µ‡∏û‡∏à‡∏£/, /‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô/, /‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•/, /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô/,
      /‡∏î‡∏±‡∏ô.*‡πÄ‡∏•‡∏∑‡∏≠‡∏î/, /‡πÄ‡∏•‡∏∑‡∏≠‡∏î.*‡∏î‡∏±‡∏ô/, /‡∏ß‡∏±‡∏î.*‡πÅ‡∏•‡πâ‡∏ß/, /‡∏ß‡∏±‡∏î.*‡∏Ñ‡∏ß‡∏≤‡∏°/, /‡∏Ñ‡∏ß‡∏≤‡∏°.*‡∏î‡∏±‡∏ô.*‡πÄ‡∏•‡∏∑‡∏≠‡∏î/,
      /\d+\/\d+/, /‡∏ß‡∏±‡∏î.*‡πÄ‡∏™‡∏£‡πá‡∏à/, /‡∏î‡∏±‡∏ô.*‡∏™‡∏π‡∏á/, /‡∏î‡∏±‡∏ô.*‡∏ï‡πà‡∏≥/, /‡∏ï‡∏£‡∏ß‡∏à.*‡πÄ‡∏•‡∏∑‡∏≠‡∏î/
    ],
    water: [
      /‡∏ô‡πâ‡∏≥/, /‡∏î‡∏∑‡πà‡∏°/, /‡∏Å‡∏£‡∏∞‡∏´‡∏≤‡∏¢/, /‡πÅ‡∏Å‡πâ‡∏ß/, /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡πâ‡∏≥/,
      /‡∏ô‡πâ‡∏≥.*‡∏î‡∏∑‡πà‡∏°/, /‡∏î‡∏∑‡πà‡∏°.*‡∏ô‡πâ‡∏≥/, /‡∏î‡∏∑‡πà‡∏°.*‡πÅ‡∏•‡πâ‡∏ß/, /‡∏ô‡πâ‡∏≥.*‡πÅ‡∏•‡πâ‡∏ß/, /‡∏î‡∏∑‡πà‡∏°.*‡πÄ‡∏™‡∏£‡πá‡∏à/,
      /ml/, /‡∏°‡∏•/, /‡πÅ‡∏Å‡πâ‡∏ß.*‡∏ô‡πâ‡∏≥/, /‡∏Ç‡∏ß‡∏î.*‡∏ô‡πâ‡∏≥/, /‡∏î‡∏∑‡πà‡∏°.*‡πÄ‡∏û‡∏¥‡πà‡∏°/
    ],
    walk: [
      /‡πÄ‡∏î‡∏¥‡∏ô/, /‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á/, /‡∏ß‡∏¥‡πà‡∏á/, /‡∏Å‡∏µ‡∏¨‡∏≤/, /‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û/, /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô/,
      /‡πÄ‡∏î‡∏¥‡∏ô.*‡πÅ‡∏•‡πâ‡∏ß/, /‡πÄ‡∏î‡∏¥‡∏ô.*‡πÄ‡∏™‡∏£‡πá‡∏à/, /‡∏≠‡∏≠‡∏Å.*‡∏Å‡∏≥‡∏•‡∏±‡∏á.*‡πÅ‡∏•‡πâ‡∏ß/, /‡∏Å‡∏≥‡∏•‡∏±‡∏á.*‡πÅ‡∏•‡πâ‡∏ß/,
      /‡∏ß‡∏¥‡πà‡∏á.*‡πÅ‡∏•‡πâ‡∏ß/, /‡∏¢‡∏∑‡∏î.*‡πÄ‡∏™‡πâ‡∏ô/, /‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß/, /‡∏≠‡∏≠‡∏Å.*‡πÅ‡∏•‡πâ‡∏ß/, /‡∏ô‡∏≤‡∏ó‡∏µ/
    ],
    food: [
      /‡∏≠‡∏≤‡∏´‡∏≤‡∏£/, /‡∏Å‡∏¥‡∏ô/, /‡∏Ç‡πâ‡∏≤‡∏ß/, /‡∏°‡∏∑‡πâ‡∏≠/, /‡πÄ‡∏ä‡πâ‡∏≤/, /‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô/, /‡πÄ‡∏¢‡πá‡∏ô/, /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£/,
      /‡∏Å‡∏¥‡∏ô.*‡πÅ‡∏•‡πâ‡∏ß/, /‡∏ó‡∏≤‡∏ô.*‡πÅ‡∏•‡πâ‡∏ß/, /‡∏Å‡∏¥‡∏ô.*‡∏Ç‡πâ‡∏≤‡∏ß/, /‡∏ó‡∏≤‡∏ô.*‡∏Ç‡πâ‡∏≤‡∏ß/, /‡∏Å‡∏¥‡∏ô.*‡πÄ‡∏™‡∏£‡πá‡∏à/,
      /‡∏°‡∏∑‡πâ‡∏≠.*‡πÄ‡∏ä‡πâ‡∏≤/, /‡∏°‡∏∑‡πâ‡∏≠.*‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô/, /‡∏°‡∏∑‡πâ‡∏≠.*‡πÄ‡∏¢‡πá‡∏ô/, /‡∏Ç‡πâ‡∏≤‡∏ß.*‡πÄ‡∏ä‡πâ‡∏≤/, /‡∏Ç‡πâ‡∏≤‡∏ß.*‡πÄ‡∏¢‡πá‡∏ô/
    ],

    // Emergency & alerts
    emergency: [
      /‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô/, /‡∏ä‡πà‡∏ß‡∏¢/, /‡πÄ‡∏à‡πá‡∏ö/, /‡∏õ‡∏ß‡∏î/, /‡∏•‡πâ‡∏°/, /‡∏´‡∏≤‡∏¢.*‡πÉ‡∏à.*‡πÑ‡∏°‡πà.*‡∏≠‡∏≠‡∏Å/, /‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢/,
      /‡∏ä‡πà‡∏ß‡∏¢.*‡∏î‡πâ‡∏ß‡∏¢/, /‡∏ä‡πà‡∏ß‡∏¢.*‡πÄ‡∏´‡∏•‡∏∑‡∏≠/, /‡πÄ‡∏à‡πá‡∏ö.*‡∏°‡∏≤‡∏Å/, /‡∏õ‡∏ß‡∏î.*‡∏°‡∏≤‡∏Å/, /‡∏´‡∏°‡∏î.*‡∏™‡∏ï‡∏¥/,
      /‡∏ä‡πá‡∏≠‡∏Å/, /‡∏™‡∏≤‡∏´‡∏±‡∏™/, /‡∏´‡∏ô‡πâ‡∏≤.*‡∏°‡∏∑‡∏î/, /‡πÉ‡∏à.*‡∏™‡∏±‡πà‡∏ô/, /‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏°/
    ],

    // Reports (Message command) - Rich Menu sends "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û"
    report_menu: [/^‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô$/, /^‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô$/, /^‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û$/],
    // Health Log Menu - Rich Menu sends "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û"
    health_log_menu: [/^‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û$/, /^‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û$/, /^‡πÄ‡∏°‡∏ô‡∏π‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û$/, /^‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û$/],
    report: [
      /‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ/, /‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå/, /‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/, /‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ/, /‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå/, /üìä.*‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô/,
      /‡∏™‡∏£‡∏∏‡∏õ/, /‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô.*‡∏õ‡∏£‡∏∞‡∏à‡∏≥/,
      /‡∏ú‡∏•.*‡∏ï‡∏£‡∏ß‡∏à/, /‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•.*‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ/, /‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•.*‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå/
    ],

    // LIFF page intents
    view_patient_profile: [/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/, /‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå/, /‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/, /‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/, /üë§/],
    view_medications: [/‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤/, /‡∏¢‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î/, /‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏≤/, /üíä/],
    view_reminders: [/‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤/, /‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /üîî/],
    view_settings: [/‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤/, /‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡∏Å‡∏•‡∏∏‡πà‡∏°/, /‚öôÔ∏è/],

    // Registration & group management
    registration: [/‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô/, /‡∏™‡∏°‡∏±‡∏Ñ‡∏£/, /‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠/, /register/, /‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°/, /‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô/],
    join_group: [/‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°/, /‡∏•‡∏¥‡∏á‡∏Å‡πå/, /link code/, /‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏•‡∏∏‡πà‡∏°/],

    // Help & support
    package: [/‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à/, /‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£/, /‡∏£‡∏≤‡∏Ñ‡∏≤/, /package/, /‡∏ü‡∏£‡∏µ/, /pro/],
    help: [
      /‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠/, /help/, /‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ/, /‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°/, /faq/, /‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à/,
      /‡∏ó‡∏≥.*‡∏¢‡∏±‡∏á‡πÑ‡∏á/, /‡πÉ‡∏ä‡πâ.*‡∏¢‡∏±‡∏á‡πÑ‡∏á/, /‡∏™‡∏≠‡∏ô/, /‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥/, /‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠/
    ],

    // Quick actions from Rich Menu
    quick_log: [/^üìù.*‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/, /^‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°$/],

    // Patient info queries (for group) - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô
    patient_info: [
      /‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/, /‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/, /‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/, /‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•.*‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î/,
      /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/, /‡∏î‡∏π.*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/, /‡πÄ‡∏ä‡πá‡∏Ñ.*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/, /‡∏ö‡∏≠‡∏Å.*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/
    ],
    patient_name: [
      /‡∏ä‡∏∑‡πà‡∏≠.*‡∏≠‡∏∞‡πÑ‡∏£/, /‡∏ä‡∏∑‡πà‡∏≠.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/, /‡∏ä‡∏∑‡πà‡∏≠.*‡πÉ‡∏Ñ‡∏£/, /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏ä‡∏∑‡πà‡∏≠/,
      /‡∏ä‡∏∑‡πà‡∏≠/, /‡πÄ‡∏Ç‡∏≤.*‡∏ä‡∏∑‡πà‡∏≠/, /‡∏ó‡πà‡∏≤‡∏ô.*‡∏ä‡∏∑‡πà‡∏≠/, /‡∏Ñ‡∏∏‡∏ì.*‡∏ä‡∏∑‡πà‡∏≠/, /‡∏ö‡∏≠‡∏Å.*‡∏ä‡∏∑‡πà‡∏≠/
    ],
    patient_age: [
      /‡∏≠‡∏≤‡∏¢‡∏∏.*‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà/, /‡∏≠‡∏≤‡∏¢‡∏∏.*‡∏Å‡∏µ‡πà.*‡∏õ‡∏µ/, /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏≠‡∏≤‡∏¢‡∏∏/, /‡πÅ‡∏Å‡πà.*‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô/,
      /‡∏≠‡∏≤‡∏¢‡∏∏/, /‡∏Å‡∏µ‡πà.*‡∏Ç‡∏ß‡∏ö/, /‡πÄ‡∏Å‡∏¥‡∏î.*‡∏õ‡∏µ/, /‡∏≠‡∏≤‡∏¢‡∏∏.*‡πÄ‡∏ó‡πà‡∏≤/, /‡∏õ‡∏µ.*‡πÄ‡∏Å‡∏¥‡∏î/
    ],
    patient_conditions: [
      /‡πÇ‡∏£‡∏Ñ.*‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß/, /‡πÇ‡∏£‡∏Ñ.*‡∏≠‡∏∞‡πÑ‡∏£/, /‡∏õ‡πà‡∏ß‡∏¢.*‡πÄ‡∏õ‡πá‡∏ô.*‡∏≠‡∏∞‡πÑ‡∏£/, /‡∏°‡∏µ.*‡πÇ‡∏£‡∏Ñ/,
      /‡πÄ‡∏õ‡πá‡∏ô.*‡πÇ‡∏£‡∏Ñ/, /‡πÇ‡∏£‡∏Ñ/, /‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥.*‡πÇ‡∏£‡∏Ñ/, /‡∏õ‡πà‡∏ß‡∏¢/, /‡∏°‡∏µ.*‡∏≠‡∏≤‡∏Å‡∏≤‡∏£/
    ],
    patient_medications: [
      /‡∏Å‡∏¥‡∏ô.*‡∏¢‡∏≤.*‡∏≠‡∏∞‡πÑ‡∏£/, /‡∏¢‡∏≤.*‡∏ó‡∏µ‡πà.*‡∏Å‡∏¥‡∏ô/, /‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£.*‡∏¢‡∏≤/, /‡∏¢‡∏≤.*‡∏≠‡∏∞‡πÑ‡∏£.*‡∏ö‡πâ‡∏≤‡∏á/,
      /‡∏¢‡∏≤.*‡∏≠‡∏∞‡πÑ‡∏£/, /‡∏ó‡∏≤‡∏ô.*‡∏¢‡∏≤/, /‡∏¢‡∏≤.*‡∏õ‡∏£‡∏∞‡∏à‡∏≥/, /‡∏¢‡∏≤.*‡∏ó‡∏µ‡πà.*‡∏ï‡πâ‡∏≠‡∏á/, /‡∏¢‡∏≤.*‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î/
    ],
    patient_allergies: [
      /‡πÅ‡∏û‡πâ.*‡∏≠‡∏∞‡πÑ‡∏£/, /‡∏≠‡∏≤‡∏Å‡∏≤‡∏£.*‡πÅ‡∏û‡πâ/, /‡πÅ‡∏û‡πâ.*‡∏¢‡∏≤/, /‡πÅ‡∏û‡πâ.*‡∏≠‡∏≤‡∏´‡∏≤‡∏£/,
      /‡πÅ‡∏û‡πâ/, /‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ/, /‡πÅ‡∏û‡πâ.*‡∏≠‡∏∞‡πÑ‡∏£.*‡∏ö‡πâ‡∏≤‡∏á/, /‡∏°‡∏µ.*‡πÅ‡∏û‡πâ/
    ],
    group_help: [
      /‡∏ñ‡∏≤‡∏°.*‡∏≠‡∏∞‡πÑ‡∏£.*‡πÑ‡∏î‡πâ/, /‡∏ó‡∏≥.*‡∏≠‡∏∞‡πÑ‡∏£.*‡πÑ‡∏î‡πâ/, /‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á/, /‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà.*‡∏ñ‡∏≤‡∏°/, /‡∏ä‡πà‡∏ß‡∏¢.*‡∏≠‡∏∞‡πÑ‡∏£.*‡πÑ‡∏î‡πâ/, /‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ/, /^help$/, /‡πÄ‡∏°‡∏ô‡∏π/,
      /‡πÉ‡∏ä‡πâ.*‡∏á‡∏≤‡∏ô.*‡∏¢‡∏±‡∏á‡πÑ‡∏á/, /‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á.*‡∏≠‡∏∞‡πÑ‡∏£.*‡∏ö‡πâ‡∏≤‡∏á/, /‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡πà‡∏ô/, /feature/, /‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ.*‡∏≠‡∏∞‡πÑ‡∏£/
    ],

    // Switch active patient (for multi-patient groups)
    switch_patient: [
      /^\/switch/, /^switch/, /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/, /‡∏™‡∏•‡∏±‡∏ö.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/, /‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/,
      /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏≠‡∏∑‡πà‡∏ô/, /‡∏î‡∏π‡πÅ‡∏•.*‡∏Ñ‡∏ô.*‡∏≠‡∏∑‡πà‡∏ô/, /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏Ñ‡∏ô/
    ],
    list_patients: [
      /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î/, /‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/, /‡∏°‡∏µ.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏Å‡∏µ‡πà.*‡∏Ñ‡∏ô/, /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°/,
      /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏≠‡∏∞‡πÑ‡∏£.*‡∏ö‡πâ‡∏≤‡∏á/, /‡∏î‡∏π‡πÅ‡∏•.*‡πÉ‡∏Ñ‡∏£.*‡∏ö‡πâ‡∏≤‡∏á/, /‡∏°‡∏µ.*‡∏Å‡∏µ‡πà.*‡∏Ñ‡∏ô/, /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏Å‡∏µ‡πà.*‡∏Ñ‡∏ô/,
      /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏°‡∏µ.*‡πÉ‡∏Ñ‡∏£/, /‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/, /‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠/, /‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠/,
      /^‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î$/, /^‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠$/,
      /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î.*‡∏°‡∏µ/, /‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î.*‡∏°‡∏µ.*‡∏Å‡∏µ‡πà/, /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î.*‡∏Å‡∏µ‡πà/,
      /‡∏Å‡∏µ‡πà.*‡∏Ñ‡∏ô/, /‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/
    ],

    // Set default patient (Phase 4: Smart Default)
    set_default_patient: [
      /^\/setdefault/, /^setdefault/, /‡∏ï‡∏±‡πâ‡∏á.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏´‡∏•‡∏±‡∏Å/, /‡∏ï‡∏±‡πâ‡∏á.*‡∏Ñ‡πà‡∏≤.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/, /‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏´‡∏•‡∏±‡∏Å/,
      /‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏´‡∏•‡∏±‡∏Å/, /default.*patient/, /‡∏ï‡∏±‡πâ‡∏á.*default/, /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏´‡∏•‡∏±‡∏Å/,
      /‡∏î‡∏π‡πÅ‡∏•.*‡∏Ñ‡∏ô.*‡∏ô‡∏µ‡πâ.*‡∏´‡∏•‡∏±‡∏Å/, /‡∏à‡∏≥.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å/
    ],
    remove_default_patient: [
      /^\/removedefault/, /^removedefault/, /‡∏•‡∏ö.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏´‡∏•‡∏±‡∏Å/, /‡∏•‡∏ö.*default/, /‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢.*‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å.*‡∏´‡∏•‡∏±‡∏Å/,
      /‡πÑ‡∏°‡πà.*‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£.*default/, /‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å.*default/
    ],

    // ========================================
    // Profile Edit Intents (Chat-based Editing)
    // ========================================
    edit_profile: [
      /‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç.*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/, /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/,
      /‡πÅ‡∏Å‡πâ.*‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå/, /‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï.*‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/
    ],
    edit_name: [
      /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏ä‡∏∑‡πà‡∏≠/, /‡πÅ‡∏Å‡πâ.*‡∏ä‡∏∑‡πà‡∏≠/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡∏ä‡∏∑‡πà‡∏≠/,
      /‡∏ä‡∏∑‡πà‡∏≠.*‡πÄ‡∏õ‡πá‡∏ô/, /‡∏ä‡∏∑‡πà‡∏≠.*‡πÉ‡∏´‡∏°‡πà/, /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠/
    ],
    edit_weight: [
      /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å/, /‡πÅ‡∏Å‡πâ.*‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å/,
      /‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å.*‡πÄ‡∏õ‡πá‡∏ô/, /‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å.*‡πÉ‡∏´‡∏°‡πà/, /‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å\s*\d+/,
      /‡∏´‡∏ô‡∏±‡∏Å\s*\d+/, /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å.*‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å/, /‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ/
    ],
    edit_height: [
      /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á/, /‡πÅ‡∏Å‡πâ.*‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á/,
      /‡∏™‡∏π‡∏á.*‡πÄ‡∏õ‡πá‡∏ô/, /‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á.*\d+/, /‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á.*\d+/,
      /‡∏™‡∏π‡∏á\s*\d+/, /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å.*‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á/
    ],
    edit_phone: [
      /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡πÄ‡∏ö‡∏≠‡∏£‡πå/, /‡πÅ‡∏Å‡πâ.*‡πÄ‡∏ö‡∏≠‡∏£‡πå/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡πÄ‡∏ö‡∏≠‡∏£‡πå/,
      /‡πÄ‡∏ö‡∏≠‡∏£‡πå.*‡πÉ‡∏´‡∏°‡πà/, /‡πÄ‡∏ö‡∏≠‡∏£‡πå.*‡πÄ‡∏õ‡πá‡∏ô/, /‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£.*‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô/,
      /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå/, /‡πÅ‡∏Å‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå/
    ],
    edit_address: [
      /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà/, /‡πÅ‡∏Å‡πâ.*‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà/,
      /‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà.*‡πÉ‡∏´‡∏°‡πà/, /‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà.*‡πÄ‡∏õ‡πá‡∏ô/, /‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà/
    ],
    edit_blood_type: [
      /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î/, /‡πÅ‡∏Å‡πâ.*‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î/,
      /‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î.*‡πÄ‡∏õ‡πá‡∏ô/, /‡πÄ‡∏•‡∏∑‡∏≠‡∏î.*‡∏Å‡∏£‡∏∏‡πä‡∏õ/, /‡∏Å‡∏£‡∏∏‡πä‡∏õ.*‡πÄ‡∏•‡∏∑‡∏≠‡∏î/
    ],
    edit_medical_condition: [
      /‡πÄ‡∏û‡∏¥‡πà‡∏°.*‡πÇ‡∏£‡∏Ñ/, /‡πÅ‡∏Å‡πâ.*‡πÇ‡∏£‡∏Ñ/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡πÇ‡∏£‡∏Ñ/,
      /‡πÇ‡∏£‡∏Ñ.*‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß.*‡πÄ‡∏õ‡πá‡∏ô/, /‡∏°‡∏µ.*‡πÇ‡∏£‡∏Ñ.*‡πÄ‡∏û‡∏¥‡πà‡∏°/, /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡πÇ‡∏£‡∏Ñ/,
      /‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß.*‡πÉ‡∏´‡∏°‡πà/, /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å.*‡πÇ‡∏£‡∏Ñ/
    ],
    edit_allergies: [
      /‡πÄ‡∏û‡∏¥‡πà‡∏°.*‡πÅ‡∏û‡πâ/, /‡πÅ‡∏Å‡πâ.*‡πÅ‡∏û‡πâ/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡πÅ‡∏û‡πâ/,
      /‡πÅ‡∏û‡πâ.*‡πÄ‡∏û‡∏¥‡πà‡∏°/, /‡πÅ‡∏û‡πâ.*‡∏¢‡∏≤.*‡πÉ‡∏´‡∏°‡πà/, /‡πÅ‡∏û‡πâ.*‡∏≠‡∏≤‡∏´‡∏≤‡∏£.*‡πÉ‡∏´‡∏°‡πà/,
      /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å.*‡πÅ‡∏û‡πâ/, /‡πÄ‡∏û‡∏¥‡πà‡∏°.*‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ/
    ],
    edit_emergency_contact: [
      /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠.*‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô/, /‡πÅ‡∏Å‡πâ.*‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô/,
      /‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠.*‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô.*‡πÄ‡∏õ‡πá‡∏ô/, /‡πÄ‡∏ö‡∏≠‡∏£‡πå.*‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô/,
      /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡πÄ‡∏ö‡∏≠‡∏£‡πå.*‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô/, /‡πÅ‡∏Å‡πâ.*‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠/
    ],

    // ========================================
    // Medication Edit Intents
    // ========================================
    add_medication: [
      /‡πÄ‡∏û‡∏¥‡πà‡∏°.*‡∏¢‡∏≤/, /‡∏¢‡∏≤.*‡πÉ‡∏´‡∏°‡πà/, /‡∏¢‡∏≤.*‡πÄ‡∏û‡∏¥‡πà‡∏°/, /‡∏°‡∏µ.*‡∏¢‡∏≤.*‡πÉ‡∏´‡∏°‡πà/,
      /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å.*‡∏¢‡∏≤.*‡πÉ‡∏´‡∏°‡πà/, /‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤/, /‡∏¢‡∏≤‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà/
    ],
    edit_medication: [
      /‡πÅ‡∏Å‡πâ.*‡∏¢‡∏≤/, /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡∏¢‡∏≤/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡∏¢‡∏≤/,
      /‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç.*‡∏¢‡∏≤/, /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏¢‡∏≤/, /‡∏¢‡∏≤.*‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô/
    ],
    delete_medication: [
      /‡∏•‡∏ö.*‡∏¢‡∏≤/, /‡πÄ‡∏≠‡∏≤.*‡∏¢‡∏≤.*‡∏≠‡∏≠‡∏Å/, /‡πÑ‡∏°‡πà.*‡∏Å‡∏¥‡∏ô.*‡∏¢‡∏≤.*‡πÅ‡∏•‡πâ‡∏ß/, /‡∏´‡∏¢‡∏∏‡∏î.*‡∏¢‡∏≤/,
      /‡∏•‡∏ö‡∏¢‡∏≤/, /‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å.*‡∏¢‡∏≤/, /‡πÄ‡∏•‡∏¥‡∏Å.*‡∏Å‡∏¥‡∏ô.*‡∏¢‡∏≤/
    ],

    // ========================================
    // Reminder Edit Intents
    // ========================================
    add_reminder: [
      /‡πÄ‡∏û‡∏¥‡πà‡∏°.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡∏ï‡∏±‡πâ‡∏á.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô.*‡πÉ‡∏´‡∏°‡πà/,
      /‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡∏™‡∏£‡πâ‡∏≤‡∏á.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/
    ],
    edit_reminder: [
      /‡πÅ‡∏Å‡πâ.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô.*‡πÄ‡∏ß‡∏•‡∏≤.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/,
      /‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/
    ],
    delete_reminder: [
      /‡∏•‡∏ö.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡πÑ‡∏°‡πà.*‡∏ï‡πâ‡∏≠‡∏á.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/,
      /‡∏•‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡∏´‡∏¢‡∏∏‡∏î.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/, /‡πÄ‡∏≠‡∏≤.*‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô.*‡∏≠‡∏≠‡∏Å/
    ]
  };

  constructor(config?: Partial<Config>) {
    super({
      name: 'intent',
      role: 'Classify user messages into intents',
      ...AGENT_MODELS.intent,
      ...config
    });
  }

  async initialize(): Promise<boolean> {
    this.log('info', 'Intent Agent initialized');
    await this.loadState();
    return true;
  }

  async process(message: Message): Promise<Response> {
    const startTime = Date.now();
    
    try {
      // 1. ‡∏•‡∏≠‡∏á pattern matching ‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏ü‡∏£‡∏µ)
      const patternResult = this.matchPattern(message.content);

      // ‡∏•‡∏î threshold ‡∏à‡∏≤‡∏Å 0.7 ‡πÄ‡∏õ‡πá‡∏ô 0.5 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
      if (patternResult.confidence >= 0.5) {
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏û‡∏≠‡∏à‡∏≤‡∏Å pattern ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏¢
        return this.createResponse(
          true,
          patternResult,
          startTime,
          'pattern'
        );
      }

      // 2. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à ‡πÉ‡∏ä‡πâ Claude ‡∏ä‡πà‡∏ß‡∏¢ classify
      const claudeResult = await this.classifyWithClaude(message.content);
      
      return this.createResponse(
        true,
        claudeResult,
        startTime,
        'claude'
      );
      
    } catch (error) {
      this.log('error', 'Intent classification failed', error);
      
      return this.createResponse(
        false,
        { intent: 'unknown', confidence: 0 },
        startTime,
        'error'
      );
    }
  }

  private matchPattern(text: string): { intent: string, confidence: number, entities?: any } {
    const normalized = text.toLowerCase();
    const scores: Record<string, number> = {};

    // Intents that should get high confidence on ANY pattern match
    // These are specific action intents where a single match is definitive
    const highConfidenceIntents = [
      'report', 'report_menu', 'health_log_menu', 'emergency', 'registration',
      'switch_patient', 'list_patients', 'set_default_patient', 'remove_default_patient',
      'group_help', 'help', 'package',
      // Profile edit intents
      'edit_profile', 'edit_name', 'edit_weight', 'edit_height', 'edit_phone',
      'edit_address', 'edit_blood_type', 'edit_medical_condition', 'edit_allergies',
      'edit_emergency_contact',
      // Medication & Reminder edit intents
      'add_medication', 'edit_medication', 'delete_medication',
      'add_reminder', 'edit_reminder', 'delete_reminder'
    ];

    // ‡∏ô‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ intent
    for (const [intent, patterns] of Object.entries(this.patterns)) {
      let matchCount = 0;
      for (const pattern of patterns) {
        if (pattern.test(normalized)) {
          matchCount++;
        }
      }
      if (matchCount > 0) {
        // For high-confidence intents, give 0.9 confidence on ANY match
        // For others, use ratio but with a minimum of 0.6 if at least one pattern matches
        if (highConfidenceIntents.includes(intent)) {
          scores[intent] = 0.9;
        } else {
          // Calculate ratio but ensure minimum 0.6 for any match
          const ratio = matchCount / patterns.length;
          scores[intent] = Math.max(0.6, ratio);
        }
      }
    }

    // ‡∏´‡∏≤ intent ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
    const bestIntent = Object.entries(scores).sort((a, b) => b[1] - a[1])[0];
    
    if (bestIntent) {
      return {
        intent: bestIntent[0],
        confidence: bestIntent[1],
        entities: this.extractEntities(text, bestIntent[0])
      };
    }

    return { intent: 'other', confidence: 0 };
  }

  private async classifyWithClaude(text: string) {
    const systemPrompt = `You are an intent classifier for OONJAI - a Group-Based Care platform where CAREGIVERS manage patient care.

IMPORTANT: Respond with ONLY valid JSON, no other text.

Classify into these intents:

ACTIVITY LOGGING (caregivers log patient activities):
- medication (‡∏¢‡∏≤, ‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≤)
- vitals (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô, ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô, ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô)
- water (‡∏ô‡πâ‡∏≥, ‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡πâ‡∏≥)
- walk (‡πÄ‡∏î‡∏¥‡∏ô, ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô)
- food (‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡∏°‡∏∑‡πâ‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£)

ALERTS:
- emergency (‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô, ‡∏ä‡πà‡∏ß‡∏¢, ‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢, ‡πÄ‡∏à‡πá‡∏ö, ‡∏•‡πâ‡∏°)

REPORTS:
- report (‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô, ‡∏™‡∏£‡∏∏‡∏õ, ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô, ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ, ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)

LIFF PAGES (caregiver wants to open feature):
- view_patient_profile (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å, ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå, ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
- view_medications (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤, ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏≤, ‡∏¢‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
- view_reminders (‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤, ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)
- view_settings (‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤, ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡∏Å‡∏•‡∏∏‡πà‡∏°)

GROUP MANAGEMENT:
- registration (‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô, ‡∏™‡∏°‡∏±‡∏Ñ‡∏£, ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°)
- join_group (‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°, ‡∏•‡∏¥‡∏á‡∏Å‡πå, link code)

SUPPORT:
- package (‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à, ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£, ‡∏£‡∏≤‡∏Ñ‡∏≤, ‡∏ü‡∏£‡∏µ, pro)
- help (‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠, ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ, faq)

PATIENT INFO QUERIES (for group chat):
- patient_info (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å, ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå, ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î, ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
- patient_name (‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å, ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£)
- patient_age (‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà, ‡∏Å‡∏µ‡πà‡∏õ‡∏µ)
- patient_conditions (‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß, ‡πÇ‡∏£‡∏Ñ‡∏≠‡∏∞‡πÑ‡∏£)
- patient_medications (‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô, ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤)
- patient_allergies (‡πÅ‡∏û‡πâ‡∏≠‡∏∞‡πÑ‡∏£, ‡πÅ‡∏û‡πâ‡∏¢‡∏≤, ‡πÅ‡∏û‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£)
- group_help (‡∏ñ‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏î‡πâ, ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á, ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á)

MULTI-PATIENT GROUP (Phase 1-4):
- list_patients (‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å, ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î, ‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏Ñ‡∏ô, ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏Ñ‡∏ô)
- switch_patient (/switch, ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å, ‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å)
- set_default_patient (/setdefault, ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏´‡∏•‡∏±‡∏Å, ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å)
- remove_default_patient (/removedefault, ‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏´‡∏•‡∏±‡∏Å, ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å default)

PROFILE EDITING (Chat-based):
- edit_profile (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
- edit_name (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠, ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠, ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô)
- edit_weight (‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å 65 ‡∏Å‡∏Å., ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å)
- edit_height (‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á 160, ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á)
- edit_phone (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå, ‡πÅ‡∏Å‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà)
- edit_address (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà, ‡πÅ‡∏Å‡πâ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà, ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡∏°‡πà)
- edit_blood_type (‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÄ‡∏õ‡πá‡∏ô, ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î)
- edit_medical_condition (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏£‡∏Ñ, ‡πÅ‡∏Å‡πâ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏£‡∏Ñ)
- edit_allergies (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏û‡πâ, ‡πÅ‡∏û‡πâ‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ)
- edit_emergency_contact (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô)

MEDICATION MANAGEMENT:
- add_medication (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤, ‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà)
- edit_medication (‡πÅ‡∏Å‡πâ‡∏¢‡∏≤, ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏¢‡∏≤, ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏¢‡∏≤)
- delete_medication (‡∏•‡∏ö‡∏¢‡∏≤, ‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤, ‡πÑ‡∏°‡πà‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß)

REMINDER MANAGEMENT:
- add_reminder (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)
- edit_reminder (‡πÅ‡∏Å‡πâ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)
- delete_reminder (‡∏•‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)

OTHER:
- other (‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô)`;

    const userPrompt = `Classify this message: "${text}"

Output JSON only:
{"intent": "...", "confidence": 0.0-1.0, "entities": {...}}`;

    const response = await this.askClaude(userPrompt, systemPrompt);

    try {
      return JSON.parse(response);
    } catch (e) {
      // Fallback ‡∏ñ‡πâ‡∏≤ parse JSON ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
      return { intent: 'other', confidence: 0.5, entities: {} };
    }
  }

  private extractEntities(text: string, intent: string): any {
    const entities: any = {};
    
    // Extract numbers (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô, ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•)
    const numbers = text.match(/\d+/g);
    if (numbers && intent === 'vitals') {
      if (numbers.length >= 2) {
        entities.systolic = parseInt(numbers[0]);
        entities.diastolic = parseInt(numbers[1]);
      }
    }

    // Extract time (‡πÄ‡∏ä‡πâ‡∏≤, ‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô, ‡πÄ‡∏¢‡πá‡∏ô)
    if (text.includes('‡πÄ‡∏ä‡πâ‡∏≤')) entities.time = 'morning';
    if (text.includes('‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô')) entities.time = 'noon';
    if (text.includes('‡πÄ‡∏¢‡πá‡∏ô')) entities.time = 'evening';

    return entities;
  }

  private createResponse(
    success: boolean, 
    data: any, 
    startTime: number,
    method: string
  ): Response {
    return {
      success,
      data: {
        ...data,
        method,
        timestamp: new Date()
      },
      agentName: this.config.name,
      processingTime: Date.now() - startTime,
      metadata: { method }
    };
  }

  getCapabilities(): string[] {
    return [
      'intent-classification',
      'entity-extraction', 
      'pattern-matching',
      'thai-language'
    ];
  }
}