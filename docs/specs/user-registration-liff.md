# User Registration & LIFF App (à¸ à¸²à¸©à¸²à¹„à¸—à¸¢)

> à¸£à¸°à¸šà¸šà¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸œà¹ˆà¸²à¸™ LINE LIFF à¸à¸£à¹‰à¸­à¸¡à¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œà¸ªà¸¸à¸‚à¸ à¸²à¸

---

## Feature Name
à¸£à¸°à¸šà¸šà¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¹à¸¥à¸°à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ (User Registration & Profile Management)

## Overview
à¸£à¸°à¸šà¸šà¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸œà¹ˆà¸²à¸™ LINE LIFF à¸£à¸­à¸‡à¸£à¸±à¸š 2 à¸šà¸—à¸šà¸²à¸—:
1. **à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢/à¸œà¸¹à¹‰à¸ªà¸¹à¸‡à¸­à¸²à¸¢à¸¸** - à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸¸à¸‚à¸ à¸²à¸à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§
2. **à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥/à¸à¸²à¸•à¸´** - à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸šà¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢à¹€à¸à¸·à¹ˆà¸­à¸•à¸´à¸”à¸•à¸²à¸¡à¸”à¸¹à¹à¸¥

à¸£à¸­à¸‡à¸£à¸±à¸šà¸ à¸²à¸©à¸²à¹„à¸—à¸¢à¸—à¸±à¹‰à¸‡à¸£à¸°à¸šà¸š à¸à¸£à¹‰à¸­à¸¡ UI à¸—à¸µà¹ˆà¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸‡à¹ˆà¸²à¸¢à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸ªà¸¹à¸‡à¸­à¸²à¸¢à¸¸

## User Story

### Patient
**As a** à¸œà¸¹à¹‰à¸ªà¸¹à¸‡à¸­à¸²à¸¢à¸¸à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸šà¸”à¸¹à¹à¸¥à¸ªà¸¸à¸‚à¸ à¸²à¸
**I want** à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸‡à¹ˆà¸²à¸¢à¹† à¸œà¹ˆà¸²à¸™ LINE
**So that** à¸£à¸°à¸šà¸šà¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§à¹à¸¥à¸°à¸ªà¸¸à¸‚à¸ à¸²à¸à¸‚à¸­à¸‡à¸œà¸¡

### Caregiver
**As a** à¸à¸²à¸•à¸´à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸œà¸¹à¹‰à¸ªà¸¹à¸‡à¸­à¸²à¸¢à¸¸
**I want** à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¹à¸¥à¸°à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸šà¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢
**So that** à¸•à¸´à¸”à¸•à¸²à¸¡à¹à¸¥à¸°à¸£à¸±à¸šà¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸ªà¸¸à¸‚à¸ à¸²à¸à¸‚à¸­à¸‡à¸„à¸™à¹ƒà¸™à¸„à¸£à¸­à¸šà¸„à¸£à¸±à¸§

## Requirements

### Functional Requirements

#### FR-1: LINE LIFF App
- [ ] FR-1.1: à¹€à¸›à¸´à¸” LIFF App à¸ˆà¸²à¸ Rich Menu à¸«à¸£à¸·à¸­ Flex Message
- [ ] FR-1.2: Auto-login à¸”à¹‰à¸§à¸¢ LINE Account (OAuth)
- [ ] FR-1.3: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™
- [ ] FR-1.4: UI à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ responsive à¸ªà¸³à¸«à¸£à¸±à¸šà¸¡à¸·à¸­à¸–à¸·à¸­
- [ ] FR-1.5: Font à¹ƒà¸«à¸à¹ˆ à¸Šà¸±à¸”à¹€à¸ˆà¸™ à¸­à¹ˆà¸²à¸™à¸‡à¹ˆà¸²à¸¢à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸ªà¸¹à¸‡à¸­à¸²à¸¢à¸¸

#### FR-2: Role Selection (à¹€à¸¥à¸·à¸­à¸à¸šà¸—à¸šà¸²à¸—)
- [ ] FR-2.1: à¹€à¸¥à¸·à¸­à¸à¸šà¸—à¸šà¸²à¸—: "à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢" à¸«à¸£à¸·à¸­ "à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥"
- [ ] FR-2.2: à¸­à¸˜à¸´à¸šà¸²à¸¢à¸„à¸§à¸²à¸¡à¹à¸•à¸à¸•à¹ˆà¸²à¸‡à¸‚à¸­à¸‡à¹à¸•à¹ˆà¸¥à¸°à¸šà¸—à¸šà¸²à¸—
- [ ] FR-2.3: à¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸šà¸—à¸šà¸²à¸—à¹„à¸”à¹‰à¸ à¸²à¸¢à¸«à¸¥à¸±à¸‡ (à¸–à¹‰à¸²à¸à¸£à¸­à¸à¸œà¸´à¸”)

#### FR-3: Patient Profile Setup
- [ ] FR-3.1: à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸·à¹‰à¸™à¸à¸²à¸™
  - à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ (à¸ à¸²à¸©à¸²à¹„à¸—à¸¢)
  - à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™
  - à¸§à¸±à¸™à¹€à¸à¸´à¸” (à¹€à¸¥à¸·à¸­à¸à¸ˆà¸²à¸à¸›à¸à¸´à¸—à¸´à¸™)
  - à¹€à¸à¸¨ (à¸Šà¸²à¸¢/à¸«à¸à¸´à¸‡/à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸)
  - à¸­à¸²à¸¢à¸¸ (à¸„à¸³à¸™à¸§à¸“à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸ˆà¸²à¸à¸§à¸±à¸™à¹€à¸à¸´à¸”)

- [ ] FR-3.2: à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸¸à¸‚à¸ à¸²à¸
  - à¸™à¹‰à¸³à¸«à¸™à¸±à¸ (à¸à¸´à¹‚à¸¥à¸à¸£à¸±à¸¡)
  - à¸ªà¹ˆà¸§à¸™à¸ªà¸¹à¸‡ (à¹€à¸‹à¸™à¸•à¸´à¹€à¸¡à¸•à¸£)
  - à¸à¸£à¸¸à¹Šà¸›à¹€à¸¥à¸·à¸­à¸” (A/B/AB/O, Rh+/-)
  - à¹‚à¸£à¸„à¸›à¸£à¸°à¸ˆà¸³à¸•à¸±à¸§ (à¹€à¸¥à¸·à¸­à¸à¹„à¸”à¹‰à¸«à¸¥à¸²à¸¢à¹‚à¸£à¸„)
    - à¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¹‚à¸¥à¸«à¸´à¸•à¸ªà¸¹à¸‡
    - à¹€à¸šà¸²à¸«à¸§à¸²à¸™
    - à¹‚à¸£à¸„à¸«à¸±à¸§à¹ƒà¸ˆ
    - à¹„à¸‚à¸¡à¸±à¸™à¹ƒà¸™à¹€à¸¥à¸·à¸­à¸”à¸ªà¸¹à¸‡
    - à¹‚à¸£à¸„à¹„à¸•
    - à¸­à¸·à¹ˆà¸™à¹† (à¸£à¸°à¸šà¸¸)
  - à¸à¸²à¸£à¹à¸à¹‰à¸¢à¸² (à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­à¸¢à¸²)
  - à¸à¸²à¸£à¹à¸à¹‰à¸­à¸²à¸«à¸²à¸£ (à¸£à¸°à¸šà¸¸)

- [ ] FR-3.3: à¸¢à¸²à¸—à¸µà¹ˆà¸à¸´à¸™à¸›à¸£à¸°à¸ˆà¸³
  - à¹€à¸à¸´à¹ˆà¸¡à¸£à¸²à¸¢à¸à¸²à¸£à¸¢à¸²à¹„à¸”à¹‰à¸«à¸¥à¸²à¸¢à¸£à¸²à¸¢à¸à¸²à¸£
  - à¸Šà¸·à¹ˆà¸­à¸¢à¸² (à¸ à¸²à¸©à¸²à¹„à¸—à¸¢)
  - à¸‚à¸™à¸²à¸” (à¹€à¸Šà¹ˆà¸™ 500mg)
  - à¹€à¸§à¸¥à¸² (à¹€à¸Šà¹‰à¸²/à¸à¸¥à¸²à¸‡à¸§à¸±à¸™/à¹€à¸¢à¹‡à¸™/à¸à¹ˆà¸­à¸™à¸™à¸­à¸™)
  - à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡à¸à¸´à¸™

- [ ] FR-3.4: à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸´à¸”à¸•à¹ˆà¸­à¸‰à¸¸à¸à¹€à¸‰à¸´à¸™
  - à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (à¹€à¸•à¹‡à¸¡à¸£à¸¹à¸›à¹à¸šà¸š)
  - à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œà¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡
  - à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œà¸à¸²à¸•à¸´ (à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸„à¸™)

#### FR-4: Caregiver Profile Setup
- [ ] FR-4.1: à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§
  - à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥
  - à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸à¸±à¸šà¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢ (à¸¥à¸¹à¸/à¸«à¸¥à¸²à¸™/à¸à¸µà¹ˆà¸™à¹‰à¸­à¸‡/à¹€à¸à¸·à¹ˆà¸­à¸™/à¸„à¸™à¸”à¸¹à¹à¸¥)
  - à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œ

- [ ] FR-4.2: à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š Patient
  - à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ 6 à¸«à¸¥à¸±à¸ (à¸—à¸µà¹ˆ patient à¸ªà¸£à¹‰à¸²à¸‡)
  - à¸«à¸£à¸·à¸­à¸ªà¹à¸à¸™ QR Code
  - à¸ªà¹ˆà¸‡à¸„à¸³à¸‚à¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ (à¸£à¸­ patient à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´)

- [ ] FR-4.3: à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™
  - à¹€à¸¥à¸·à¸­à¸à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸£à¸±à¸š
    - â˜‘ï¸ à¸‰à¸¸à¸à¹€à¸‰à¸´à¸™ (à¸šà¸±à¸‡à¸„à¸±à¸šà¸£à¸±à¸š)
    - â˜ à¸¢à¸²à¸‚à¸²à¸”
    - â˜ à¸£à¸²à¸¢à¸‡à¸²à¸™à¸›à¸£à¸°à¸ˆà¸³à¸§à¸±à¸™
    - â˜ à¸œà¸¥à¸ªà¸¸à¸‚à¸ à¸²à¸à¸œà¸´à¸”à¸›à¸à¸•à¸´

#### FR-5: Health Goals & Settings
- [ ] FR-5.1: à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸ªà¸¸à¸‚à¸ à¸²à¸ (Patient only)
  - à¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢ (systolic/diastolic)
  - à¸™à¹‰à¸³à¸•à¸²à¸¥à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢ (fasting/post-meal)
  - à¸™à¹‰à¸³à¸•à¹ˆà¸­à¸§à¸±à¸™ (à¸¡à¸´à¸¥à¸¥à¸´à¸¥à¸´à¸•à¸£, default 2000ml)
  - à¸­à¸­à¸à¸à¸³à¸¥à¸±à¸‡à¸à¸²à¸¢à¸•à¹ˆà¸­à¸§à¸±à¸™ (à¸™à¸²à¸—à¸µ, default 30 à¸™à¸²à¸—à¸µ)
  - à¸™à¹‰à¸³à¸«à¸™à¸±à¸à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢ (à¸–à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸”/à¹€à¸à¸´à¹ˆà¸¡)

- [ ] FR-5.2: à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸à¸²à¸£à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™
  - à¹€à¸§à¸¥à¸²à¹€à¸•à¸·à¸­à¸™à¸à¸´à¸™à¸¢à¸²
  - à¹€à¸§à¸¥à¸²à¹€à¸•à¸·à¸­à¸™à¸”à¸·à¹ˆà¸¡à¸™à¹‰à¸³ (à¸—à¸¸à¸ X à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡)
  - à¹€à¸§à¸¥à¸²à¹€à¸•à¸·à¸­à¸™à¸­à¸­à¸à¸à¸³à¸¥à¸±à¸‡à¸à¸²à¸¢
  - à¹€à¸§à¸¥à¸²à¸ªà¹ˆà¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™à¸›à¸£à¸°à¸ˆà¸³à¸§à¸±à¸™ (default 20:00)

#### FR-6: Linking & Relationships
- [ ] FR-6.1: Patient à¸ªà¸£à¹‰à¸²à¸‡à¸£à¸«à¸±à¸ªà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­
  - à¸ªà¸£à¹‰à¸²à¸‡à¸£à¸«à¸±à¸ª 6 à¸«à¸¥à¸±à¸ (valid 24 à¸Šà¸¡.)
  - à¸«à¸£à¸·à¸­à¸ªà¸£à¹‰à¸²à¸‡ QR Code
  - à¹à¸Šà¸£à¹Œà¸£à¸«à¸±à¸ªà¹ƒà¸«à¹‰ caregiver

- [ ] FR-6.2: à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸„à¸³à¸‚à¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­
  - Patient à¹€à¸«à¹‡à¸™à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸‚à¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­
  - à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸«à¸£à¸·à¸­à¸›à¸à¸´à¹€à¸ªà¸˜
  - à¸•à¸±à¹‰à¸‡à¸£à¸°à¸”à¸±à¸šà¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥

- [ ] FR-6.3: à¸ˆà¸±à¸”à¸à¸²à¸£à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥
  - à¸”à¸¹à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
  - à¸•à¸±à¹‰à¸‡ primary caregiver
  - à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹„à¸”à¹‰

#### FR-7: Profile Management
- [ ] FR-7.1: à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
  - à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§à¹„à¸”à¹‰à¸—à¸¸à¸à¹€à¸§à¸¥à¸²
  - à¹à¸à¹‰à¹„à¸‚à¸¢à¸²à¸›à¸£à¸°à¸ˆà¸³
  - à¹à¸à¹‰à¹„à¸‚à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸ªà¸¸à¸‚à¸ à¸²à¸

- [ ] FR-7.2: Export à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
  - à¸ªà¹ˆà¸‡à¸­à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸›à¹‡à¸™ PDF
  - à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸ªà¸”à¸‡à¸«à¸¡à¸­

### Technical Requirements
- [ ] TR-1: LINE LIFF SDK v2.x
- [ ] TR-2: React à¸«à¸£à¸·à¸­ Vue.js à¸ªà¸³à¸«à¸£à¸±à¸š frontend
- [ ] TR-3: Responsive design (mobile-first)
- [ ] TR-4: Font à¹ƒà¸«à¸à¹ˆà¸Šà¸±à¸”à¹€à¸ˆà¸™ (min 16px)
- [ ] TR-5: Support Thai language (UTF-8)
- [ ] TR-6: Form validation à¹à¸šà¸š real-time
- [ ] TR-7: Auto-save drafts (localStorage)
- [ ] TR-8: Accessibility (WCAG 2.1 Level AA)

### Non-Functional Requirements
- [ ] NFR-1: LIFF App load time < 3 à¸§à¸´à¸™à¸²à¸—à¸µ
- [ ] NFR-2: Form save time < 1 à¸§à¸´à¸™à¸²à¸—à¸µ
- [ ] NFR-3: à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹„à¸”à¹‰à¸šà¸™à¸¡à¸·à¸­à¸–à¸·à¸­à¸—à¸¸à¸à¸£à¸¸à¹ˆà¸™ (iOS/Android)
- [ ] NFR-4: PDPA compliant (à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§)
- [ ] NFR-5: Encrypted data transmission (HTTPS)

## Implementation Details

### Files to Create
```
liff/
  â”œâ”€â”€ public/
  â”‚   â”œâ”€â”€ index.html
  â”‚   â””â”€â”€ assets/
  â”œâ”€â”€ src/
  â”‚   â”œâ”€â”€ App.tsx (Main LIFF App)
  â”‚   â”œâ”€â”€ pages/
  â”‚   â”‚   â”œâ”€â”€ RoleSelection.tsx
  â”‚   â”‚   â”œâ”€â”€ PatientRegistration.tsx
  â”‚   â”‚   â”œâ”€â”€ CaregiverRegistration.tsx
  â”‚   â”‚   â”œâ”€â”€ ProfileView.tsx
  â”‚   â”‚   â”œâ”€â”€ HealthGoals.tsx
  â”‚   â”‚   â””â”€â”€ LinkPatient.tsx
  â”‚   â”œâ”€â”€ components/
  â”‚   â”‚   â”œâ”€â”€ StepProgress.tsx
  â”‚   â”‚   â”œâ”€â”€ FormInput.tsx
  â”‚   â”‚   â”œâ”€â”€ DatePicker.tsx
  â”‚   â”‚   â””â”€â”€ QRCode.tsx
  â”‚   â””â”€â”€ services/
  â”‚       â”œâ”€â”€ liff.service.ts
  â”‚       â””â”€â”€ api.service.ts
  â””â”€â”€ package.json

src/
  â”œâ”€â”€ routes/
  â”‚   â””â”€â”€ registration.routes.ts (NEW)
  â”œâ”€â”€ services/
  â”‚   â””â”€â”€ user.service.ts (NEW)
  â””â”€â”€ types/
      â””â”€â”€ user.types.ts (NEW)
```

### Files to Modify
- `src/index.ts` - Add registration routes
- `docs/database-schema.sql` - Add user tables

## Data Model

### Database Schema
```sql
-- Users (base table)
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  line_user_id VARCHAR(100) UNIQUE NOT NULL,
  display_name VARCHAR(255),
  picture_url TEXT,
  role VARCHAR(20) CHECK (role IN ('patient', 'caregiver')) NOT NULL,
  language VARCHAR(10) DEFAULT 'th',
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Patient profiles
CREATE TABLE patient_profiles (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) UNIQUE NOT NULL,

  -- à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸·à¹‰à¸™à¸à¸²à¸™
  first_name VARCHAR(100) NOT NULL,
  last_name VARCHAR(100) NOT NULL,
  nickname VARCHAR(50),
  birth_date DATE NOT NULL,
  gender VARCHAR(10) CHECK (gender IN ('male', 'female', 'other')),

  -- à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸¸à¸‚à¸ à¸²à¸
  weight_kg DECIMAL(5,2),
  height_cm DECIMAL(5,2),
  blood_type VARCHAR(5), -- 'A+', 'B-', etc.
  chronic_diseases TEXT[], -- ['hypertension', 'diabetes', ...]
  drug_allergies TEXT[],
  food_allergies TEXT[],

  -- à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸´à¸”à¸•à¹ˆà¸­
  address TEXT,
  phone_number VARCHAR(20),
  emergency_contact_name VARCHAR(100),
  emergency_contact_phone VARCHAR(20),
  emergency_contact_relation VARCHAR(50),

  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Caregiver profiles
CREATE TABLE caregiver_profiles (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) UNIQUE NOT NULL,

  first_name VARCHAR(100) NOT NULL,
  last_name VARCHAR(100) NOT NULL,
  phone_number VARCHAR(20),

  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Patient-Caregiver relationships
CREATE TABLE patient_caregivers (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  patient_id UUID REFERENCES patient_profiles(id) NOT NULL,
  caregiver_id UUID REFERENCES caregiver_profiles(id) NOT NULL,

  relationship VARCHAR(50), -- 'child', 'grandchild', 'sibling', 'caregiver'
  is_primary BOOLEAN DEFAULT FALSE,
  access_level VARCHAR(20) DEFAULT 'full', -- 'full', 'limited'

  -- Notification settings
  notify_emergency BOOLEAN DEFAULT TRUE,
  notify_medication BOOLEAN DEFAULT TRUE,
  notify_daily_report BOOLEAN DEFAULT TRUE,
  notify_abnormal_vitals BOOLEAN DEFAULT TRUE,

  status VARCHAR(20) CHECK (status IN ('pending', 'active', 'rejected')) DEFAULT 'pending',
  approved_at TIMESTAMP,

  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),

  UNIQUE(patient_id, caregiver_id)
);

-- Link codes (for patient-caregiver linking)
CREATE TABLE link_codes (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  patient_id UUID REFERENCES patient_profiles(id) NOT NULL,
  code VARCHAR(6) UNIQUE NOT NULL,
  expires_at TIMESTAMP NOT NULL,
  used BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Medications (patient's current medications)
CREATE TABLE patient_medications (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  patient_id UUID REFERENCES patient_profiles(id) NOT NULL,

  name VARCHAR(255) NOT NULL,
  dosage VARCHAR(100), -- '500mg', '1 à¹€à¸¡à¹‡à¸”'
  frequency TEXT[], -- ['morning', 'evening']
  started_at DATE,
  notes TEXT,

  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Health goals
CREATE TABLE health_goals (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  patient_id UUID REFERENCES patient_profiles(id) UNIQUE NOT NULL,

  -- à¸„à¸§à¸²à¸¡à¸”à¸±à¸™
  target_bp_systolic INTEGER DEFAULT 120,
  target_bp_diastolic INTEGER DEFAULT 80,

  -- à¸™à¹‰à¸³à¸•à¸²à¸¥
  target_blood_sugar_fasting INTEGER DEFAULT 100,
  target_blood_sugar_post_meal INTEGER DEFAULT 140,

  -- à¸™à¹‰à¸³
  target_water_ml INTEGER DEFAULT 2000,

  -- à¸­à¸­à¸à¸à¸³à¸¥à¸±à¸‡à¸à¸²à¸¢
  target_exercise_minutes INTEGER DEFAULT 30,
  target_exercise_days_per_week INTEGER DEFAULT 5,

  -- à¸™à¹‰à¸³à¸«à¸™à¸±à¸
  target_weight_kg DECIMAL(5,2),

  updated_at TIMESTAMP DEFAULT NOW()
);

-- Notification settings
CREATE TABLE notification_settings (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  patient_id UUID REFERENCES patient_profiles(id) UNIQUE NOT NULL,

  -- à¹€à¸§à¸¥à¸²à¹€à¸•à¸·à¸­à¸™
  medication_reminder_times TIME[],
  water_reminder_interval_hours INTEGER DEFAULT 2,
  water_reminder_start TIME DEFAULT '07:00',
  water_reminder_end TIME DEFAULT '21:00',
  exercise_reminder_time TIME DEFAULT '08:00',
  daily_report_time TIME DEFAULT '20:00',

  -- à¹€à¸›à¸´à¸”/à¸›à¸´à¸”
  medication_reminders_enabled BOOLEAN DEFAULT TRUE,
  water_reminders_enabled BOOLEAN DEFAULT TRUE,
  exercise_reminders_enabled BOOLEAN DEFAULT TRUE,
  daily_reports_enabled BOOLEAN DEFAULT TRUE,

  updated_at TIMESTAMP DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_users_line_id ON users(line_user_id);
CREATE INDEX idx_patient_user ON patient_profiles(user_id);
CREATE INDEX idx_caregiver_user ON caregiver_profiles(user_id);
CREATE INDEX idx_patient_caregivers_patient ON patient_caregivers(patient_id);
CREATE INDEX idx_patient_caregivers_caregiver ON patient_caregivers(caregiver_id);
CREATE INDEX idx_link_codes_code ON link_codes(code) WHERE NOT used AND expires_at > NOW();
```

### TypeScript Types
```typescript
// User base
interface User {
  id: string;
  lineUserId: string;
  displayName: string;
  pictureUrl?: string;
  role: 'patient' | 'caregiver';
  language: 'th' | 'en';
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

// Patient profile
interface PatientProfile {
  id: string;
  userId: string;

  // Basic info
  firstName: string;
  lastName: string;
  nickname?: string;
  birthDate: Date;
  gender: 'male' | 'female' | 'other';
  age?: number; // calculated

  // Health info
  weightKg?: number;
  heightCm?: number;
  bmi?: number; // calculated
  bloodType?: string;
  chronicDiseases: string[];
  drugAllergies: string[];
  foodAllergies: string[];

  // Contact
  address?: string;
  phoneNumber?: string;
  emergencyContactName?: string;
  emergencyContactPhone?: string;
  emergencyContactRelation?: string;

  createdAt: Date;
  updatedAt: Date;
}

// Caregiver profile
interface CaregiverProfile {
  id: string;
  userId: string;
  firstName: string;
  lastName: string;
  phoneNumber?: string;
  createdAt: Date;
  updatedAt: Date;
}

// Relationship
interface PatientCaregiver {
  id: string;
  patientId: string;
  caregiverId: string;
  relationship: 'child' | 'grandchild' | 'sibling' | 'friend' | 'caregiver';
  isPrimary: boolean;
  accessLevel: 'full' | 'limited';

  // Notifications
  notifyEmergency: boolean;
  notifyMedication: boolean;
  notifyDailyReport: boolean;
  notifyAbnormalVitals: boolean;

  status: 'pending' | 'active' | 'rejected';
  approvedAt?: Date;
  createdAt: Date;
  updatedAt: Date;
}

// Link code
interface LinkCode {
  id: string;
  patientId: string;
  code: string; // 6 digits
  expiresAt: Date;
  used: boolean;
  createdAt: Date;
}

// Patient medication
interface PatientMedication {
  id: string;
  patientId: string;
  name: string;
  dosage: string;
  frequency: ('morning' | 'afternoon' | 'evening' | 'bedtime')[];
  startedAt: Date;
  notes?: string;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

// Health goals
interface HealthGoals {
  id: string;
  patientId: string;

  targetBpSystolic: number;
  targetBpDiastolic: number;
  targetBloodSugarFasting: number;
  targetBloodSugarPostMeal: number;
  targetWaterMl: number;
  targetExerciseMinutes: number;
  targetExerciseDaysPerWeek: number;
  targetWeightKg?: number;

  updatedAt: Date;
}

// Notification settings
interface NotificationSettings {
  id: string;
  patientId: string;

  medicationReminderTimes: string[]; // ['08:00', '20:00']
  waterReminderIntervalHours: number;
  waterReminderStart: string; // '07:00'
  waterReminderEnd: string; // '21:00'
  exerciseReminderTime: string;
  dailyReportTime: string;

  medicationRemindersEnabled: boolean;
  waterRemindersEnabled: boolean;
  exerciseRemindersEnabled: boolean;
  dailyReportsEnabled: boolean;

  updatedAt: Date;
}

// Registration forms
interface PatientRegistrationForm {
  // Basic
  firstName: string;
  lastName: string;
  nickname?: string;
  birthDate: string;
  gender: 'male' | 'female' | 'other';

  // Health
  weightKg?: number;
  heightCm?: number;
  bloodType?: string;
  chronicDiseases: string[];
  drugAllergies?: string[];
  foodAllergies?: string[];

  // Medications
  medications: {
    name: string;
    dosage: string;
    frequency: string[];
  }[];

  // Contact
  address?: string;
  phoneNumber?: string;
  emergencyContactName: string;
  emergencyContactPhone: string;
  emergencyContactRelation: string;

  // Goals (optional, use defaults)
  healthGoals?: Partial<HealthGoals>;
}

interface CaregiverRegistrationForm {
  firstName: string;
  lastName: string;
  phoneNumber?: string;
  linkCode?: string; // à¸£à¸«à¸±à¸ªà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸ˆà¸²à¸ patient
}
```

## API Design

### Registration Endpoints
```typescript
// Check if user exists
POST /api/registration/check
Body: { lineUserId: string }
Response: {
  exists: boolean;
  role?: 'patient' | 'caregiver';
  profile?: PatientProfile | CaregiverProfile;
}

// Register as patient
POST /api/registration/patient
Body: PatientRegistrationForm
Response: {
  success: boolean;
  user: User;
  profile: PatientProfile;
  linkCode: string; // 6-digit code
}

// Register as caregiver
POST /api/registration/caregiver
Body: CaregiverRegistrationForm
Response: {
  success: boolean;
  user: User;
  profile: CaregiverProfile;
  linkedPatients?: PatientProfile[];
}

// Generate link code (patient)
POST /api/registration/generate-link-code
Body: { patientId: string }
Response: {
  code: string;
  qrCode: string; // base64 QR code image
  expiresAt: Date;
}

// Link to patient (caregiver)
POST /api/registration/link-patient
Body: {
  caregiverId: string;
  linkCode: string;
}
Response: {
  success: boolean;
  relationship: PatientCaregiver;
  patient: PatientProfile;
}

// Approve/reject caregiver link (patient)
POST /api/registration/approve-caregiver
Body: {
  relationshipId: string;
  approved: boolean;
}
Response: {
  success: boolean;
  relationship: PatientCaregiver;
}

// Update profile
PUT /api/profile/patient/:id
Body: Partial<PatientProfile>
Response: {
  success: boolean;
  profile: PatientProfile;
}

PUT /api/profile/caregiver/:id
Body: Partial<CaregiverProfile>
Response: {
  success: boolean;
  profile: CaregiverProfile;
}

// Health goals
GET /api/health-goals/:patientId
Response: HealthGoals

PUT /api/health-goals/:patientId
Body: Partial<HealthGoals>
Response: HealthGoals

// Notification settings
GET /api/notification-settings/:patientId
Response: NotificationSettings

PUT /api/notification-settings/:patientId
Body: Partial<NotificationSettings>
Response: NotificationSettings
```

## LIFF App UI/UX

### Color Scheme (à¸œà¸¹à¹‰à¸ªà¸¹à¸‡à¸­à¸²à¸¢à¸¸-friendly)
```css
:root {
  --primary: #4CAF50; /* à¹€à¸‚à¸µà¸¢à¸§ - à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ */
  --danger: #F44336; /* à¹à¸”à¸‡ - à¸­à¸±à¸™à¸•à¸£à¸²à¸¢ */
  --warning: #FF9800; /* à¸ªà¹‰à¸¡ - à¸„à¸³à¹€à¸•à¸·à¸­à¸™ */
  --info: #2196F3; /* à¸Ÿà¹‰à¸² - à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ */
  --text: #212121; /* à¸”à¸³ - à¸­à¹ˆà¸²à¸™à¸‡à¹ˆà¸²à¸¢ */
  --background: #FAFAFA;

  --font-size-base: 18px; /* à¹ƒà¸«à¸à¹ˆà¸à¸§à¹ˆà¸²à¸›à¸à¸•à¸´ */
  --font-size-large: 24px;
  --button-height: 56px; /* à¸ªà¸¹à¸‡à¸à¸§à¹ˆà¸²à¸›à¸à¸•à¸´ - à¸à¸”à¸‡à¹ˆà¸²à¸¢ */
}
```

### Registration Flow (Patient)

#### Step 1: Welcome & Role Selection
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸ªà¸¹à¹ˆ Duulair  â”‚
â”‚                         â”‚
â”‚  [à¸£à¸¹à¸› Logo]             â”‚
â”‚                         â”‚
â”‚  à¸„à¸¸à¸“à¹€à¸›à¹‡à¸™à¹ƒà¸„à¸£?             â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ‘¤ à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢        â”‚  â”‚
â”‚  â”‚  (à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸šà¸šà¸±à¸™à¸—à¸¶à¸    â”‚  â”‚
â”‚  â”‚   à¸ªà¸¸à¸‚à¸ à¸²à¸à¸•à¸±à¸§à¹€à¸­à¸‡)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ‘¨â€âš•ï¸ à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥       â”‚  â”‚
â”‚  â”‚  (à¸•à¸´à¸”à¸•à¸²à¸¡à¸”à¸¹à¹à¸¥      â”‚  â”‚
â”‚  â”‚   à¸„à¸™à¹ƒà¸™à¸„à¸£à¸­à¸šà¸„à¸£à¸±à¸§)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 2: Patient Basic Info
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸·à¹‰à¸™à¸à¸²à¸™        â”‚
â”‚  à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ 1/4            â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘               â”‚
â”‚                         â”‚
â”‚  à¸Šà¸·à¹ˆà¸­ *                 â”‚
â”‚  [à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­]             â”‚
â”‚                         â”‚
â”‚  à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ *              â”‚
â”‚  [à¸à¸£à¸­à¸à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥]          â”‚
â”‚                         â”‚
â”‚  à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™               â”‚
â”‚  [à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™]         â”‚
â”‚                         â”‚
â”‚  à¸§à¸±à¸™à¹€à¸à¸´à¸” *              â”‚
â”‚  [à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¹€à¸à¸´à¸” ğŸ“…]      â”‚
â”‚  (à¸­à¸²à¸¢à¸¸: 65 à¸›à¸µ)          â”‚
â”‚                         â”‚
â”‚  à¹€à¸à¸¨ *                  â”‚
â”‚  âšª à¸Šà¸²à¸¢ âšª à¸«à¸à¸´à¸‡ âšª à¸­à¸·à¹ˆà¸™à¹† â”‚
â”‚                         â”‚
â”‚  [à¸–à¸±à¸”à¹„à¸› â†’]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 3: Health Info
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¥ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸¸à¸‚à¸ à¸²à¸         â”‚
â”‚  à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ 2/4            â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘             â”‚
â”‚                         â”‚
â”‚  à¸™à¹‰à¸³à¸«à¸™à¸±à¸ (à¸à¸.)          â”‚
â”‚  [65] à¸à¸´à¹‚à¸¥à¸à¸£à¸±à¸¡          â”‚
â”‚                         â”‚
â”‚  à¸ªà¹ˆà¸§à¸™à¸ªà¸¹à¸‡ (à¸‹à¸¡.)          â”‚
â”‚  [165] à¹€à¸‹à¸™à¸•à¸´à¹€à¸¡à¸•à¸£        â”‚
â”‚  BMI: 23.9 (à¸›à¸à¸•à¸´ âœ“)    â”‚
â”‚                         â”‚
â”‚  à¸à¸£à¸¸à¹Šà¸›à¹€à¸¥à¸·à¸­à¸”              â”‚
â”‚  [à¹€à¸¥à¸·à¸­à¸ â–¼] A+ B+ AB+ O+ â”‚
â”‚                         â”‚
â”‚  à¹‚à¸£à¸„à¸›à¸£à¸°à¸ˆà¸³à¸•à¸±à¸§ (à¹€à¸¥à¸·à¸­à¸à¹„à¸”à¹‰à¸«à¸¥à¸²à¸¢à¹‚à¸£à¸„) â”‚
â”‚  â˜‘ï¸ à¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¹‚à¸¥à¸«à¸´à¸•à¸ªà¸¹à¸‡      â”‚
â”‚  â˜‘ï¸ à¹€à¸šà¸²à¸«à¸§à¸²à¸™             â”‚
â”‚  â˜ à¹‚à¸£à¸„à¸«à¸±à¸§à¹ƒà¸ˆ             â”‚
â”‚  â˜ à¹„à¸‚à¸¡à¸±à¸™à¹ƒà¸™à¹€à¸¥à¸·à¸­à¸”à¸ªà¸¹à¸‡      â”‚
â”‚  â˜ à¹‚à¸£à¸„à¹„à¸•               â”‚
â”‚                         â”‚
â”‚  [â† à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²]  [à¸–à¸±à¸”à¹„à¸› â†’] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 4: Medications & Allergies
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’Š à¸¢à¸²à¹à¸¥à¸°à¸à¸²à¸£à¹à¸à¹‰          â”‚
â”‚  à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ 3/4            â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘          â”‚
â”‚                         â”‚
â”‚  à¸¢à¸²à¸—à¸µà¹ˆà¸à¸´à¸™à¸›à¸£à¸°à¸ˆà¸³          â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Metformin 500mg â”‚    â”‚
â”‚  â”‚ à¹€à¸Šà¹‰à¸², à¹€à¸¢à¹‡à¸™      â”‚    â”‚
â”‚  â”‚ [à¹à¸à¹‰à¹„à¸‚] [à¸¥à¸š]   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚  [+ à¹€à¸à¸´à¹ˆà¸¡à¸¢à¸²]            â”‚
â”‚                         â”‚
â”‚  à¹à¸à¹‰à¸¢à¸² (à¸–à¹‰à¸²à¸¡à¸µ)          â”‚
â”‚  [à¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­à¸¢à¸²à¸—à¸µà¹ˆà¹à¸à¹‰]     â”‚
â”‚                         â”‚
â”‚  à¹à¸à¹‰à¸­à¸²à¸«à¸²à¸£ (à¸–à¹‰à¸²à¸¡à¸µ)       â”‚
â”‚  [à¸£à¸°à¸šà¸¸à¸­à¸²à¸«à¸²à¸£à¸—à¸µà¹ˆà¹à¸à¹‰]      â”‚
â”‚                         â”‚
â”‚  [â† à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²]  [à¸–à¸±à¸”à¹„à¸› â†’] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 5: Emergency Contact
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸš¨ à¸•à¸´à¸”à¸•à¹ˆà¸­à¸‰à¸¸à¸à¹€à¸‰à¸´à¸™        â”‚
â”‚  à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ 4/4            â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       â”‚
â”‚                         â”‚
â”‚  à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ *       â”‚
â”‚  [123 à¸–.à¸ªà¸¸à¸‚à¸¸à¸¡à¸§à¸´à¸—        â”‚
â”‚   à¹à¸‚à¸§à¸‡à¸„à¸¥à¸­à¸‡à¹€à¸•à¸¢          â”‚
â”‚   à¹€à¸‚à¸•à¸„à¸¥à¸­à¸‡à¹€à¸•à¸¢ à¸à¸—à¸¡.      â”‚
â”‚   10110]               â”‚
â”‚                         â”‚
â”‚  à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸‚à¸­à¸‡à¸„à¸¸à¸“         â”‚
â”‚  [081-234-5678]        â”‚
â”‚                         â”‚
â”‚  à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­à¸‰à¸¸à¸à¹€à¸‰à¸´à¸™ *      â”‚
â”‚  à¸Šà¸·à¹ˆà¸­: [à¸ªà¸¡à¸Šà¸²à¸¢]         â”‚
â”‚  à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ: [à¸¥à¸¹à¸]   â”‚
â”‚  à¹€à¸šà¸­à¸£à¹Œ: [082-345-6789] â”‚
â”‚                         â”‚
â”‚  [â† à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²]  [à¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸´à¹‰à¸™ âœ“] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 6: Success & Link Code
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‰ à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!     â”‚
â”‚                         â”‚
â”‚  à¸ªà¸§à¸±à¸ªà¸”à¸µ à¸„à¸¸à¸“à¸ªà¸¡à¸¨à¸£à¸µ ğŸ‘‹     â”‚
â”‚                         â”‚
â”‚  à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸  â”‚
â”‚  à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§          â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ à¸£à¸«à¸±à¸ªà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­:   â”‚    â”‚
â”‚  â”‚  2 4 6 8 9 1    â”‚    â”‚
â”‚  â”‚                 â”‚    â”‚
â”‚  â”‚  [QR Code]      â”‚    â”‚
â”‚  â”‚                 â”‚    â”‚
â”‚  â”‚ à¹à¸Šà¸£à¹Œà¸£à¸«à¸±à¸ªà¸™à¸µà¹‰à¹ƒà¸«à¹‰   â”‚    â”‚
â”‚  â”‚ à¸à¸²à¸•à¸´à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥      â”‚    â”‚
â”‚  â”‚ (à¹ƒà¸Šà¹‰à¹„à¸”à¹‰ 24 à¸Šà¸¡.) â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚  [à¹à¸Šà¸£à¹Œà¸£à¸«à¸±à¸ª ğŸ“¤]         â”‚
â”‚  [à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ â†’]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Registration Flow (Caregiver)

#### Step 1: Caregiver Info
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¨â€âš•ï¸ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥       â”‚
â”‚                         â”‚
â”‚  à¸Šà¸·à¹ˆà¸­ *                 â”‚
â”‚  [à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­]             â”‚
â”‚                         â”‚
â”‚  à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ *              â”‚
â”‚  [à¸à¸£à¸­à¸à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥]          â”‚
â”‚                         â”‚
â”‚  à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£               â”‚
â”‚  [081-xxx-xxxx]        â”‚
â”‚                         â”‚
â”‚  [à¸–à¸±à¸”à¹„à¸› â†’]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 2: Link to Patient
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”— à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸šà¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢   â”‚
â”‚                         â”‚
â”‚  à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­       â”‚
â”‚  6 à¸«à¸¥à¸±à¸à¸ˆà¸²à¸à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢       â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”‚
â”‚  â”‚ 2 â”‚ 4 â”‚ 6 â”‚ 8 â”‚ 9 â”‚ 1 â”‚ â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â”‚
â”‚                         â”‚
â”‚  à¸«à¸£à¸·à¸­                   â”‚
â”‚                         â”‚
â”‚  [ğŸ“· à¸ªà¹à¸à¸™ QR Code]      â”‚
â”‚                         â”‚
â”‚  [à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸£à¸«à¸±à¸ª]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 3: Confirm Relationship
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­    â”‚
â”‚                         â”‚
â”‚  à¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢:        â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ‘¤ à¸„à¸¸à¸“à¸ªà¸¡à¸¨à¸£à¸µ      â”‚    â”‚
â”‚  â”‚    (65 à¸›à¸µ)       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚  à¸„à¸¸à¸“à¸„à¸·à¸­?               â”‚
â”‚  âšª à¸¥à¸¹à¸                 â”‚
â”‚  âšª à¸«à¸¥à¸²à¸™                â”‚
â”‚  âšª à¸à¸µà¹ˆà¸™à¹‰à¸­à¸‡              â”‚
â”‚  âšª à¸„à¸™à¸”à¸¹à¹à¸¥              â”‚
â”‚  âšª à¹€à¸à¸·à¹ˆà¸­à¸™              â”‚
â”‚                         â”‚
â”‚  [à¸¢à¸à¹€à¸¥à¸´à¸] [à¸ªà¹ˆà¸‡à¸„à¸³à¸‚à¸­ âœ“]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Step 4: Wait for Approval
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â³ à¸£à¸­à¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´         â”‚
â”‚                         â”‚
â”‚  à¸ªà¹ˆà¸‡à¸„à¸³à¸‚à¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­       â”‚
â”‚  à¹„à¸›à¸¢à¸±à¸‡ à¸„à¸¸à¸“à¸ªà¸¡à¸¨à¸£à¸µ à¹à¸¥à¹‰à¸§    â”‚
â”‚                         â”‚
â”‚  à¸à¸£à¸¸à¸“à¸²à¸£à¸­à¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´      â”‚
â”‚  à¸ˆà¸²à¸à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢             â”‚
â”‚                         â”‚
â”‚  [à¸£à¸­...]               â”‚
â”‚                         â”‚
â”‚  (à¸ˆà¸°à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™à¹€à¸¡à¸·à¹ˆà¸­      â”‚
â”‚   à¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Testing Strategy

### Unit Tests
- Form validation
- Date calculations (age from birthDate)
- BMI calculation
- Link code generation (6 digits)
- QR code generation

### Integration Tests
- LIFF login flow
- Registration complete flow (patient)
- Registration complete flow (caregiver)
- Patient-caregiver linking
- Approval/rejection flow

### E2E Tests
1. **Patient Registration Flow**
   - à¹€à¸›à¸´à¸” LIFF
   - à¹€à¸¥à¸·à¸­à¸ "à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢"
   - à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸¸à¸à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™
   - à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ
   - à¹„à¸”à¹‰à¸£à¸«à¸±à¸ªà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­

2. **Caregiver Registration & Link**
   - à¹€à¸›à¸´à¸” LIFF
   - à¹€à¸¥à¸·à¸­à¸ "à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥"
   - à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
   - à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­
   - à¸ªà¹ˆà¸‡à¸„à¸³à¸‚à¸­
   - Patient à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´
   - à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸ªà¸³à¹€à¸£à¹‡à¸ˆ

3. **Profile Update**
   - à¹€à¸›à¸´à¸” profile
   - à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
   - à¸šà¸±à¸™à¸—à¸¶à¸
   - à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸±à¸à¹€à¸”à¸—

### Accessibility Tests
- Screen reader à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹„à¸”à¹‰
- Keyboard navigation
- High contrast mode
- Font scaling (200%)

## Timeline

**Estimated Effort**: 24 hours (3 days)

**Breakdown**:
- Database schema: 2 hours
- Backend APIs: 8 hours
- LIFF Frontend: 12 hours
- Testing: 2 hours

**With Auto-Dev**: ~3-5 hours (setup LIFF + review + test)

## Examples

### API Request/Response

#### Register Patient
```typescript
// Request
POST /api/registration/patient
{
  "firstName": "à¸ªà¸¡à¸¨à¸£à¸µ",
  "lastName": "à¹ƒà¸ˆà¸”à¸µ",
  "nickname": "à¸¨à¸£à¸µ",
  "birthDate": "1959-03-15",
  "gender": "female",
  "weightKg": 65,
  "heightCm": 155,
  "bloodType": "A+",
  "chronicDiseases": ["hypertension", "diabetes"],
  "drugAllergies": ["Penicillin"],
  "medications": [
    {
      "name": "Metformin",
      "dosage": "500mg",
      "frequency": ["morning", "evening"]
    }
  ],
  "address": "123 à¸–.à¸ªà¸¸à¸‚à¸¸à¸¡à¸§à¸´à¸— à¹à¸‚à¸§à¸‡à¸„à¸¥à¸­à¸‡à¹€à¸•à¸¢ à¹€à¸‚à¸•à¸„à¸¥à¸­à¸‡à¹€à¸•à¸¢ à¸à¸—à¸¡. 10110",
  "phoneNumber": "081-234-5678",
  "emergencyContactName": "à¸ªà¸¡à¸Šà¸²à¸¢ à¹ƒà¸ˆà¸”à¸µ",
  "emergencyContactPhone": "082-345-6789",
  "emergencyContactRelation": "à¸¥à¸¹à¸"
}

// Response
{
  "success": true,
  "user": {
    "id": "uuid-123",
    "lineUserId": "U1234567890",
    "role": "patient",
    ...
  },
  "profile": {
    "id": "uuid-456",
    "firstName": "à¸ªà¸¡à¸¨à¸£à¸µ",
    "lastName": "à¹ƒà¸ˆà¸”à¸µ",
    "age": 65,
    "bmi": 27.1,
    ...
  },
  "linkCode": "246891",
  "qrCode": "data:image/png;base64,..."
}
```

## Security Considerations

### Data Protection
- âœ… HTTPS only
- âœ… JWT authentication
- âœ… Rate limiting on APIs
- âœ… Input sanitization
- âœ… PDPA consent checkbox

### Privacy
- âœ… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸¸à¸‚à¸ à¸²à¸à¹€à¸‚à¹‰à¸²à¸£à¸«à¸±à¸ª (encrypted at rest)
- âœ… Access control (caregivers à¹€à¸«à¹‡à¸™à¹€à¸‰à¸à¸²à¸°à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´)
- âœ… Audit logs à¸—à¸¸à¸à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
- âœ… à¸ªà¸´à¸—à¸˜à¸´à¹Œà¸¥à¸šà¸šà¸±à¸à¸Šà¸µ (right to be forgotten)

### Link Code Security
- âœ… Random 6-digit code
- âœ… Expires à¹ƒà¸™ 24 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡
- âœ… One-time use
- âœ… Requires patient approval

---

**Created**: 2024-01-16
**Priority**: CRITICAL (Phase 0.5 - à¸•à¹‰à¸­à¸‡à¸—à¸³à¸à¹ˆà¸­à¸™ features à¸­à¸·à¹ˆà¸™)
**Language**: Thai-first (à¸£à¸­à¸‡à¸£à¸±à¸šà¸ à¸²à¸©à¸²à¹„à¸—à¸¢à¸—à¸¸à¸ UI/field)
**Status**: Ready for implementation
**Note**: à¸•à¹‰à¸­à¸‡à¸—à¸³à¸à¹ˆà¸­à¸™à¸—à¸¸à¸ feature à¹€à¸à¸£à¸²à¸°à¸•à¹‰à¸­à¸‡à¸¡à¸µ patient profile
