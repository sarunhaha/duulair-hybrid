# Daily Health Report

> Automated daily and weekly health summary reports

---

## Feature Name
Automated Health Report Generation

## Overview
‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‡∏û‡∏£‡πâ‡∏≠‡∏° insights ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å AI

## User Story
**As a** ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏
**I want** ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
**So that** ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á

## Requirements

### Functional Requirements
- [ ] FR-1: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏™‡πà‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 20:00 ‡∏ô.)
- [ ] FR-2: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (‡∏™‡πà‡∏á‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå)
- [ ] FR-3: ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô, ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•, ‡∏¢‡∏≤, ‡∏ô‡πâ‡∏≥, ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢
- [ ] FR-4: Completion rate ‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ
- [ ] FR-5: Trends ‡πÅ‡∏•‡∏∞ insights ‡∏à‡∏≤‡∏Å AI
- [ ] FR-6: Recommendations ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
- [ ] FR-7: Alerts ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥
- [ ] FR-8: Export ‡πÄ‡∏õ‡πá‡∏ô PDF ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏≠
- [ ] FR-9: Compare ‡∏Å‡∏±‡∏ö‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
- [ ] FR-10: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Health Score (0-100)

### Technical Requirements
- [ ] TR-1: Supabase Cron ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö scheduled reports
- [ ] TR-2: Claude API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI insights
- [ ] TR-3: PDF generation library
- [ ] TR-4: Data aggregation ‡πÅ‡∏•‡∏∞ analytics

## Data Model

### TypeScript Types
```typescript
interface DailyReport {
  id: string;
  patientId: string;
  reportDate: Date;

  // Vital signs
  bloodPressure: {
    readings: number;
    average: { systolic: number; diastolic: number };
    status: 'normal' | 'elevated' | 'high';
  };

  bloodSugar: {
    readings: number;
    average: number;
    status: 'normal' | 'pre_diabetic' | 'diabetic';
  };

  // Activities
  medications: {
    scheduled: number;
    taken: number;
    missed: number;
    adherenceRate: number;
  };

  waterIntake: {
    total: number;
    goal: number;
    percentage: number;
  };

  exercise: {
    minutes: number;
    calories: number;
    goalMet: boolean;
  };

  // Overall
  completionRate: number; // percentage of all tasks completed
  healthScore: number; // 0-100

  // AI Insights
  insights: string[];
  recommendations: string[];
  alerts: Alert[];

  trend: {
    vsYesterday: number; // percentage change
    vsLastWeek: number;
    direction: 'improving' | 'stable' | 'declining';
  };

  createdAt: Date;
}

interface WeeklyReport {
  id: string;
  patientId: string;
  weekStartDate: Date;
  weekEndDate: Date;

  summary: {
    daysActive: number;
    medicationAdherence: number;
    exerciseDays: number;
    averageHealthScore: number;
  };

  vitals: {
    bloodPressureTrend: 'improving' | 'stable' | 'worsening';
    bloodSugarTrend: 'improving' | 'stable' | 'worsening';
  };

  achievements: Achievement[];
  concerns: Concern[];

  aiSummary: string;
  recommendations: string[];

  createdAt: Date;
}

interface HealthScore {
  total: number; // 0-100
  breakdown: {
    vitals: number; // 30 points
    medications: number; // 30 points
    activities: number; // 20 points (water, exercise)
    consistency: number; // 20 points (daily logging)
  };
}
```

## API Design

```typescript
class ReportAgent extends BaseAgent {
  /**
   * Generate daily report
   */
  async generateDailyReport(
    patientId: string,
    date: Date = new Date()
  ): Promise<DailyReport>

  /**
   * Generate weekly report
   */
  async generateWeeklyReport(
    patientId: string,
    weekStartDate: Date
  ): Promise<WeeklyReport>

  /**
   * Calculate health score
   */
  async calculateHealthScore(
    patientId: string,
    date: Date
  ): Promise<HealthScore>

  /**
   * Generate AI insights
   */
  private async generateInsights(data: {
    vitals: any;
    activities: any;
    history: any;
  }): Promise<string[]>

  /**
   * Export report as PDF
   */
  async exportToPDF(reportId: string): Promise<Buffer>

  /**
   * Send report to caregivers
   */
  async sendReport(
    report: DailyReport | WeeklyReport,
    recipients: string[]
  ): Promise<void>

  /**
   * Schedule automatic reports
   */
  async scheduleReports(patientId: string): Promise<void>
}
```

## Health Score Calculation

```typescript
const calculateHealthScore = (data: HealthData): HealthScore => {
  let vitalsScore = 0;
  let medicationsScore = 0;
  let activitiesScore = 0;
  let consistencyScore = 0;

  // Vitals (30 points)
  if (data.bloodPressure.status === 'normal') vitalsScore += 15;
  else if (data.bloodPressure.status === 'elevated') vitalsScore += 10;

  if (data.bloodSugar.status === 'normal') vitalsScore += 15;
  else if (data.bloodSugar.status === 'pre_diabetic') vitalsScore += 10;

  // Medications (30 points)
  medicationsScore = (data.medications.adherenceRate / 100) * 30;

  // Activities (20 points)
  const waterScore = Math.min((data.waterIntake.percentage / 100) * 10, 10);
  const exerciseScore = data.exercise.goalMet ? 10 : (data.exercise.minutes / 30) * 10;
  activitiesScore = waterScore + exerciseScore;

  // Consistency (20 points) - based on logging frequency
  consistencyScore = data.loggingRate * 20;

  return {
    total: Math.round(vitalsScore + medicationsScore + activitiesScore + consistencyScore),
    breakdown: {
      vitals: Math.round(vitalsScore),
      medications: Math.round(medicationsScore),
      activities: Math.round(activitiesScore),
      consistency: Math.round(consistencyScore)
    }
  };
};
```

## Report Template

### Daily Report (LINE Flex Message)

```json
{
  "type": "flex",
  "altText": "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô",
  "contents": {
    "type": "carousel",
    "contents": [
      {
        "type": "bubble",
        "header": {
          "type": "box",
          "contents": [{
            "type": "text",
            "text": "üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô",
            "size": "xl",
            "weight": "bold"
          }]
        },
        "body": {
          "type": "box",
          "contents": [
            {
              "type": "box",
              "layout": "baseline",
              "contents": [
                { "type": "text", "text": "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", "flex": 0 },
                { "type": "text", "text": "87/100", "size": "xxl", "weight": "bold", "color": "#06C755", "align": "end" }
              ]
            },
            { "type": "separator" },
            { "type": "text", "text": "üíä ‡∏¢‡∏≤: 100% (2/2)", "margin": "md" },
            { "type": "text", "text": "üíß ‡∏ô‡πâ‡∏≥: 85% (1,700/2,000ml)", "margin": "sm" },
            { "type": "text", "text": "üèÉ ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢: ‚úÖ 30 ‡∏ô‡∏≤‡∏ó‡∏µ", "margin": "sm" },
            { "type": "text", "text": "ü©∫ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô: 120/80 ‡∏õ‡∏Å‡∏ï‡∏¥", "margin": "sm" }
          ]
        }
      },
      {
        "type": "bubble",
        "header": {
          "type": "box",
          "contents": [{
            "type": "text",
            "text": "üí° Insights",
            "size": "xl",
            "weight": "bold"
          }]
        },
        "body": {
          "type": "box",
          "contents": [
            { "type": "text", "text": "‚úÖ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏∏‡∏Å‡∏°‡∏∑‡πâ‡∏≠!", "wrap": true },
            { "type": "text", "text": "üìà ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß 5%", "wrap": true, "margin": "md" },
            { "type": "text", "text": "üí° ‡∏Ñ‡∏ß‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å 300ml", "wrap": true, "margin": "md" }
          ]
        }
      }
    ]
  }
}
```

## Testing Strategy

### Test Scenarios
1. **Daily Report**: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏™‡πà‡∏ß‡∏ô
2. **Missing Data**: ‡∏ö‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏°‡∏µ ‚Üí ‡πÅ‡∏™‡∏î‡∏á N/A
3. **Perfect Day**: ‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á ‚Üí Health Score 100
4. **Poor Adherence**: ‡∏¢‡∏≤‡∏Ç‡∏≤‡∏î‡∏´‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡πâ‡∏≠ ‚Üí ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡πà‡∏≥ + ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
5. **Trending**: ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
6. **PDF Export**: Export ‡πÄ‡∏õ‡πá‡∏ô PDF ‡πÑ‡∏î‡πâ
7. **Scheduled**: ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 20:00 ‡∏ô. ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô

## Timeline

**Estimated**: 12 hours (1.5 days)

## Examples

### AI-Generated Insights

```typescript
[
  "‚úÖ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏¥‡∏ô‡∏¢‡∏≤‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏°‡∏∑‡πâ‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô 7 ‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!",
  "üìä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 125/82 ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß 8%",
  "üí° ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å 10 ‡∏ô‡∏≤‡∏ó‡∏µ/‡∏ß‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏ï‡πá‡∏° 100",
  "‚ö†Ô∏è ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ 3 ‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏•‡∏î‡∏´‡∏ß‡∏≤‡∏ô",
  "üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏´‡∏ô‡πâ‡∏≤: ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏Ñ‡∏£‡∏ö 5 ‡∏ß‡∏±‡∏ô"
]
```

---

**Created**: 2024-01-16
**Priority**: High
**Status**: Ready for implementation
